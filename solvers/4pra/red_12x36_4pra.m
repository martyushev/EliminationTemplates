% Input: coefficient matrix C of size 5x35
% Output: solution matrix S of size 3x24

function S = red_12x36_4pra(C,ss)

    M = sparse([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12],[10,11,12,13,14,15,16,17,18,19,23,24,25,26,27,28,29,30,31,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,23,25,27,29,32,33,35,37,40,42,44,47,49,52,4,5,6,7,8,9,13,14,15,18,21,22,23,24,25,26,27,28,30,33,34,35,36,37,38,39,42,43,44,45,46,49,50,51,54,10,11,12,13,14,15,16,17,18,19,23,24,25,26,27,28,29,30,31,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,23,25,27,29,32,33,35,37,40,42,44,47,49,52,4,5,6,7,8,9,13,14,15,18,21,22,23,24,25,26,27,28,30,33,34,35,36,37,38,39,42,43,44,45,46,49,50,51,54,10,11,12,13,14,15,16,17,18,19,23,24,25,26,27,28,29,30,31,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,23,25,27,29,32,33,35,37,40,42,44,47,49,52,4,5,6,7,8,9,13,14,15,18,21,22,23,24,25,26,27,28,30,33,34,35,36,37,38,39,42,43,44,45,46,49,50,51,54,10,11,12,13,14,15,16,17,18,19,23,24,25,26,27,28,29,30,31,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,23,25,27,29,32,33,35,37,40,42,44,47,49,52,4,5,6,7,8,9,13,14,15,18,21,22,23,24,25,26,27,28,30,33,34,35,36,37,38,39,42,43,44,45,46,49,50,51,54],C([1,6,11,26,31,46,76,81,96,126,61,71,111,121,141,151,156,166,171,16,21,36,41,51,56,66,86,91,101,106,116,131,136,146,161,1,6,11,26,31,36,46,51,61,76,81,86,96,101,111,126,131,141,156,16,71,121,151,166,171,21,41,56,66,91,106,116,136,146,161,1,6,11,26,31,46,76,81,96,126,61,71,111,121,141,151,156,166,171,16,21,36,41,51,56,66,86,91,101,106,116,131,136,146,161,2,7,12,27,32,47,77,82,97,127,62,72,112,122,142,152,157,167,172,17,22,37,42,52,57,67,87,92,102,107,117,132,137,147,162,2,7,12,27,32,37,47,52,62,77,82,87,97,102,112,127,132,142,157,17,72,122,152,167,172,22,42,57,67,92,107,117,137,147,162,2,7,12,27,32,47,77,82,97,127,62,72,112,122,142,152,157,167,172,17,22,37,42,52,57,67,87,92,102,107,117,132,137,147,162,3,8,13,28,33,48,78,83,98,128,63,73,113,123,143,153,158,168,173,18,23,38,43,53,58,68,88,93,103,108,118,133,138,148,163,3,8,13,28,33,38,48,53,63,78,83,88,98,103,113,128,133,143,158,18,73,123,153,168,173,23,43,58,68,93,108,118,138,148,163,3,8,13,28,33,48,78,83,98,128,63,73,113,123,143,153,158,168,173,18,23,38,43,53,58,68,88,93,103,108,118,133,138,148,163,4,9,14,29,34,49,79,84,99,129,64,74,114,124,144,154,159,169,174,19,24,39,44,54,59,69,89,94,104,109,119,134,139,149,164,4,9,14,29,34,39,49,54,64,79,84,89,99,104,114,129,134,144,159,19,74,124,154,169,174,24,44,59,69,94,109,119,139,149,164,4,9,14,29,34,49,79,84,99,129,64,74,114,124,144,154,159,169,174,19,24,39,44,54,59,69,89,94,104,109,119,134,139,149,164]),12,55);

    M0 = sparse([1,1,1,1,1,1,2,2,2,2,2,2,3,3,3,4,4,4,4,4,4,5,5,5,6,6,6,7,7,7,8,8,8,9,9,9,10,10,10,10,10,10,11,11,11,12,12,12,13,13,13,14,14,14,15,15,15,16,16,16,17,17,17,18,18,18,19,19,19],[2,6,10,13,16,28,1,17,20,29,32,36,13,16,28,3,7,11,15,19,31,14,18,30,15,19,31,2,6,16,17,20,32,3,7,19,5,9,12,22,26,34,21,25,33,22,26,34,4,8,23,24,27,35,5,9,26,6,10,28,29,32,36,7,11,31,9,12,34],[-1,-2*ss,-ss^2,-1,-2,-2*ss,1,-1,-1,-ss,-2*ss,-ss^2,1,1,ss,-1,-2*ss,-ss^2,-1,-2,-2*ss,1,1,ss,1,1,ss,1,ss,1,1,1,ss,1,ss,1,-1,-2*ss,-ss^2,-1,-2,-2*ss,1,1,ss,1,1,ss,1,ss,1,1,1,ss,1,ss,1,1,ss,1,1,1,ss,1,ss,1,1,ss,1],19,36);
    M = M(:,20:end)-M(:,1:19)*M0; % Schur complement reduction

    [L,~,P] = lu(M(:,1:3));
    P = P';
    M = [P*L P(:,4:end)]\M(:,4:end);
    M = M(end-8:end,:);

    T0 = zeros(24);
    T0([6,8,13,15,18,20,21,23,24],:) = -M(:,10:end);
    T0([193,242,267,292,317,343,369,394,419,444,470,496,521,547,574]) = 1;
    T1 = zeros(24);
    T1([6,8,13,15,18,20,21,23,24],[6,8,13,15,18,20,21,23,24]) = M(:,1:9);
    T1([1,26,51,76,101,151,201,226,251,276,326,376,401,451,526]) = 1;

    [V,~] = eig(T0,T1);
    S = V(21:23,:)./repmat(V(24,:),3,1);

    I = ~any(isnan(S)) & ~any(isinf(S));
    %I = I & ~any(imag(S)); % uncomment this line for real roots only
    S = S(:,I);

end