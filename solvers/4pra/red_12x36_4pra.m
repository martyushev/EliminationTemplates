% Input: coefficient matrix C of size 5x35
% Output: solution matrix S of size 3x24

function S = red_12x36_4pra(C)

    ix = [1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,6,6,6,6,7,7,7,7,8,8,8,8,9,9,9,9,10,10,10,10,11,11,11,11,12,12,12,12,13,13,13,13,14,14,14,14,15,15,15,15,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31];
    jx = [11,37,41,49,17,43,47,51,19,22,30,49,6,34,38,46,14,40,44,50,18,28,31,46,1,3,7,16,2,9,17,20,3,32,42,54,8,11,15,19,9,35,47,53,10,36,48,52,15,26,30,41,16,21,27,42,4,6,12,18,5,33,45,55,12,24,28,38,13,25,29,39,7,23,27,54,8,10,11,13,14,15,16,17,18,19,21,22,25,26,27,28,29,30,31,36,37,39,40,41,42,43,44,45,46,47,48,49,50,51,52,4,5,6,7,9,12,13,14,15,18,23,24,25,26,27,28,29,30,31,33,34,35,38,39,40,41,44,45,46,47,50,52,53,54,55,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,23,25,27,29,32,33,36,39,42,45,48,52,54,55,8,10,11,13,14,15,16,17,18,19,21,22,25,26,27,28,29,30,31,36,37,39,40,41,42,43,44,45,46,47,48,49,50,51,52,4,5,6,7,9,12,13,14,15,18,23,24,25,26,27,28,29,30,31,33,34,35,38,39,40,41,44,45,46,47,50,52,53,54,55,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,23,25,27,29,32,33,36,39,42,45,48,52,54,55,8,10,11,13,14,15,16,17,18,19,21,22,25,26,27,28,29,30,31,36,37,39,40,41,42,43,44,45,46,47,48,49,50,51,52,4,5,6,7,9,12,13,14,15,18,23,24,25,26,27,28,29,30,31,33,34,35,38,39,40,41,44,45,46,47,50,52,53,54,55,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,23,25,27,29,32,33,36,39,42,45,48,52,54,55,8,10,11,13,14,15,16,17,18,19,21,22,25,26,27,28,29,30,31,36,37,39,40,41,42,43,44,45,46,47,48,49,50,51,52,4,5,6,7,9,12,13,14,15,18,23,24,25,26,27,28,29,30,31,33,34,35,38,39,40,41,44,45,46,47,50,52,53,54,55,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,23,25,27,29,32,33,36,39,42,45,48,52,54,55];
    kx = [140,155,175,130,140,155,175,130,140,130,175,155,140,155,175,130,140,155,175,130,140,175,130,155,140,155,175,130,140,175,130,155,140,155,130,175,140,155,175,130,140,155,130,175,140,155,130,175,140,175,130,155,140,130,175,155,140,155,175,130,140,155,130,175,140,175,130,155,140,175,130,155,140,175,130,155,21,41,56,91,106,136,16,36,86,11,6,1,161,171,131,156,81,126,76,66,71,116,121,151,51,61,166,101,111,141,31,46,96,26,146,21,41,56,91,106,136,16,36,86,11,161,171,131,156,81,126,6,76,1,66,71,121,151,51,61,111,141,31,46,96,26,101,166,116,146,21,41,56,91,106,116,136,16,146,36,51,161,86,101,131,11,31,81,6,66,1,171,156,126,76,71,121,61,111,46,96,26,141,151,166,22,42,57,92,107,137,17,37,87,12,7,2,162,172,132,157,82,127,77,67,72,117,122,152,52,62,167,102,112,142,32,47,97,27,147,22,42,57,92,107,137,17,37,87,12,162,172,132,157,82,127,7,77,2,67,72,122,152,52,62,112,142,32,47,97,27,102,167,117,147,22,42,57,92,107,117,137,17,147,37,52,162,87,102,132,12,32,82,7,67,2,172,157,127,77,72,122,62,112,47,97,27,142,152,167,23,43,58,93,108,138,18,38,88,13,8,3,163,173,133,158,83,128,78,68,73,118,123,153,53,63,168,103,113,143,33,48,98,28,148,23,43,58,93,108,138,18,38,88,13,163,173,133,158,83,128,8,78,3,68,73,123,153,53,63,113,143,33,48,98,28,103,168,118,148,23,43,58,93,108,118,138,18,148,38,53,163,88,103,133,13,33,83,8,68,3,173,158,128,78,73,123,63,113,48,98,28,143,153,168,24,44,59,94,109,139,19,39,89,14,9,4,164,174,134,159,84,129,79,69,74,119,124,154,54,64,169,104,114,144,34,49,99,29,149,24,44,59,94,109,139,19,39,89,14,164,174,134,159,84,129,9,79,4,69,74,124,154,54,64,114,144,34,49,99,29,104,169,119,149,24,44,59,94,109,119,139,19,149,39,54,164,89,104,134,14,34,84,9,69,4,174,159,129,79,74,124,64,114,49,99,29,144,154,169];
    M = sparse(ix,jx,C(kx),31,55);

    M = M(20:end,20:end)-M(20:end,1:19)*(M(1:19,1:19)\M(1:19,20:end)); % Schur complement reduction

    [L,~,P] = lu(M(:,1:3));
    P = P';
    M = [P*L P(:,4:end)]\M(:,4:end);
    M = M(end-8:end,:);

    T = zeros(24);
    T([24,22,21,13,14,16,17,19,20],:) = -M(:,1:9)\M(:,10:end);
    T([25,530,75,148,173,198,511,488,225,298,323,348,375,450,575]) = 1;

    [V,~] = eig(T);
    S([1,3],:) = V([21,23],:)./repmat(V(24,:),2,1);
    S(2,:) = V(24,:)./V(22,:);

    I = ~isnan(S(1,:)) & ~isinf(S(1,:));
    %I = I & ~imag(S(1,:)); % uncomment this line for real roots only
    S = S(:,I);

end