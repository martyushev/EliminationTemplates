% Input: coefficient matrix C of size 8x25
% Output: solution matrix S of size 8x37

function S = red_190x227_colpiv_l2_3view_triang(C)

    ix = [1,1,1,1,1,2,2,2,2,2,3,3,3,3,3,4,4,4,4,4,5,5,5,5,5,6,6,6,6,6,7,7,7,7,7,8,8,8,8,8,9,9,9,9,9,10,10,10,10,10,11,11,11,11,11,12,12,12,12,12,13,13,13,13,13,14,14,14,14,14,15,15,15,15,15,16,16,16,16,16,17,17,17,17,17,18,18,18,18,18,19,19,19,19,19,20,20,20,20,20,21,21,21,21,21,22,22,22,22,22,23,23,23,23,23,24,24,24,24,24,25,25,25,25,25,26,26,26,26,26,27,27,27,27,27,28,28,28,28,28,29,29,29,29,29,30,30,30,30,30,31,31,31,31,31,32,32,32,32,32,33,33,33,33,33,34,34,34,34,34,35,35,35,35,35,36,36,36,36,36,37,37,37,37,37,38,38,38,38,38,39,39,39,39,39,40,40,40,40,40,41,41,41,41,41,42,42,42,42,42,43,43,43,43,43,44,44,44,44,44,45,45,45,45,45,46,46,46,46,46,47,47,47,47,47,48,48,48,48,48,49,49,49,49,49,50,50,50,50,50,51,51,51,51,51,52,52,52,52,52,53,53,53,53,53,53,54,54,54,54,54,54,54,55,55,55,55,55,55,55,55,56,56,56,56,56,56,56,56,57,57,57,57,57,57,58,58,58,58,58,58,59,59,59,59,59,59,60,60,60,60,60,60,61,61,61,61,61,61,61,61,62,62,62,62,62,62,62,62,63,63,63,63,63,63,63,63,64,64,64,64,64,64,64,64,65,65,65,65,65,65,65,65,66,66,66,66,66,66,66,66,67,67,67,67,67,67,67,67,68,68,68,68,68,68,68,68,69,69,69,69,69,69,69,69,70,70,70,70,70,70,70,70,71,71,71,71,71,71,71,71,72,72,72,72,72,72,72,72,73,73,73,73,73,74,74,74,74,74,74,74,74,75,75,75,75,75,75,75,75,76,76,76,76,76,76,77,77,77,77,77,77,78,78,78,78,78,78,79,79,79,79,79,79,79,79,80,80,80,80,80,80,80,80,81,81,81,81,81,81,81,81,82,82,82,82,82,82,82,82,83,83,83,83,83,83,83,83,84,84,84,84,84,84,84,84,85,85,85,85,85,85,85,85,86,86,86,86,86,86,86,86,87,87,87,87,87,87,87,87,88,88,88,88,88,88,88,88,89,89,89,89,89,89,89,89,90,90,90,90,90,90,90,90,91,91,91,91,91,92,92,92,92,92,93,93,93,93,93,94,94,94,94,94,95,95,95,95,95,96,96,96,96,96,97,97,97,97,97,98,98,98,98,98,99,99,99,99,99,100,100,100,100,100,101,101,101,101,101,102,102,102,102,102,103,103,103,103,103,104,104,104,104,104,105,105,105,105,105,106,106,106,106,106,107,107,107,107,107,108,108,108,108,108,109,109,109,109,109,110,110,110,110,110,111,111,111,111,111,112,112,112,112,112,113,113,113,113,113,114,114,114,114,114,115,115,115,115,115,116,116,116,116,116,117,117,117,117,117,118,118,118,118,118,119,119,119,119,119,120,120,120,120,120,121,121,121,121,121,122,122,122,122,122,123,123,123,123,123,124,124,124,124,124,125,125,125,125,125,126,126,126,126,126,127,127,127,127,127,128,128,128,128,128,129,129,129,129,129,130,130,130,130,130,131,131,131,131,131,132,132,132,132,132,133,133,133,133,133,134,134,134,134,134,135,135,135,135,135,136,136,136,136,136,137,137,137,137,137,138,138,138,138,138,139,139,139,139,139,140,140,140,140,140,141,141,141,141,141,142,142,142,142,142,143,143,143,143,143,144,144,144,144,144,145,145,145,145,145,146,146,146,146,146,147,147,147,147,147,148,148,148,148,148,149,149,149,149,149,150,150,150,150,150,151,151,151,151,151,152,152,152,152,152,153,153,153,153,153,154,154,154,154,154,154,154,155,155,155,155,155,155,155,155,155,156,156,156,156,156,156,156,156,157,157,157,157,157,157,157,157,157,158,158,158,158,158,158,158,158,159,159,159,159,159,160,160,160,160,160,160,160,160,160,161,161,161,161,161,161,161,161,161,162,162,162,162,162,162,162,162,162,163,163,163,163,163,163,163,163,163,164,164,164,164,164,164,164,164,164,165,165,165,165,165,165,165,165,165,166,166,166,166,166,166,166,166,166,167,167,167,167,167,167,167,167,167,168,168,168,168,168,168,168,168,168,169,169,169,169,169,169,169,169,169,170,170,170,170,170,170,170,170,170,171,171,171,171,171,171,171,171,171,172,172,172,172,172,172,172,172,172,173,173,173,173,173,173,174,174,174,174,174,174,174,174,174,175,175,175,175,175,175,175,175,176,176,176,176,176,176,176,176,176,177,177,177,177,177,177,177,177,177,178,178,178,178,178,178,178,178,178,179,179,179,179,179,179,179,179,179,180,180,180,180,180,180,180,180,180,181,181,181,181,181,181,182,182,182,182,182,182,182,182,182,183,183,183,183,183,183,183,183,183,184,184,184,184,184,184,184,184,184,185,185,185,185,185,185,185,185,185,186,186,186,186,186,186,186,186,186,187,187,187,187,187,187,187,187,187,188,188,188,188,188,188,188,188,188,189,189,189,189,189,189,189,189,189,190,190,190,190,190,190,190,190,190];
    jx = [54,121,158,159,188,56,122,160,161,189,58,123,162,163,190,19,21,62,127,194,97,129,166,167,196,21,22,64,130,197,22,23,65,131,198,69,135,168,169,202,24,25,71,136,203,73,139,170,171,206,75,140,171,172,207,26,27,77,141,208,28,29,79,142,209,83,144,174,177,213,106,145,175,178,214,109,146,178,179,215,84,147,180,181,216,87,148,182,183,217,117,149,186,187,218,124,151,193,196,220,125,152,194,197,221,128,153,197,198,222,132,154,201,202,223,137,155,206,207,224,143,156,214,215,226,150,157,221,222,227,55,121,158,159,188,57,122,160,161,189,59,123,162,163,190,19,21,63,127,194,98,129,166,167,196,21,22,99,130,197,22,23,100,131,198,70,135,168,169,202,24,25,72,136,203,74,139,170,171,206,76,140,171,172,207,26,27,78,141,208,28,29,80,142,209,83,143,173,176,212,107,145,175,178,214,110,146,178,179,215,85,147,180,181,216,88,148,182,183,217,118,149,186,187,218,124,150,192,195,219,126,152,194,197,221,129,153,197,198,222,133,154,201,202,223,138,155,206,207,224,144,156,214,215,226,151,157,221,222,227,3,13,49,95,119,186,5,40,44,63,107,126,193,20,41,45,64,109,128,164,195,42,46,99,110,129,164,165,196,8,9,101,114,135,202,4,10,103,115,139,206,11,12,104,116,140,207,1,180,182,194,214,221,91,93,108,119,145,173,174,214,92,94,111,120,146,176,177,215,60,61,119,123,149,184,185,218,81,84,87,125,143,150,191,219,82,85,88,126,144,151,191,220,113,115,127,145,152,192,193,221,114,116,130,146,153,195,196,222,86,89,134,147,154,199,200,223,89,90,139,148,155,204,205,224,210,211,216,217,221,225,226,227,121,122,145,149,156,212,213,226,147,148,152,156,157,219,220,227,14,53,96,120,187,20,41,45,65,109,128,164,195,42,46,100,110,129,164,165,196,8,9,102,114,135,202,11,12,105,116,140,207,2,181,183,198,215,222,91,93,111,119,145,173,174,214,92,94,112,120,146,176,177,215,60,61,120,123,149,184,185,218,81,84,87,128,143,150,191,219,82,85,88,129,144,151,191,220,113,115,130,145,152,192,193,221,114,116,131,146,153,195,196,222,86,89,135,147,154,199,200,223,89,90,140,148,155,204,205,224,210,211,216,217,222,225,226,227,121,122,146,149,156,212,213,226,147,148,153,156,157,219,220,227,15,17,54,58,117,16,18,55,59,118,162,163,188,190,218,30,33,67,107,126,31,34,68,108,127,32,35,69,109,128,33,36,70,110,129,34,37,101,111,130,37,38,102,112,131,39,41,71,84,132,40,42,72,85,133,43,45,77,87,137,44,46,78,88,138,180,181,203,216,223,182,183,208,217,224,47,50,84,117,143,48,51,85,118,144,52,53,114,120,146,86,91,92,121,147,89,93,94,122,148,186,187,216,218,226,95,96,121,123,149,106,109,132,143,150,107,110,133,144,151,108,111,134,145,152,111,112,135,146,153,113,114,136,147,154,115,116,141,148,155,214,215,223,226,227,119,120,147,149,156,145,146,154,156,157,15,17,56,58,117,16,18,57,59,118,162,163,189,190,218,30,33,74,107,126,31,34,103,108,127,32,35,75,109,128,33,36,76,110,129,34,37,104,111,130,37,38,105,112,131,39,41,77,84,132,40,42,78,85,133,43,45,79,87,137,44,46,80,88,138,180,181,208,216,223,182,183,209,217,224,47,50,87,117,143,48,51,88,118,144,49,52,115,119,145,52,53,116,120,146,89,91,92,121,147,90,93,94,122,148,186,187,217,218,226,95,96,122,123,149,106,109,137,143,150,107,110,138,144,151,108,111,139,145,152,111,112,140,146,153,113,114,141,147,154,115,116,142,148,155,214,215,224,226,227,119,120,148,149,156,145,146,155,156,157,13,14,184,185,186,187,218,15,16,17,18,58,59,95,96,123,5,82,164,165,191,193,196,220,6,7,8,9,199,200,201,202,223,10,11,12,204,205,206,207,224,1,2,210,211,225,32,33,35,36,109,110,111,112,146,39,40,41,42,84,85,113,114,147,43,44,45,46,87,88,115,116,148,173,174,176,177,212,213,214,215,226,47,48,50,51,117,118,119,120,149,62,63,64,99,125,126,127,130,152,64,65,99,100,128,129,130,131,153,66,67,69,70,132,133,134,135,154,73,74,75,76,137,138,139,140,155,192,193,195,196,219,220,221,222,227,106,107,109,110,143,144,145,146,156,125,126,128,129,150,151,152,153,157,158,159,160,161,186,187,188,189,218,3,60,61,95,96,123,6,8,10,11,192,195,199,204,219,7,9,12,193,196,200,205,220,168,169,171,172,197,198,202,207,222,24,25,26,27,201,202,203,208,223,26,27,28,29,206,207,208,209,224,39,41,43,45,84,87,106,109,143,40,42,44,46,85,88,107,110,144,4,89,90,115,116,148,180,181,182,183,214,215,216,217,226,91,92,93,94,119,120,121,122,149,66,69,73,75,125,128,132,137,150,67,70,74,76,126,129,133,138,151,68,101,103,104,127,130,134,139,152,101,102,104,105,130,131,135,140,153,201,202,206,207,221,222,223,224,227,113,114,115,116,145,146,147,148,156,134,135,139,140,152,153,154,155,157];
    kx = [129,193,81,89,177,129,193,81,89,177,129,193,81,89,177,81,89,129,193,177,129,193,81,89,177,81,89,129,193,177,81,89,129,193,177,129,193,81,89,177,81,89,129,193,177,129,193,81,89,177,129,193,81,89,177,81,89,129,193,177,81,89,129,193,177,129,193,81,89,177,129,193,81,89,177,129,193,81,89,177,129,193,81,89,177,129,193,81,89,177,129,193,81,89,177,129,193,81,89,177,129,193,81,89,177,129,193,81,89,177,129,193,81,89,177,129,193,81,89,177,129,193,81,89,177,129,193,81,89,177,138,194,82,90,178,138,194,82,90,178,138,194,82,90,178,82,90,138,194,178,138,194,82,90,178,82,90,138,194,178,82,90,138,194,178,138,194,82,90,178,82,90,138,194,178,138,194,82,90,178,138,194,82,90,178,82,90,138,194,178,82,90,138,194,178,138,194,82,90,178,138,194,82,90,178,138,194,82,90,178,138,194,82,90,178,138,194,82,90,178,138,194,82,90,178,138,194,82,90,178,138,194,82,90,178,138,194,82,90,178,138,194,82,90,178,138,194,82,90,178,138,194,82,90,178,138,194,82,90,178,115,67,147,187,195,179,67,115,123,147,187,195,179,67,115,123,147,187,195,75,179,115,123,147,187,195,67,75,179,67,75,147,187,195,179,115,67,147,187,195,179,67,75,147,187,195,179,67,115,123,147,187,195,115,123,147,187,195,67,75,179,115,123,147,187,195,67,75,179,115,123,147,187,195,67,75,179,67,115,123,147,187,195,75,179,75,115,123,147,187,195,67,179,115,123,147,187,195,67,75,179,115,123,147,187,195,67,75,179,115,123,147,187,195,67,75,179,115,123,147,187,195,67,75,179,67,75,115,123,147,179,187,195,115,123,147,187,195,67,75,179,115,123,147,187,195,67,75,179,68,156,188,196,180,68,116,124,156,188,196,76,180,116,124,156,188,196,68,76,180,68,76,156,188,196,180,68,76,156,188,196,180,68,116,124,156,188,196,116,124,156,188,196,68,76,180,116,124,156,188,196,68,76,180,116,124,156,188,196,68,76,180,68,116,124,156,188,196,76,180,76,116,124,156,188,196,68,180,116,124,156,188,196,68,76,180,116,124,156,188,196,68,76,180,116,124,156,188,196,68,76,180,116,124,156,188,196,68,76,180,68,76,116,124,156,180,188,196,116,124,156,188,196,68,76,180,116,124,156,188,196,68,76,180,101,109,165,189,197,101,109,165,189,197,101,109,165,189,197,101,109,165,189,197,101,109,165,189,197,101,109,165,189,197,101,109,165,189,197,101,109,165,189,197,101,109,165,189,197,101,109,165,189,197,101,109,165,189,197,101,109,165,189,197,101,109,165,189,197,101,109,165,189,197,101,109,165,189,197,101,109,165,189,197,101,109,165,189,197,101,109,165,189,197,165,101,109,189,197,165,101,109,189,197,101,109,165,189,197,101,109,165,189,197,101,109,165,189,197,101,109,165,189,197,101,109,165,189,197,101,109,165,189,197,101,109,165,189,197,101,109,165,189,197,101,109,165,189,197,101,109,165,189,197,101,109,165,189,197,102,110,174,190,198,102,110,174,190,198,102,110,174,190,198,102,110,174,190,198,102,110,174,190,198,102,110,174,190,198,102,110,174,190,198,102,110,174,190,198,102,110,174,190,198,102,110,174,190,198,102,110,174,190,198,102,110,174,190,198,102,110,174,190,198,102,110,174,190,198,102,110,174,190,198,102,110,174,190,198,102,110,174,190,198,102,110,174,190,198,102,110,174,190,198,174,102,110,190,198,174,102,110,190,198,102,110,174,190,198,102,110,174,190,198,102,110,174,190,198,102,110,174,190,198,102,110,174,190,198,102,110,174,190,198,102,110,174,190,198,102,110,174,190,198,102,110,174,190,198,102,110,174,190,198,102,110,174,190,198,7,23,135,143,151,159,199,7,15,23,31,135,143,151,159,199,7,143,23,31,135,151,159,199,7,15,23,31,135,143,151,159,199,7,23,31,135,143,151,159,199,7,23,135,143,199,7,15,23,31,135,143,151,159,199,7,15,23,31,135,143,151,159,199,7,15,23,31,135,143,151,159,199,7,15,23,31,135,143,151,159,199,7,15,23,31,135,143,151,159,199,7,15,23,31,135,143,151,159,199,7,23,15,31,135,143,151,159,199,7,15,23,31,135,143,151,159,199,7,15,23,31,135,143,151,159,199,7,15,23,31,135,143,151,159,199,7,15,23,31,135,143,151,159,199,7,15,23,31,135,143,151,159,199,40,48,56,64,152,160,168,176,200,40,168,176,152,160,200,40,48,56,64,152,160,168,176,200,40,48,64,152,160,168,176,200,40,48,56,64,152,160,168,176,200,40,48,56,64,152,160,168,176,200,40,48,56,64,152,160,168,176,200,40,48,56,64,168,176,152,160,200,40,48,56,64,168,176,152,160,200,40,168,176,152,160,200,40,48,56,64,152,160,168,176,200,40,48,56,64,152,160,168,176,200,40,48,56,64,152,160,168,176,200,40,48,56,64,152,160,168,176,200,40,48,56,64,152,160,168,176,200,40,48,56,64,152,160,168,176,200,40,48,56,64,152,160,168,176,200,40,48,56,64,152,160,168,176,200,40,48,56,64,152,160,168,176,200];
    M = sparse(ix,jx,C(kx),190,227);

    [L,~,P] = lu(M(:,1:90));
    P = P';
    M = [P*L P(:,91:end)]\M(:,91:end);
    M = full(M(91:end,:));

    [L,U,P] = lu(M(:,1:67));
    P = P';
    M = [P*L P(:,68:end)]\M(:,68:end);
    M1 = M(1:67,:);
    M2 = M(68:end,:);

    [Q,R,P] = qr(M2(:,1:end-9));
    A = U\[M1(:,1:end-9)*P M1(:,end-8:end)];
    B = R(:,1:33)\[R(:,34:end) Q'*M2(:,end-8:end)];
    M = [-A(:,end-36:end)+A(:,1:end-37)*B; -B];

    P1 = [71:137 (1:61)*P 62:70];
    P2 = [71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,62,63,123,124,125,126,127,128,129,130,131,132,133,134,135,70,136,137];
    T = getT(M,P1(1:end-37),P1(end-36:end),P2);

    [V,~] = eig(T);
    S = V(29:36,:)./repmat(V(37,:),8,1);

    I = ~isnan(S(1,:)) & ~isinf(S(1,:));
    %I = I & ~imag(S(1,:)); % uncomment this line for real roots only
    S = S(:,I);

end