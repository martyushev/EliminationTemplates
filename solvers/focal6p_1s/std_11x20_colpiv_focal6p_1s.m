% Input: coefficient matrix C of size 10x20

% Monomial vector: [g*u^3, g*u^2*v, g*u*v^2, g*v^3, u^2*g, u^3, v*u*g, v*u^2, v^2*g, v^2*u, v^3, g*u, u^2, g*v, v*u, v^2, g, u, v, 1]

function [g, u, v] = std_11x20_colpiv_focal6p_1s(C)

    i_dx = [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11];
    j_dx = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 1, 2, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 2, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 1, 3, 4, 5, 9, 10, 11, 12, 14, 17, 2, 6, 7, 8, 13, 15, 16, 18, 19, 20];
    C_dx = [31, 101, 1, 11, 21, 51, 71, 91, 41, 61, 81, 111, 121, 131, 141, 151, 161, 171, 181, 191, 32, 102, 2, 12, 22, 52, 72, 92, 42, 62, 82, 112, 122, 132, 142, 152, 162, 172, 182, 192, 33, 103, 3, 13, 23, 53, 73, 93, 43, 63, 83, 113, 123, 133, 143, 153, 163, 173, 183, 193, 34, 104, 4, 14, 24, 54, 74, 94, 44, 64, 84, 114, 124, 134, 144, 154, 164, 174, 184, 194, 35, 105, 5, 15, 25, 55, 75, 95, 45, 65, 85, 115, 125, 135, 145, 155, 165, 175, 185, 195, 36, 106, 6, 16, 26, 56, 76, 96, 46, 66, 86, 116, 126, 136, 146, 156, 166, 176, 186, 196, 37, 107, 17, 27, 57, 77, 97, 47, 67, 87, 117, 127, 137, 147, 157, 167, 177, 187, 108, 8, 18, 28, 58, 78, 98, 48, 68, 88, 118, 128, 138, 148, 158, 168, 178, 188, 109, 59, 79, 99, 49, 69, 89, 119, 129, 139, 149, 159, 169, 179, 189, 199, 110, 60, 80, 100, 130, 150, 160, 180, 190, 200, 110, 60, 80, 100, 130, 150, 160, 180, 190, 200];
    M = sparse(i_dx,j_dx,C(C_dx),11,20);

    [L,~,Pi] = lu(M(:,1:2));
    Pi = Pi';
    M = [Pi*L Pi(:,3:end)]\M(:,3:end);
    M = full(M(3:end,:));

    [L,UR,Pi] = lu(M(:,1:6));
    Pi = Pi';
    M = [Pi*L Pi(:,7:end)]\M(:,7:end);
    MP = M(1:6,:);
    NP = M(7:end,:);

    [Q,U,Pi] = qr(NP(:,1:end-4));
    A = UR\[MP(:,1:end-4)*Pi MP(:,end-3:end)];
    B = U(:,1:3)\[U(:,4:end) Q'*NP(:,end-3:end)];
    M = [-A(:,end-8:end)+A(:,1:end-9)*B; -B];

    xP = [13, 14, 15, 1, 16, 2, 17, 18, 4, 5, 7, 10];
    P1 = [(1:8)*Pi 9:12];
    T = getT(M,[13:18 P1(1:end-9)],P1(end-8:end),xP);

    [V,D] = eig(T);
    sol = [V([6, 8],:)./repmat(V(9,:),2,1); diag(D).'];

    I = find(not(isnan(sol(1,:))) & not(isinf(sol(1,:))));
    %I = find(not(isnan(sol(1,:))) & not(isinf(sol(1,:))) & not(imag(sol(1,:))) & sol(1,:) > 0);
    g = sol(1,I);
    v = sol(2,I);
    u = sol(3,I);

end