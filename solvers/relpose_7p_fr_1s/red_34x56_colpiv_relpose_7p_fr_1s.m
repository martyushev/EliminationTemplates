% Input: coefficient matrix C of size 11x56
% Output: solution matrix S of size 4x22

function S = red_34x56_colpiv_relpose_7p_fr_1s(C)

    ix = [1,1,1,1,1,1,2,2,2,2,2,2,3,3,3,3,3,3,4,4,4,4,4,4,5,5,5,5,5,5,6,6,6,6,6,6,7,7,7,7,7,7,8,8,8,8,8,8,9,9,9,9,9,9,10,10,10,10,10,10,11,11,11,11,11,11,12,12,12,12,12,12,13,13,13,13,13,13,14,14,14,14,14,14,15,15,15,15,15,15,16,16,16,16,16,16,17,17,17,17,17,17,18,18,18,18,18,18,19,19,19,19,19,19,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34];
    jx = [19,22,23,24,51,56,12,16,18,21,49,52,13,17,19,22,50,54,14,19,20,23,55,56,5,6,13,17,42,48,10,14,15,20,45,55,39,40,46,47,49,52,8,11,12,16,40,47,34,35,43,44,45,55,28,29,36,37,39,46,25,26,31,32,34,43,9,13,14,19,44,54,7,9,10,14,35,44,2,4,8,11,30,38,3,5,9,13,33,42,43,44,53,54,55,56,1,3,7,9,27,33,32,33,41,42,44,54,26,27,32,33,35,44,29,30,37,38,40,47,3,5,6,9,13,14,17,19,20,22,23,24,31,32,33,41,42,43,44,48,50,51,53,54,55,56,1,3,5,7,9,10,13,14,15,19,20,23,25,26,27,32,33,34,35,42,43,44,45,54,55,56,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,32,33,34,35,37,38,39,40,42,43,44,45,46,47,49,52,54,55,56,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,32,33,34,35,37,38,39,40,42,43,44,45,46,47,49,52,54,55,56,3,5,6,9,13,14,17,19,20,22,23,24,31,32,33,36,38,41,42,43,44,48,49,50,51,53,54,55,56,1,3,5,7,9,10,13,14,15,19,20,23,25,26,27,28,30,32,33,34,35,42,43,44,45,52,54,55,56,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,32,33,34,35,37,38,39,40,42,43,44,45,46,47,52,54,55,56,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,32,33,34,35,37,38,39,40,42,43,44,45,46,47,52,54,55,56,3,4,5,6,9,13,14,16,17,19,20,22,23,24,31,32,33,37,41,42,43,44,48,50,51,53,54,55,56,1,2,3,5,7,9,10,12,13,14,15,19,20,23,25,26,27,29,32,33,34,35,42,43,44,45,54,55,56,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,32,33,34,35,37,39,40,42,43,44,45,46,47,49,52,54,55,56,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,32,33,34,35,37,39,40,42,43,44,45,46,47,49,52,54,55,56,3,5,6,9,11,13,14,17,19,20,21,22,23,24,31,32,33,41,42,43,44,46,48,50,51,53,54,55,56,1,3,5,7,8,9,10,13,14,15,18,19,20,23,25,26,27,32,33,34,35,39,42,43,44,45,54,55,56];
    kx = [540,584,595,606,573,529,540,584,595,606,573,529,540,584,595,606,573,529,540,584,595,606,529,573,540,584,595,606,529,573,540,584,595,606,529,573,529,540,573,584,606,595,540,584,595,606,529,573,529,540,573,584,595,606,529,540,573,584,595,606,529,540,573,584,595,606,540,584,595,606,529,573,540,584,595,606,529,573,540,584,595,606,529,573,540,584,595,606,529,573,529,540,573,584,595,606,540,584,595,606,529,573,529,540,573,584,595,606,529,540,573,584,595,606,529,540,573,584,595,606,123,266,376,299,431,453,508,541,552,585,596,607,90,101,112,233,255,277,288,365,497,574,398,420,442,530,123,266,376,299,431,453,508,541,552,585,596,607,90,101,112,233,255,277,288,365,398,420,442,497,530,574,36,80,124,201,267,377,157,245,300,322,355,410,432,454,465,487,509,520,542,553,564,586,597,608,3,14,25,47,58,69,102,113,135,146,179,190,212,223,256,278,289,311,333,344,476,388,421,443,531,37,81,125,202,268,378,158,246,301,323,356,411,433,455,466,488,510,521,543,554,565,587,598,609,4,15,26,48,59,70,103,114,136,147,180,191,213,224,257,279,290,312,334,345,477,389,422,444,532,126,269,379,302,434,456,511,544,555,588,599,610,93,104,115,170,192,236,258,280,291,368,478,500,577,401,423,445,533,126,269,379,302,434,456,511,544,555,588,599,610,93,104,115,170,192,236,258,280,291,368,401,423,445,478,500,533,577,39,83,127,204,270,380,160,248,303,325,358,413,435,457,468,490,512,523,545,556,567,589,600,611,6,17,28,50,61,72,105,116,138,149,182,193,215,226,259,281,292,314,336,347,391,424,446,534,40,84,128,205,271,381,161,249,304,326,359,414,436,458,469,491,513,524,546,557,568,590,601,612,7,18,29,51,62,73,106,117,139,150,183,194,216,227,260,282,293,315,337,348,392,425,447,535,129,206,272,382,305,437,459,492,514,547,558,591,602,613,96,107,118,184,239,261,283,294,371,503,580,404,426,448,536,129,206,272,382,305,437,459,492,514,547,558,591,602,613,96,107,118,184,239,261,283,294,371,404,426,448,503,536,580,42,86,130,207,273,383,163,251,306,328,361,416,438,460,471,493,515,526,548,559,570,592,603,614,9,20,31,53,64,75,108,119,141,152,185,218,229,262,284,295,317,339,350,482,394,427,449,537,43,87,131,208,274,384,164,252,307,329,362,417,439,461,472,494,516,527,549,560,571,593,604,615,10,21,32,54,65,76,109,120,142,153,186,219,230,263,285,296,318,340,351,483,395,428,450,538,132,275,385,308,363,440,462,517,550,561,572,594,605,616,99,110,121,242,264,286,297,341,374,506,583,407,429,451,539,132,275,385,308,363,440,462,517,550,561,572,594,605,616,99,110,121,242,264,286,297,341,374,407,429,451,506,539,583];
    M = sparse(ix,jx,C(kx),34,56);

    [L,~,P] = lu(M(:,1:6));
    P = P';
    M = [P*L P(:,7:end)]\M(:,7:end);
    M = full(M(7:end,:));

    [L,U,P] = lu(M(:,1:18));
    P = P';
    M = [P*L P(:,19:end)]\M(:,19:end);
    M1 = M(1:18,:);
    M2 = M(19:end,:);

    [Q,R,P] = qr(M2(:,1:end-5));
    A = U\[M1(:,1:end-5)*P M1(:,end-4:end)];
    B = R(:,1:10)\[R(:,11:end) Q'*M2(:,end-4:end)];
    M = [-A(:,end-21:end)+A(:,1:end-22)*B; -B];

    P1 = [33:50 (1:27)*P 28:32];
    P2 = [10,11,33,15,16,34,19,20,35,21,36,22,23,37,28,38,30,39,31,40,41,25,42,43,47,48,50,44,32,45,46,49];
    T = getT(M,P1(1:end-22),P1(end-21:end),P2);

    [V,~] = eig(T);
    S = V(18:21,:)./repmat(V(22,:),4,1);

    I = ~isnan(S(1,:)) & ~isinf(S(1,:));
    %I = I & ~imag(S(1,:)); % uncomment this line for real roots only
    S = S(:,I);

end