% Input: coefficient matrix C of size 4x16
% Output: solution matrix S of size 4x10

function S = red_10x20_colpiv_wpnp_2x2sym(C)

    ix = [1,1,1,1,1,2,2,2,2,2,3,3,3,3,3,4,4,4,4,4,5,5,5,5,5,6,6,6,6,6,7,7,7,7,7,8,8,8,8,8,9,9,9,9,9,10,10,10,10,10];
    jx = [9,11,13,16,20,2,7,12,14,20,5,8,15,17,19,10,12,14,16,20,1,3,7,13,20,4,6,8,17,18,1,4,5,9,13,2,5,6,10,14,2,4,5,10,12,3,5,6,11,13];
    kx = [5,17,33,49,61,33,61,5,17,49,33,61,5,49,17,14,26,38,50,62,26,38,62,14,50,26,38,62,50,14,43,55,59,3,31,43,55,59,3,31,48,56,60,12,24,48,56,60,12,24];
    M = sparse(ix,jx,C(kx),10,20);

    M = full(M);

    [L,U,P] = lu(M(:,1:8));
    P = P';
    M = [P*L P(:,9:end)]\M(:,9:end);
    M1 = M(1:8,:);
    M2 = M(9:end,:);

    [Q,R,P] = qr(M2(:,1:end-5));
    A = U\[M1(:,1:end-5)*P M1(:,end-4:end)];
    B = R(:,1:2)\[R(:,3:end) Q'*M2(:,end-4:end)];
    M = [-A(:,end-9:end)+A(:,1:end-10)*B; -B];

    P1 = [13:20 (1:7)*P 8:12];
    P2 = [4,5,6,13,14,15,16,12,20,17,18,19];
    T = getT(M,P1(1:end-10),P1(end-9:end),P2);

    [V,~] = eig(T);
    S = V(6:9,:)./repmat(V(10,:),4,1);

    I = ~isnan(S(1,:)) & ~isinf(S(1,:));
    %I = I & ~imag(S(1,:)); % uncomment this line for real roots only
    S = S(:,I);
    
    z = sqrt(S(4,:));
    y = S(3,:)./z;
    x = 1./S(2,:);
    w = S(1,:);
    S = [w w; x x; y -y; z -z];

end