% Input: coefficient matrix C of size 4x27

function [w,x,y,z] = std_126x162_colpiv_p6pf_refract(C)

    i_dx = [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,14,14,14,14,14,14,15,15,15,15,15,15,16,16,16,16,16,16,17,17,17,17,17,17,18,18,18,18,18,18,19,19,19,19,19,20,20,20,20,20,20,21,21,21,21,21,21,22,22,22,22,22,22,23,23,23,23,23,23,24,24,24,24,24,24,25,25,25,25,25,25,26,26,26,26,26,26,27,27,27,27,27,27,28,28,28,28,28,28,29,29,29,29,29,29,30,30,30,30,30,30,31,31,31,31,31,31,32,32,32,32,32,32,33,33,33,33,33,33,34,34,34,34,34,34,35,35,35,35,35,35,36,36,36,36,36,36,37,37,37,37,37,37,38,38,38,38,38,38,39,39,39,39,39,39,40,40,40,40,40,40,41,41,41,41,41,41,42,42,42,42,42,42,43,43,43,43,43,43,44,44,44,44,44,44,45,45,45,45,45,45,46,46,46,46,46,46,47,47,47,47,47,47,48,48,48,48,48,48,49,49,49,49,49,49,50,50,50,50,50,50,51,51,51,51,51,51,52,52,52,52,52,52,53,53,53,53,53,53,54,54,54,54,54,54,55,55,55,55,55,55,56,56,56,56,56,56,57,57,57,57,57,58,58,58,58,58,58,59,59,59,59,59,59,60,60,60,60,60,60,61,61,61,61,61,61,62,62,62,62,62,62,63,63,63,63,63,63,64,64,64,64,64,64,65,65,65,65,65,65,66,66,66,66,66,66,67,67,67,67,67,67,68,68,68,68,68,68,69,69,69,69,69,69,70,70,70,70,70,70,71,71,71,71,71,71,72,72,72,72,72,72,73,73,73,73,73,73,74,74,74,74,74,74,75,75,75,75,75,75,76,76,76,76,76,76,77,77,77,77,77,77,78,78,78,78,78,78,79,79,79,79,79,79,80,80,80,80,80,80,81,81,81,81,81,81,82,82,82,82,82,82,83,83,83,83,83,83,84,84,84,84,84,84,85,85,85,85,85,85,86,86,86,86,86,86,87,87,87,87,87,87,88,88,88,88,88,88,89,89,89,89,89,89,90,90,90,90,90,90,91,91,91,91,91,91,92,92,92,92,92,92,93,93,93,93,93,93,94,94,94,94,94,94,95,95,95,95,95,95,96,96,96,96,96,96,97,97,97,97,97,97,98,98,98,98,98,98,99,99,99,99,99,99,100,100,100,100,100,100,101,101,101,101,101,101,102,102,102,102,102,102,103,103,103,103,103,103,104,104,104,104,104,104,105,105,105,105,105,105,106,106,106,106,106,106,107,107,107,107,107,107,108,108,108,108,108,108,109,109,109,109,109,109,110,110,110,110,110,110,111,111,111,111,111,111,112,112,112,112,112,112,113,113,113,113,113,113,114,114,114,114,114,114,115,115,115,115,115,115,116,116,116,116,116,116,117,117,117,117,117,117,118,118,118,118,118,118,119,119,119,119,119,119,120,120,120,120,120,120,121,121,121,121,121,121,122,122,122,122,122,122,123,123,123,123,123,123,124,124,124,124,124,124,125,125,125,125,125,125,126,126,126,126,126,126];
    j_dx = [1,2,3,4,5,6,7,8,9,10,11,12,13,17,18,20,23,28,34,35,55,68,83,104,105,136,5,6,8,10,14,15,17,18,20,21,23,28,34,35,44,51,52,70,74,83,105,112,113,115,136,146,14,15,17,20,31,32,34,35,44,51,52,55,60,61,76,80,83,92,104,105,112,115,127,129,146,154,31,32,34,35,48,49,51,52,55,60,61,85,89,92,94,112,113,115,129,136,137,139,154,158,9,11,18,19,21,22,24,29,37,45,63,68,69,70,71,72,75,83,84,91,104,112,113,114,116,147,18,21,36,37,45,56,70,72,76,77,78,81,83,84,91,92,93,104,112,113,116,127,128,130,147,155,56,63,76,78,83,85,86,87,90,91,92,93,94,95,104,112,113,114,116,127,130,137,138,140,155,159,7,11,12,16,21,22,23,24,25,30,36,38,46,64,69,72,73,74,104,105,113,114,115,116,117,148,21,23,33,36,37,38,46,57,62,72,74,78,79,80,104,105,113,114,115,117,127,128,129,130,148,156,50,57,62,64,66,78,80,87,88,89,104,105,113,114,115,116,117,127,128,129,137,138,139,140,156,160,26,27,39,40,41,42,43,47,54,58,67,96,97,98,99,100,103,118,119,120,131,132,133,134,135,157,39,41,53,54,58,65,98,100,106,107,108,111,118,119,120,131,132,133,135,141,142,143,144,145,157,161,65,67,106,108,118,120,121,122,123,126,131,132,133,134,135,141,142,143,145,149,150,151,152,153,161,162,141,151,152,157,161,162,53,98,108,109,134,144,92,137,138,147,155,159,67,131,143,144,157,161,127,139,140,148,156,160,60,137,146,154,158,56,63,83,113,114,147,78,89,90,116,130,140,57,64,104,115,116,148,106,123,124,134,144,152,8,20,21,28,44,55,17,35,44,55,104,136,18,36,45,56,63,104,21,37,46,57,64,105,42,53,96,100,101,134,31,49,87,113,127,137,65,67,118,133,134,157,108,125,126,135,145,153,43,54,97,102,103,135,26,41,42,47,58,65,39,53,58,65,67,120,63,112,127,128,147,155,34,52,55,113,136,146,51,61,127,136,146,154,64,113,129,130,148,156,54,100,110,111,135,145,82,106,107,119,132,142,76,87,88,114,128,138,36,70,78,79,114,128,5,15,21,72,104,113,14,32,78,104,113,127,1,6,11,21,69,104,3,10,11,13,28,44,11,23,24,30,46,57,22,36,68,72,73,114,9,21,22,29,45,56,24,37,69,74,75,116,37,72,80,81,116,130,143,149,152,157,161,162,53,100,106,109,134,144,94,127,138,147,155,159,67,133,141,144,157,161,129,137,140,148,156,160,61,137,146,154,158,56,63,104,112,114,147,80,87,90,116,130,140,57,64,105,113,116,148,108,121,124,134,144,152,10,17,21,28,44,55,20,34,44,55,104,136,21,36,45,56,63,83,23,37,46,57,64,104,42,53,97,98,101,134,32,48,87,113,127,137,65,67,120,131,134,157,110,123,126,135,145,153,27,39,42,47,58,65,41,53,58,65,67,118,63,92,113,128,147,155,35,51,55,113,136,146,52,60,127,136,146,154,64,115,127,130,148,156,54,102,108,111,135,145,40,82,96,99,119,132,78,85,88,114,128,138,36,72,76,79,114,128,6,14,21,72,104,113,15,31,78,104,113,127,2,5,11,21,69,104,4,8,11,13,28,44,12,21,24,30,46,57,22,36,69,70,73,114,11,18,22,29,45,56,7,24,37,72,75,116,37,74,78,81,116,130,150,152,153,157,161,162,53,107,109,111,134,144,95,138,140,147,155,159,67,142,144,145,157,161,66,138,140,148,156,160,94,137,139,146,154,158,56,63,91,114,116,147,50,88,90,116,130,140,57,64,114,116,117,148,121,123,125,133,143,151,122,124,126,134,144,152,18,21,23,28,44,55,44,55,83,104,105,136,36,37,45,56,63,84,36,37,38,46,57,64,41,98,100,102,120,133,42,53,99,101,103,134,85,87,89,113,127,137,65,67,132,134,135,157,59,124,126,135,145,153,106,108,110,120,133,143,40,42,43,47,58,65,53,54,58,65,67,119,63,93,128,130,147,155,55,112,113,115,136,146,92,127,129,136,146,154,62,64,128,130,148,156,86,88,90,114,128,138,36,77,79,81,114,128,21,70,72,74,104,113,76,78,80,104,113,127,7,11,21,68,69,104,9,11,12,13,28,44,22,24,25,30,46,57,22,36,71,73,75,114,19,22,24,29,45,56,16,24,37,73,75,116,33,37,79,81,116,130];
    C_dx = [1,5,9,13,17,25,29,33,37,41,45,49,53,57,61,65,69,73,77,85,101,21,81,89,93,105,1,5,9,13,17,25,33,37,41,45,49,53,57,65,73,77,85,21,29,61,69,81,89,93,101,105,1,5,9,13,17,25,33,41,53,57,65,73,77,85,21,29,37,81,45,49,61,69,89,93,101,105,1,5,9,13,17,25,33,41,53,57,65,21,29,61,81,37,45,49,69,73,89,93,101,105,9,13,33,37,41,45,49,53,69,73,101,1,5,17,21,25,29,57,61,81,65,77,85,89,93,105,9,13,45,49,53,73,1,5,17,21,25,29,33,37,61,77,81,41,57,65,69,85,89,93,101,105,53,73,1,5,9,17,21,25,29,37,57,61,77,81,13,33,41,45,49,65,69,85,89,93,101,105,5,9,13,29,33,37,41,45,49,53,61,69,73,101,1,17,21,25,57,65,77,81,85,89,93,105,9,13,29,37,45,49,53,73,93,1,5,17,21,25,33,41,57,61,65,69,77,81,85,89,101,105,29,53,69,73,93,1,5,17,21,25,9,13,33,37,41,45,49,57,61,65,77,81,85,89,101,105,9,13,33,37,41,45,49,53,69,73,101,1,5,17,21,25,29,57,61,65,77,81,85,89,93,105,9,13,45,49,53,73,1,5,17,21,25,29,33,37,41,57,61,65,69,77,81,85,89,93,101,105,53,73,1,5,9,13,17,21,25,29,33,37,41,45,49,57,61,65,69,77,81,85,89,93,101,105,58,86,90,98,102,106,98,58,86,90,102,106,58,86,90,98,102,106,98,58,86,90,102,106,58,86,90,98,102,106,58,90,98,102,106,98,102,58,86,90,106,58,86,90,98,102,106,98,102,58,86,90,106,58,86,90,98,102,106,58,86,90,98,102,106,58,86,98,102,90,106,58,90,98,102,106,86,58,90,98,102,106,86,98,102,58,86,90,106,58,86,90,98,102,106,98,102,58,86,90,106,58,86,90,98,102,106,98,102,58,86,90,106,58,86,90,98,102,106,58,90,98,102,106,86,98,58,86,90,102,106,58,86,98,90,102,106,58,86,90,98,102,106,98,58,86,90,102,106,98,58,86,90,102,106,58,86,90,98,102,106,58,86,90,98,102,106,98,58,86,90,102,106,58,86,98,90,102,106,58,86,90,98,102,106,58,86,98,102,90,106,58,86,90,98,102,106,58,86,90,98,102,106,98,102,58,86,90,106,58,86,90,98,102,106,98,102,58,86,90,106,98,58,86,90,102,106,67,79,91,99,103,107,99,67,79,91,103,107,79,67,91,99,103,107,99,67,79,91,103,107,67,79,91,99,103,107,67,91,99,103,107,99,103,67,79,91,107,67,79,91,99,103,107,99,103,67,79,91,107,67,79,91,99,103,107,67,79,91,99,103,107,67,79,99,103,91,107,67,91,99,103,107,79,67,91,99,103,107,79,99,103,67,79,91,107,67,79,91,99,103,107,99,103,67,79,91,107,67,79,91,99,103,107,67,79,91,99,103,107,67,91,99,103,107,79,99,79,67,91,103,107,67,79,99,91,103,107,67,79,91,99,103,107,99,67,79,91,103,107,99,67,79,91,103,107,99,79,67,91,103,107,67,79,91,99,103,107,99,67,79,91,103,107,67,79,99,91,103,107,67,79,91,99,103,107,67,79,99,103,91,107,67,79,91,99,103,107,67,79,91,99,103,107,99,103,67,79,91,107,67,79,91,99,103,107,67,99,103,79,91,107,99,67,79,91,103,107,84,92,96,100,104,108,100,84,92,96,104,108,84,92,96,100,104,108,100,84,92,96,104,108,96,84,92,100,104,108,84,92,96,100,104,108,100,104,84,92,96,108,96,84,92,100,104,108,100,104,84,92,96,108,84,92,96,100,104,108,84,92,96,100,104,108,84,92,96,100,104,108,100,104,84,92,96,108,92,96,100,104,108,84,84,92,96,100,104,108,100,84,92,96,104,108,100,104,84,92,96,108,84,92,96,100,104,108,100,104,84,92,96,108,96,84,92,100,104,108,84,92,96,100,104,108,84,92,96,100,104,108,92,96,100,104,108,84,100,84,92,96,104,108,100,84,92,96,104,108,84,92,96,100,104,108,96,100,84,92,104,108,84,92,96,100,104,108,100,84,92,96,104,108,100,84,92,96,104,108,84,92,96,100,104,108,96,100,104,84,92,108,84,92,96,100,104,108,84,92,96,100,104,108,100,104,84,92,96,108,84,92,96,100,104,108,96,100,104,84,92,108,96,100,84,92,104,108];
    M = sparse(i_dx,j_dx,C(C_dx),126,162);

    [L,~,Pi] = lu(M(:,1:67));
    Pi = Pi';
    M = [Pi*L Pi(:,68:end)]\M(:,68:end);
    M = full(M(68:end,:));

    [L,UR,Pi] = lu(M(:,1:28));
    Pi = Pi';
    M = [Pi*L Pi(:,29:end)]\M(:,29:end);
    MP = M(1:28,:);
    NP = M(29:end,:);

    [Q,U,Pi] = qr(NP(:,1:end-5));
    A = UR\[MP(:,1:end-5)*Pi MP(:,end-4:end)];
    B = U(:,1:31)\[U(:,32:end) Q'*NP(:,end-4:end)];
    M = [-A(:,end-35:end)+A(:,1:end-36)*B; -B];

    xP = [68,69,70,71,72,73,74,75,1,2,76,77,78,79,80,81,82,3,4,5,6,8,83,84,9,85,86,87,88,89,90,11,12,13,14,17,91,18,19,21,23,26,27,28,29,92,93,32,33,35,36,37,39,94,95,42,43,45,46,47,49,52,54,55,57,60,64];
    P1 = [(1:62)*Pi 63:67];
    T = getT(M,[68:95 P1(1:end-36)],P1(end-35:end),xP);

    [V,D] = eig(T);
    sol = [V([32,34,35],:)./repmat(V(36,:),3,1); diag(D).'];

    I = find(not(isnan(sol(1,:))) & not(isinf(sol(1,:))));
    %I = I(not(imag(sol(1,:)))); % uncomment this line for real roots only
    w = sol(1,I);
    y = sol(2,I);
    z = sol(3,I);
    x = sol(4,I);

end