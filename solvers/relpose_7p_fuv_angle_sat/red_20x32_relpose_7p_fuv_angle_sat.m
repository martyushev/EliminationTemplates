% Input: coefficient matrix C of size 4x22
% Output: solution matrix S of size 3x12

function S = red_20x32_relpose_7p_fuv_angle_sat(C)

    ix = [1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,11,11,11,11,11,11,11,11,11,11,11,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,13,13,13,13,13,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,16,16,16,16,16,16,16,16,16,16,16,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20];
    jx = [10,11,12,14,16,18,19,20,29,30,32,4,5,6,7,10,11,12,14,15,16,17,18,24,25,29,5,6,7,11,12,24,25,26,29,30,31,32,8,9,13,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,1,2,3,4,5,6,7,8,10,11,12,13,14,15,16,21,22,24,10,11,12,14,16,18,19,20,29,30,32,4,5,6,7,10,11,12,14,15,16,17,18,24,25,29,5,6,7,11,12,24,25,26,29,30,31,32,8,9,13,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,1,2,3,4,5,6,7,8,10,11,12,13,14,15,16,21,22,24,10,11,12,14,16,18,19,20,29,30,32,4,5,6,7,10,11,12,14,15,16,17,18,24,25,29,5,6,7,11,12,24,25,26,29,30,31,32,8,9,13,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,1,2,3,4,5,6,7,8,10,11,12,13,14,15,16,21,22,24,10,11,12,14,16,18,19,20,29,30,32,4,5,6,7,10,11,12,14,15,16,17,18,24,25,29,5,6,7,11,12,24,25,26,29,30,31,32,8,9,13,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,1,2,3,4,5,6,7,8,10,11,12,13,14,15,16,21,22,24];
    kx = [1,5,9,21,37,61,69,81,41,45,65,1,5,9,13,21,25,29,49,37,61,69,81,41,45,65,1,5,9,21,25,37,41,45,61,65,69,81,1,17,37,21,49,61,73,81,85,5,9,13,25,29,33,41,45,53,57,65,77,1,5,9,21,25,29,33,37,49,53,57,69,73,61,81,41,45,65,2,6,10,22,38,62,70,82,42,46,66,2,6,10,14,22,26,30,50,38,62,70,82,42,46,66,2,6,10,22,26,38,42,46,62,66,70,82,2,18,38,22,50,62,74,82,86,6,10,14,26,30,34,42,46,54,58,66,78,2,6,10,22,26,30,34,38,50,54,58,70,74,62,82,42,46,66,3,7,11,23,39,63,71,83,43,47,67,3,7,11,15,23,27,31,51,39,63,71,83,43,47,67,3,7,11,23,27,39,43,47,63,67,71,83,3,19,39,23,51,63,75,83,87,7,11,15,27,31,35,43,47,55,59,67,79,3,7,11,23,27,31,35,39,51,55,59,71,75,63,83,43,47,67,4,8,12,24,40,64,72,84,44,48,68,4,8,12,16,24,28,32,52,40,64,72,84,44,48,68,4,8,12,24,28,40,44,48,64,68,72,84,4,20,40,24,52,64,76,84,88,8,12,16,28,32,36,44,48,56,60,68,80,4,8,12,24,28,32,36,40,52,56,60,72,76,64,84,44,48,68];
    M = sparse(ix,jx,C(kx),20,32);

    [L,~,P] = lu(M(:,1:14));
    P = P';
    M = [P*L P(:,15:end)]\M(:,15:end);
    M = M(end-5:end,:);

    T = zeros(12);
    T([1,4,7,9,11,12],:) = -M(:,1:6)\M(:,7:end);
    T([38,51,101,114,128,142]) = 1;

    [V,~] = eig(T);
    S = V(9:11,:)./repmat(V(12,:),3,1);

    I = ~isnan(S(1,:)) & ~isinf(S(1,:));
    %I = I & ~imag(S(1,:)); % uncomment this line for real roots only
    S = S(:,I);

end