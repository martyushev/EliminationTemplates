% Input: coefficient matrix C of size 7x22
% Output: solution matrix S of size 3x14

function S = red_16x30_colpiv_relpose_7p_fuv_angle(C)

    ix = [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,9,9,9,9,9,9,9,9,9,9,9,9,9,9,10,10,10,10,10,10,10,10,10,10,11,11,11,11,11,11,11,11,11,11,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,13,13,13,14,14,14,14,14,14,14,14,14,14,15,15,15,15,15,15,15,15,15,15,16,16,16,16,16,16,16,16,16,16];
    jx = [3,4,5,6,7,8,9,10,11,16,18,22,23,25,27,28,29,30,12,13,14,15,17,18,19,20,21,22,23,24,25,26,27,28,29,30,4,5,6,7,8,9,10,11,21,22,23,25,27,28,29,30,1,2,3,4,5,6,7,9,15,16,17,21,22,24,27,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,1,2,5,7,8,10,19,20,24,25,26,29,4,5,6,7,8,9,10,11,23,25,27,28,29,30,1,2,3,4,5,6,7,9,17,21,22,24,27,15,18,19,20,21,22,23,24,25,26,27,28,29,30,1,5,7,8,10,20,24,25,26,29,6,9,10,11,21,23,27,28,29,30,4,6,7,9,15,17,21,22,24,27,16,18,21,22,23,25,27,28,29,30,5,7,8,10,19,20,24,25,26,29,3,4,5,6,12,13,15,16,19,21,13,14,16,17,18,20,22,23,25,28];
    kx = [2,37,65,86,107,121,128,142,149,16,30,51,58,79,93,100,114,135,2,16,30,37,51,58,65,79,86,93,100,107,114,121,128,135,142,149,39,67,88,109,123,130,144,151,46,53,60,81,95,102,116,137,67,81,39,88,109,130,144,151,46,53,60,95,102,116,137,39,46,53,60,67,81,88,95,102,109,116,123,130,137,144,151,39,53,88,130,144,151,46,60,95,102,116,137,40,68,89,110,124,131,145,152,61,82,96,103,117,138,68,82,40,89,110,131,145,152,61,96,103,117,138,40,61,68,82,89,96,103,110,117,124,131,138,145,152,40,89,131,145,152,61,96,103,117,138,90,132,146,153,48,62,97,104,118,139,90,132,146,153,48,62,97,104,118,139,48,62,90,97,104,118,132,139,146,153,90,132,146,153,48,62,97,104,118,139,90,132,146,153,48,62,97,104,118,139,48,62,90,97,104,118,132,139,146,153];
    M = sparse(ix,jx,C(kx),16,30);

    [L,~,P] = lu(M(:,1:2));
    P = P';
    M = [P*L P(:,3:end)]\M(:,3:end);
    M = full(M(3:end,:));

    [L,U,P] = lu(M(:,1:9));
    P = P';
    M = [P*L P(:,10:end)]\M(:,10:end);
    M1 = M(1:9,:);
    M2 = M(10:end,:);

    [Q,R,P] = qr(M2(:,1:end-4));
    A = U\[M1(:,1:end-4)*P M1(:,end-3:end)];
    B = R(:,1:5)\[R(:,6:end) Q'*M2(:,end-3:end)];
    M = [-A(:,end-13:end)+A(:,1:end-14)*B; -B];

    P1 = [20:28 (1:15)*P 16:19];
    P2 = [20,5,7,21,10,11,12,22,14,23,16,17,24,18,25,26,19,27,28];
    T = getT(M,P1(1:end-14),P1(end-13:end),P2);

    [V,~] = eig(T);
    S = V(11:13,:)./repmat(V(14,:),3,1);

    I = ~isnan(S(1,:)) & ~isinf(S(1,:));
    %I = I & ~imag(S(1,:)); % uncomment this line for real roots only
    S = S(:,I);

end