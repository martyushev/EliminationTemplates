% Input: coefficient matrix C of size 4x22
% Output: solution matrix S of size 3x7

function S = red_26x33_relpose_7p_fuv_angle(C)

    ix = [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,10,10,10,10,10,10,10,10,10,10,10,10,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,12,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,15,15,15,15,15,15,15,15,15,15,15,15,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,17,17,17,17,17,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,26,26,26,26,26,26,26,26,26,26,26];
    jx = [2,3,4,5,7,8,9,11,12,13,16,17,20,28,29,31,3,4,5,8,9,12,13,14,17,18,23,29,6,7,8,9,15,16,17,21,27,28,29,30,31,32,33,7,8,9,16,17,18,22,23,24,28,29,31,10,11,12,13,14,18,19,20,22,23,24,25,26,27,28,29,30,31,32,33,15,16,17,21,23,24,25,26,30,31,33,2,3,4,5,7,8,9,11,12,13,16,17,20,28,29,31,3,4,5,8,9,12,13,14,17,18,23,29,6,7,8,9,15,16,17,21,27,28,29,30,31,32,33,7,8,9,16,17,18,22,23,24,28,29,31,10,11,12,13,14,18,19,20,22,23,24,25,26,27,28,29,30,31,32,33,15,16,17,21,23,24,25,26,30,31,33,1,2,3,4,5,6,7,8,9,10,11,12,15,16,17,19,21,27,28,30,2,3,4,5,7,8,9,11,12,13,16,17,20,28,29,31,3,4,5,8,9,12,13,14,17,18,23,29,6,7,8,9,15,16,17,21,27,28,29,30,31,32,33,7,8,9,16,17,18,22,23,24,28,29,31,10,11,12,13,14,18,19,20,22,23,24,25,26,27,28,29,30,31,32,33,15,16,17,21,23,24,25,26,30,31,33,1,2,3,4,5,6,7,8,9,10,11,12,15,16,17,19,21,27,28,30,2,3,4,5,7,8,9,11,12,13,16,17,20,28,29,31,3,4,5,8,9,12,13,14,17,18,23,29,6,7,8,9,15,16,17,21,27,28,29,30,31,32,33,7,8,9,16,17,18,22,23,24,28,29,31,10,11,12,13,14,18,19,20,22,23,24,25,26,27,28,29,30,31,32,33,15,16,17,21,23,24,25,26,30,31,33];
    kx = [1,5,9,13,21,25,29,37,41,45,49,53,69,61,65,81,1,5,9,21,25,37,41,45,49,65,81,61,1,5,9,13,21,25,29,49,37,41,45,61,65,69,81,1,5,9,21,25,45,69,65,81,37,41,61,1,5,9,13,17,33,37,41,65,57,77,81,85,21,25,29,49,53,61,73,1,5,9,21,45,65,69,81,37,41,61,2,6,10,14,22,26,30,38,42,46,50,54,70,62,66,82,2,6,10,22,26,38,42,46,50,66,82,62,2,6,10,14,22,26,30,50,38,42,46,62,66,70,82,2,6,10,22,26,46,70,66,82,38,42,62,2,6,10,14,18,34,38,42,66,58,78,82,86,22,26,30,50,54,62,74,2,6,10,22,46,66,70,82,38,42,62,3,7,11,15,19,23,27,31,35,39,43,47,51,55,59,71,75,63,67,83,3,7,11,15,23,27,31,39,43,47,51,55,71,63,67,83,3,7,11,23,27,39,43,47,51,67,83,63,3,7,11,15,23,27,31,51,39,43,47,63,67,71,83,3,7,11,23,27,47,71,67,83,39,43,63,3,7,11,15,19,35,39,43,67,59,79,83,87,23,27,31,51,55,63,75,3,7,11,23,47,67,71,83,39,43,63,4,8,12,16,20,24,28,32,36,40,44,48,52,56,60,72,76,64,68,84,4,8,12,16,24,28,32,40,44,48,52,56,72,64,68,84,4,8,12,24,28,40,44,48,52,68,84,64,4,8,12,16,24,28,32,52,40,44,48,64,68,72,84,4,8,12,24,28,48,72,68,84,40,44,64,4,8,12,16,20,36,40,44,68,60,80,84,88,24,28,32,52,56,64,76,4,8,12,24,48,68,72,84,40,44,64];
    M = sparse(ix,jx,C(kx),26,33);

    [L,~,P] = lu(M(:,1:22));
    P = P';
    M = [P*L P(:,23:end)]\M(:,23:end);
    M = M(end-3:end,:);

    T = zeros(7);
    T([3,5,6,7],:) = -M(:,1:4)\M(:,5:end);
    T([22,30,46]) = 1;

    [V,~] = eig(T);
    S = V(4:6,:)./repmat(V(7,:),3,1);

    I = ~isnan(S(1,:)) & ~isinf(S(1,:));
    %I = I & ~imag(S(1,:)); % uncomment this line for real roots only
    S = S(:,I);

end