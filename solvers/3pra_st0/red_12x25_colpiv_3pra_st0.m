% Input: coefficient matrix C of size 7x35
% Output: solution matrix S of size 3x13

function S = red_12x25_colpiv_3pra_st0(C,ss)

    M = sparse([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12],[1,2,4,7,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,1,2,3,4,5,6,7,8,9,10,11,13,15,17,20,22,24,27,29,4,5,6,10,13,14,15,16,17,18,19,20,21,22,23,25,27,28,30,7,8,9,10,11,12,15,16,17,18,19,22,23,24,25,26,29,30,31,1,2,4,7,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,1,2,3,4,5,6,7,8,9,10,11,13,15,17,20,22,24,27,29,4,5,6,10,13,14,15,16,17,18,19,20,21,22,23,25,27,28,30,7,8,9,10,11,12,15,16,17,18,19,22,23,24,25,26,29,30,31,1,2,4,7,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,1,2,3,4,5,6,7,8,9,10,11,13,15,17,20,22,24,27,29,4,5,6,10,13,14,15,16,17,18,19,20,21,22,23,25,27,28,30,7,8,9,10,11,12,15,16,17,18,19,22,23,24,25,26,29,30,31],C([177,107,114,135,121,128,142,149,156,163,170,184,191,198,205,212,219,226,233,219,177,107,184,114,121,198,135,156,142,170,128,149,163,191,205,212,226,233,177,107,114,135,121,128,142,149,156,163,170,184,191,198,205,212,219,226,233,177,107,135,114,156,170,121,128,142,149,163,184,191,198,205,212,219,226,233,179,109,116,137,123,130,144,151,158,165,172,186,193,200,207,214,221,228,235,221,179,109,186,116,123,200,137,158,144,172,130,151,165,193,207,214,228,235,179,109,116,137,123,130,144,151,158,165,172,186,193,200,207,214,221,228,235,179,109,137,116,158,172,123,130,144,151,165,186,193,200,207,214,221,228,235,181,111,118,139,125,132,146,153,160,167,174,188,195,202,209,216,223,230,237,223,181,111,188,118,125,202,139,160,146,174,132,153,167,195,209,216,230,237,181,111,118,139,125,132,146,153,160,167,174,188,195,202,209,216,223,230,237,181,111,139,118,160,174,125,132,146,153,167,188,195,202,209,216,223,230,237]),12,35);

    M0 = sparse([1,1,1,2,2,2,3,3,3,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7,8,8,8,9,9,9,10,10,10],[18,21,25,10,14,22,2,4,8,18,21,25,11,15,23,3,7,17,4,8,18,13,16,24,1,5,19,2,8,21,6,9,20],[1,1,ss,1,1,ss,-1,-1,-2,-2*ss,-2*ss,-ss^2,1,1,ss,1,1,ss,1,1,ss,1,1,ss,1,1,ss,1,1,ss,1,1,ss],10,25);
    M = M(:,11:end)-M(:,1:10)*M0; % Schur complement reduction

    [L,~,P] = lu(M(:,1:2));
    P = P';
    M = [P*L P(:,3:end)]\M(:,3:end);
    M = full(M(3:end,:));

    [L,U,P] = lu(M(:,1:7));
    P = P';
    M = [P*L P(:,8:end)]\M(:,8:end);
    M1 = M(1:7,:);
    M2 = M(8:end,:);

    [Q,R,P] = qr(M2(:,1:end-4));
    A = U\[M1(:,1:end-4)*P M1(:,end-3:end)];
    B = R(:,1:3)\[R(:,4:end) Q'*M2(:,end-3:end)];
    M = [-A(:,end-12:end)+A(:,1:end-13)*B; -B];

    P1 = [17:23 (1:12)*P 13:16];
    P2 = [17,18,19,20,21,22,23,1,2,3,4,6,8,9,11,14];
    T = getT(M,P1(1:end-13),P1(end-12:end),P2);

    [V,~] = eig(T);
    S = V(10:12,:)./repmat(V(13,:),3,1);

    I = ~isnan(S(1,:)) & ~isinf(S(1,:));
    %I = I & ~imag(S(1,:)); % uncomment this line for real roots only
    S = S(:,I);

end