% Input: coefficient matrix C of size 10x21
% Output: solution matrix S of size 5x12

function S = red_40x52_colpiv_gp4p_scale(C)

    ix = [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40];
    jx = [20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,47,48,49,50,51,52,1,2,3,5,6,8,11,12,14,17,21,22,24,27,31,35,36,37,40,44,49,4,5,6,7,8,9,13,14,15,18,23,24,25,28,32,38,39,40,41,45,50,10,11,12,13,14,15,16,17,18,19,26,27,28,29,33,42,43,44,45,46,51,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,47,48,49,50,51,52,1,2,3,5,6,8,11,12,14,17,21,22,24,27,31,35,36,37,40,44,49,4,5,6,7,8,9,13,14,15,18,23,24,25,28,32,38,39,40,41,45,50,10,11,12,13,14,15,16,17,18,19,26,27,28,29,33,42,43,44,45,46,51,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,47,48,49,50,51,52,1,2,3,5,6,8,11,12,14,17,21,22,24,27,31,35,36,37,40,44,49,4,5,6,7,8,9,13,14,15,18,23,24,25,28,32,38,39,40,41,45,50,10,11,12,13,14,15,16,17,18,19,26,27,28,29,33,42,43,44,45,46,51,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,47,48,49,50,51,52,1,2,3,5,6,8,11,12,14,17,21,22,24,27,31,35,36,37,40,44,49,4,5,6,7,8,9,13,14,15,18,23,24,25,28,32,38,39,40,41,45,50,10,11,12,13,14,15,16,17,18,19,26,27,28,29,33,42,43,44,45,46,51,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,47,48,49,50,51,52,1,2,3,5,6,8,11,12,14,17,21,22,24,27,31,35,36,37,40,44,49,4,5,6,7,8,9,13,14,15,18,23,24,25,28,32,38,39,40,41,45,50,10,11,12,13,14,15,16,17,18,19,26,27,28,29,33,42,43,44,45,46,51,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,47,48,49,50,51,52,1,2,3,5,6,8,11,12,14,17,21,22,24,27,31,35,36,37,40,44,49,4,5,6,7,8,9,13,14,15,18,23,24,25,28,32,38,39,40,41,45,50,10,11,12,13,14,15,16,17,18,19,26,27,28,29,33,42,43,44,45,46,51,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,47,48,49,50,51,52,1,2,3,5,6,8,11,12,14,17,21,22,24,27,31,35,36,37,40,44,49,4,5,6,7,8,9,13,14,15,18,23,24,25,28,32,38,39,40,41,45,50,10,11,12,13,14,15,16,17,18,19,26,27,28,29,33,42,43,44,45,46,51,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,47,48,49,50,51,52,1,2,3,5,6,8,11,12,14,17,21,22,24,27,31,35,36,37,40,44,49,4,5,6,7,8,9,13,14,15,18,23,24,25,28,32,38,39,40,41,45,50,10,11,12,13,14,15,16,17,18,19,26,27,28,29,33,42,43,44,45,46,51,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,47,48,49,50,51,52,1,2,3,5,6,8,11,12,14,17,21,22,24,27,31,35,36,37,40,44,49,4,5,6,7,8,9,13,14,15,18,23,24,25,28,32,38,39,40,41,45,50,10,11,12,13,14,15,16,17,18,19,26,27,28,29,33,42,43,44,45,46,51,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,47,48,49,50,51,52,1,2,3,5,6,8,11,12,14,17,21,22,24,27,31,35,36,37,40,44,49,4,5,6,7,8,9,13,14,15,18,23,24,25,28,32,38,39,40,41,45,50,10,11,12,13,14,15,16,17,18,19,26,27,28,29,33,42,43,44,45,46,51];
    kx = [21,41,51,71,81,91,111,121,131,141,161,171,181,191,201,1,11,31,61,101,151,21,41,51,71,81,91,111,121,131,141,161,171,181,191,201,1,11,31,61,101,151,21,41,51,71,81,91,111,121,131,141,161,171,181,191,201,1,11,31,61,101,151,21,41,51,71,81,91,111,121,131,141,161,171,181,191,201,1,11,31,61,101,151,22,42,52,72,82,92,112,122,132,142,162,172,182,192,202,2,12,32,62,102,152,22,42,52,72,82,92,112,122,132,142,162,172,182,192,202,2,12,32,62,102,152,22,42,52,72,82,92,112,122,132,142,162,172,182,192,202,2,12,32,62,102,152,22,42,52,72,82,92,112,122,132,142,162,172,182,192,202,2,12,32,62,102,152,23,43,53,73,83,93,113,123,133,143,163,173,183,193,203,3,13,33,63,103,153,23,43,53,73,83,93,113,123,133,143,163,173,183,193,203,3,13,33,63,103,153,23,43,53,73,83,93,113,123,133,143,163,173,183,193,203,3,13,33,63,103,153,23,43,53,73,83,93,113,123,133,143,163,173,183,193,203,3,13,33,63,103,153,24,44,54,74,84,94,114,124,134,144,164,174,184,194,204,4,14,34,64,104,154,24,44,54,74,84,94,114,124,134,144,164,174,184,194,204,4,14,34,64,104,154,24,44,54,74,84,94,114,124,134,144,164,174,184,194,204,4,14,34,64,104,154,24,44,54,74,84,94,114,124,134,144,164,174,184,194,204,4,14,34,64,104,154,25,45,55,75,85,95,115,125,135,145,165,175,185,195,205,5,15,35,65,105,155,25,45,55,75,85,95,115,125,135,145,165,175,185,195,205,5,15,35,65,105,155,25,45,55,75,85,95,115,125,135,145,165,175,185,195,205,5,15,35,65,105,155,25,45,55,75,85,95,115,125,135,145,165,175,185,195,205,5,15,35,65,105,155,26,46,56,76,86,96,116,126,136,146,166,176,186,196,206,6,16,36,66,106,156,26,46,56,76,86,96,116,126,136,146,166,176,186,196,206,6,16,36,66,106,156,26,46,56,76,86,96,116,126,136,146,166,176,186,196,206,6,16,36,66,106,156,26,46,56,76,86,96,116,126,136,146,166,176,186,196,206,6,16,36,66,106,156,27,47,57,77,87,97,117,127,137,147,167,177,187,197,207,7,17,37,67,107,157,27,47,57,77,87,97,117,127,137,147,167,177,187,197,207,7,17,37,67,107,157,27,47,57,77,87,97,117,127,137,147,167,177,187,197,207,7,17,37,67,107,157,27,47,57,77,87,97,117,127,137,147,167,177,187,197,207,7,17,37,67,107,157,28,48,58,78,88,98,118,128,138,148,168,178,188,198,208,8,18,38,68,108,158,28,48,58,78,88,98,118,128,138,148,168,178,188,198,208,8,18,38,68,108,158,28,48,58,78,88,98,118,128,138,148,168,178,188,198,208,8,18,38,68,108,158,28,48,58,78,88,98,118,128,138,148,168,178,188,198,208,8,18,38,68,108,158,29,49,59,79,89,99,119,129,139,149,169,179,189,199,209,9,19,39,69,109,159,29,49,59,79,89,99,119,129,139,149,169,179,189,199,209,9,19,39,69,109,159,29,49,59,79,89,99,119,129,139,149,169,179,189,199,209,9,19,39,69,109,159,29,49,59,79,89,99,119,129,139,149,169,179,189,199,209,9,19,39,69,109,159,30,50,60,80,90,100,120,130,140,150,170,180,190,200,210,10,20,40,70,110,160,30,50,60,80,90,100,120,130,140,150,170,180,190,200,210,10,20,40,70,110,160,30,50,60,80,90,100,120,130,140,150,170,180,190,200,210,10,20,40,70,110,160,30,50,60,80,90,100,120,130,140,150,170,180,190,200,210,10,20,40,70,110,160];
    M = sparse(ix,jx,C(kx),40,52);

    [L,~,P] = lu(M(:,1:20));
    P = P';
    M = [P*L P(:,21:end)]\M(:,21:end);
    M = full(M(21:end,:));

    [L,U,P] = lu(M(:,1:14));
    P = P';
    M = [P*L P(:,15:end)]\M(:,15:end);
    M1 = M(1:14,:);
    M2 = M(15:end,:);

    [Q,R,P] = qr(M2(:,1:end-6));
    A = U\[M1(:,1:end-6)*P M1(:,end-5:end)];
    B = R(:,1:6)\[R(:,7:end) Q'*M2(:,end-5:end)];
    M = [-A(:,end-11:end)+A(:,1:end-12)*B; -B];

    P1 = [19:32 (1:12)*P 13:18];
    P2 = [15,19,20,16,21,22,23,17,24,25,26,27,18,28,29,30,31,32];
    T = getT(M,P1(1:end-12),P1(end-11:end),P2);

    [V,~] = eig(T);
    S = V(7:11,:)./repmat(V(12,:),5,1);

    I = ~isnan(S(1,:)) & ~isinf(S(1,:));
    %I = I & ~imag(S(1,:)); % uncomment this line for real roots only
    S = S(:,I);

end