% Input: coefficient matrix C of size 4x24
% Output: solution matrix S of size 4x22

function S = red_85x107_colpiv_wpnp(C)

    ix = [1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,9,9,9,9,9,9,10,10,10,10,10,10,11,11,11,11,11,11,11,12,12,12,12,12,12,12,12,13,13,13,13,13,13,14,14,14,14,14,14,14,14,14,15,15,15,15,15,15,15,15,16,16,16,16,16,16,16,16,16,17,17,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,24,24,24,24,24,24,24,25,25,25,25,25,25,25,25,26,26,26,26,26,26,27,27,27,27,27,27,27,27,28,28,28,28,28,28,29,29,29,29,29,29,29,30,30,30,30,30,30,30,31,31,31,31,31,31,31,31,31,32,32,32,32,32,32,32,32,32,33,33,33,33,33,33,34,34,34,34,34,34,34,34,34,35,35,35,35,35,35,35,35,35,36,36,36,36,36,36,37,37,37,37,37,37,37,37,37,38,38,38,38,38,38,38,38,38,39,39,39,39,39,39,39,39,39,40,40,40,40,40,40,40,40,40,41,41,41,41,41,41,41,41,41,42,42,42,42,42,42,42,42,42,43,43,43,43,43,43,43,43,43,44,44,44,44,44,44,44,44,44,45,45,45,45,45,45,45,45,45,46,46,46,46,46,46,46,46,46,47,47,47,47,47,47,47,47,47,48,48,48,48,48,48,48,48,49,49,49,49,49,49,49,49,50,50,50,50,50,50,50,51,51,51,51,51,51,51,52,52,52,52,52,52,52,52,53,53,53,53,53,54,54,54,54,54,54,54,54,54,55,55,55,55,55,55,56,56,56,56,56,56,56,56,56,57,57,57,57,57,57,57,57,57,58,58,58,58,58,58,58,58,58,59,59,59,59,59,60,60,60,60,60,60,60,60,60,61,61,61,61,61,61,61,61,61,62,62,62,62,62,62,62,62,62,63,63,63,63,63,63,63,63,63,64,64,64,64,64,64,64,64,64,65,65,65,65,65,65,65,65,65,66,66,66,66,66,66,66,66,66,67,67,67,67,67,67,67,68,68,68,68,68,68,68,69,69,69,69,69,69,69,69,69,70,70,70,70,70,70,70,71,71,71,71,71,71,71,72,72,72,72,72,72,72,72,73,73,73,73,73,73,74,74,74,74,74,74,74,74,75,75,75,75,75,75,75,76,76,76,76,76,76,76,76,76,77,77,77,77,77,77,78,78,78,78,78,78,78,78,78,79,79,79,79,79,79,79,79,80,80,80,80,80,80,80,80,80,81,81,81,81,81,81,81,81,81,82,82,82,82,82,83,83,83,83,83,83,83,83,83,84,84,84,84,84,84,84,84,84,85,85,85,85,85,85,85,85,85];
    jx = [20,25,27,31,40,44,45,54,76,25,34,36,41,42,83,84,86,92,19,24,26,30,39,53,54,57,84,23,29,32,38,54,55,58,86,12,17,26,48,55,59,87,5,13,15,24,33,89,90,92,97,3,9,18,25,56,57,60,90,6,14,16,32,35,91,92,93,100,28,37,57,58,61,92,11,25,58,59,62,93,2,8,32,60,61,63,97,22,73,86,91,99,101,102,106,10,24,61,62,65,100,50,51,54,66,72,74,77,92,101,7,51,52,55,67,76,93,102,78,80,85,92,95,103,105,106,107,57,64,66,69,79,81,86,97,105,58,66,67,70,82,84,87,100,106,61,69,70,71,88,90,93,104,107,20,27,34,45,46,55,77,3,9,25,36,80,81,84,90,1,5,19,30,47,53,56,81,21,29,35,53,54,57,84,11,25,34,85,86,87,93,17,19,26,33,54,55,58,86,6,23,48,55,59,87,2,8,32,35,89,90,92,97,4,28,56,57,60,90,10,24,33,91,92,93,100,18,25,42,57,58,61,92,72,78,80,85,94,95,96,99,103,73,79,81,86,96,97,98,101,105,15,24,60,61,63,97,47,49,50,54,60,64,74,80,98,75,82,84,87,99,100,101,102,106,16,32,61,62,65,100,50,51,53,55,61,66,76,83,101,48,51,52,54,62,67,77,85,102,83,88,90,93,103,104,105,106,107,56,58,63,64,66,69,84,89,105,57,59,65,66,67,70,86,91,106,60,62,68,69,70,71,92,95,107,25,27,31,34,40,75,76,77,86,11,34,36,41,42,82,83,85,91,24,26,30,33,39,83,84,86,92,6,23,29,32,38,85,86,87,93,5,10,13,15,33,88,89,91,95,3,9,25,42,89,90,92,97,1,5,19,24,56,57,60,90,21,32,35,57,58,61,92,17,19,33,58,59,62,93,2,8,16,32,95,97,100,104,4,60,61,63,97,72,74,77,85,92,99,101,102,106,18,42,61,62,65,100,43,45,50,51,57,66,73,86,101,44,46,51,52,58,67,75,87,102,79,81,86,91,97,103,105,106,107,15,63,65,68,104,47,54,60,64,66,69,80,92,105,53,55,61,66,67,70,83,93,106,56,58,63,69,70,71,89,100,107,25,27,31,36,40,73,74,76,84,9,34,36,41,42,79,80,83,89,5,24,26,30,39,80,81,84,90,23,29,32,35,38,83,84,86,92,12,26,33,85,86,87,93,20,25,34,54,55,58,86,6,8,14,16,35,88,89,91,95,4,28,37,89,90,92,97,11,25,42,91,92,93,100,17,19,24,33,57,58,61,92,6,32,58,59,62,93,22,73,79,91,94,96,99,103,10,15,24,95,97,100,104,72,74,77,80,92,96,98,101,105,18,42,60,61,63,97,43,45,49,50,57,64,73,81,98,7,76,83,93,99,101,102,106,44,46,50,51,58,66,75,84,101,82,84,87,89,100,103,105,106,107,16,63,65,68,104,53,55,61,64,66,69,83,90,105,48,54,62,66,67,70,85,92,106,57,59,65,69,70,71,91,97,107];
    kx = [57,65,29,9,1,85,89,93,77,57,29,9,1,65,77,85,89,93,57,65,29,9,1,85,89,93,77,29,9,65,1,85,89,93,77,1,57,9,89,85,93,77,9,1,65,57,29,77,85,89,93,9,1,57,29,85,89,93,77,29,1,65,57,9,77,85,89,93,9,1,85,89,93,77,1,9,85,89,93,77,9,1,29,85,89,93,77,1,9,57,65,77,85,89,93,1,9,85,89,93,77,85,89,57,93,1,9,29,65,77,1,85,89,57,93,9,65,77,1,9,29,57,65,77,85,89,93,57,85,89,93,1,9,29,65,77,57,85,89,93,1,9,29,65,77,57,85,89,93,1,9,29,65,77,50,22,42,86,90,94,78,50,42,62,22,78,86,90,94,50,42,62,22,86,90,94,78,50,22,42,86,90,94,78,42,50,22,78,86,90,94,62,50,22,42,86,90,94,78,42,22,90,86,94,78,50,42,62,22,78,86,90,94,42,22,86,90,94,78,42,50,22,78,86,90,94,50,22,42,86,90,94,78,22,42,50,62,78,82,86,90,94,22,42,50,62,78,82,86,90,94,42,22,86,90,94,78,50,86,90,62,82,94,22,42,78,22,42,50,62,78,82,86,90,94,42,22,86,90,94,78,86,90,50,62,82,94,22,42,78,62,86,90,50,82,94,22,42,78,22,42,50,62,78,82,86,90,94,50,62,82,86,90,94,22,42,78,50,62,82,86,90,94,22,42,78,50,62,82,86,90,94,22,42,78,71,35,15,55,7,79,87,91,95,55,35,15,7,71,79,87,91,95,71,35,15,55,7,79,87,91,95,55,35,15,71,7,79,87,91,95,15,55,7,71,35,79,87,91,95,15,7,35,55,79,87,91,95,15,7,35,55,87,91,95,79,15,55,7,87,91,95,79,35,15,7,87,91,95,79,15,7,55,35,79,87,91,95,7,87,91,95,79,7,15,35,55,71,79,87,91,95,15,7,87,91,95,79,15,35,87,91,71,95,7,55,79,15,35,87,91,71,95,7,55,79,7,15,35,55,71,79,87,91,95,7,87,91,95,79,15,35,71,87,91,95,7,55,79,15,35,71,87,91,95,7,55,79,15,35,71,87,91,95,7,55,79,76,40,28,48,20,80,88,92,96,48,40,28,20,76,80,88,92,96,48,76,40,28,20,80,88,92,96,40,28,76,48,20,80,88,92,96,20,28,48,80,88,92,96,28,48,20,88,92,96,80,40,48,20,76,28,80,88,92,96,48,28,20,80,88,92,96,20,28,48,80,88,92,96,40,28,48,20,88,92,96,80,20,48,88,92,96,80,20,28,48,76,80,88,92,96,20,48,28,80,88,92,96,20,28,40,48,76,80,88,92,96,28,20,88,92,96,80,28,40,88,92,76,96,20,48,80,20,28,48,76,80,88,92,96,28,40,88,92,76,96,20,48,80,20,28,40,48,76,80,88,92,96,20,88,92,96,80,28,40,76,88,92,96,20,48,80,40,28,76,88,92,96,20,48,80,28,40,76,88,92,96,20,48,80];
    M = sparse(ix,jx,C(kx),85,107);

    [L,~,P] = lu(M(:,1:52));
    P = P';
    M = [P*L P(:,53:end)]\M(:,53:end);
    M = full(M(53:end,:));

    [L,U,P] = lu(M(:,1:19));
    P = P';
    M = [P*L P(:,20:end)]\M(:,20:end);
    M1 = M(1:19,:);
    M2 = M(20:end,:);

    [Q,R,P] = qr(M2(:,1:end-5));
    A = U\[M1(:,1:end-5)*P M1(:,end-4:end)];
    B = R(:,1:14)\[R(:,15:end) Q'*M2(:,end-4:end)];
    M = [-A(:,end-21:end)+A(:,1:end-22)*B; -B];

    P1 = [37:55 (1:31)*P 32:36];
    P2 = [12,13,37,15,38,39,17,18,19,40,20,21,41,22,42,43,24,26,44,29,45,46,32,33,34,47,48,35,49,50,51,36,52,53,54,55];
    T = getT(M,P1(1:end-22),P1(end-21:end),P2);

    [V,~] = eig(T);
    S = V(18:21,:)./repmat(V(22,:),4,1);

    I = ~isnan(S(1,:)) & ~isinf(S(1,:));
    %I = I & ~imag(S(1,:)); % uncomment this line for real roots only
    S = S(:,I);

end