% Input: coefficient matrix C of size 4x18
% Output: solution matrix S of size 4x21

function S = red_63x84_colpiv_pose_quiver(C)

    ix = [1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,9,9,9,9,9,9,9,9,9,9,9,10,10,10,10,10,10,10,10,10,10,10,10,11,11,11,11,11,11,11,11,11,11,11,11,12,12,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,13,13,13,13,13,14,14,14,14,14,14,14,14,14,14,15,15,15,15,15,15,15,15,15,15,16,16,16,16,16,16,16,16,16,16,17,17,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,25,25,25,25,25,25,25,25,25,25,26,26,26,26,26,26,26,26,26,26,27,27,27,27,27,27,27,27,27,27,28,28,28,28,28,28,28,28,28,28,29,29,29,29,29,29,29,29,29,29,30,30,30,30,30,30,30,30,30,30,31,31,31,31,31,31,31,31,31,32,32,32,32,32,32,32,32,32,32,33,33,33,33,33,33,33,33,33,33,34,34,34,34,34,34,34,34,34,34,35,35,35,35,35,35,35,35,35,35,36,36,36,36,36,36,36,36,36,36,37,37,37,37,37,37,37,37,37,38,38,38,38,38,38,38,38,38,39,39,39,39,39,39,39,39,39,39,40,40,40,40,40,40,40,40,40,40,41,41,41,41,41,41,41,41,41,41,42,42,42,42,42,42,42,42,42,42,43,43,43,43,43,43,43,43,43,44,44,44,44,44,44,44,44,44,44,45,45,45,45,45,45,45,45,45,45,46,46,46,46,46,46,46,46,46,46,47,47,47,47,47,47,47,47,47,47,48,48,48,48,48,48,48,48,48,49,49,49,49,49,50,50,50,50,50,50,50,50,50,50,51,51,51,51,51,51,51,51,51,51,52,52,52,52,52,52,52,52,52,52,53,53,53,53,53,53,53,53,53,53,54,54,54,54,54,54,54,54,54,54,55,55,55,55,55,55,55,55,55,55,56,56,56,56,56,56,56,56,56,56,57,57,57,57,57,57,57,57,57,57,58,58,58,58,58,58,58,58,58,58,59,59,59,59,59,59,59,59,59,59,60,60,60,60,60,60,60,60,60,60,61,61,61,61,61,61,61,61,61,61,62,62,62,62,62,62,62,62,62,62,63,63,63,63,63,63,63,63,63,63];
    jx = [12,15,19,22,57,58,59,62,71,72,77,83,6,9,17,20,28,30,37,39,44,59,64,72,29,33,36,38,39,40,45,48,60,65,73,83,60,63,65,68,71,73,74,75,76,79,80,82,38,40,43,45,46,47,50,51,73,76,79,84,13,16,37,39,44,46,49,72,75,78,1,7,71,72,77,78,81,82,83,84,2,4,10,14,27,28,36,37,43,57,59,71,5,8,18,36,37,43,44,48,71,72,77,24,25,28,31,33,34,40,44,52,54,62,65,52,53,54,55,59,65,66,68,69,70,76,78,25,26,30,32,34,35,42,46,54,56,67,70,33,34,37,40,41,42,47,49,65,70,76,81,2,3,43,44,48,49,51,77,78,82,18,23,57,58,59,62,71,72,77,83,29,33,37,38,40,45,60,65,73,77,9,30,31,39,41,46,64,69,75,8,11,37,39,44,46,49,72,75,78,1,20,58,61,62,66,74,81,83,84,3,21,71,72,77,78,81,82,83,84,6,7,27,28,36,37,43,57,59,71,16,19,36,37,43,44,48,71,72,77,24,25,30,33,34,40,52,54,65,72,52,53,54,55,64,65,68,70,76,81,38,40,44,45,47,50,73,76,79,82,25,26,31,34,35,42,54,56,70,75,10,21,28,30,37,39,44,59,64,72,13,22,59,62,64,67,72,75,78,81,60,63,65,68,72,73,76,79,80,84,33,34,39,40,42,47,65,70,76,78,17,43,44,48,49,51,77,78,82,12,13,58,61,62,66,74,81,83,84,11,18,71,72,77,78,81,82,83,84,15,16,27,28,36,37,43,57,59,71,7,17,36,37,43,44,48,71,72,77,38,40,45,47,49,50,73,76,77,79,22,30,31,39,41,46,64,69,75,21,37,39,44,46,49,72,75,78,25,26,34,35,41,42,54,56,64,70,14,21,57,58,59,62,71,72,77,83,8,23,28,30,37,39,44,59,64,72,29,33,38,40,44,45,60,65,71,73,20,59,62,64,67,72,75,78,81,60,63,65,68,73,76,78,79,80,83,33,34,40,42,46,47,65,70,72,76,24,25,33,34,39,40,52,54,59,65,52,53,54,55,62,65,68,70,75,76,19,43,44,48,49,51,77,78,82,2,3,11,17,19,71,72,74,75,77,78,81,82,83,84,38,40,42,45,47,50,73,76,79,80,27,28,30,36,37,43,57,58,59,71,30,31,32,39,41,46,64,67,69,75,36,37,39,43,44,48,71,72,77,83,2,4,5,6,7,10,14,15,16,23,37,39,41,44,46,49,72,75,78,81,57,58,59,61,62,64,71,72,77,83,28,30,31,37,39,44,59,62,64,72,29,33,34,38,40,45,60,63,65,73,59,62,64,66,67,69,72,75,78,81,33,34,35,40,42,47,65,68,70,76,24,25,26,33,34,40,52,53,54,65,43,44,46,48,49,51,77,78,82,84];
    kx = [5,17,53,1,49,45,41,33,65,57,69,61,17,1,53,5,49,41,65,57,69,45,33,61,49,41,17,65,1,57,69,53,45,33,61,5,49,45,41,33,17,65,5,1,57,69,61,53,49,41,17,65,1,57,69,53,45,33,61,5,5,17,49,41,65,57,69,45,33,61,5,17,49,41,65,57,33,69,45,61,53,17,1,5,49,41,65,57,69,45,33,61,17,1,5,49,41,65,57,69,45,33,61,49,41,17,1,65,57,69,53,45,33,5,61,49,45,41,33,17,65,5,61,1,57,69,53,49,41,17,1,65,57,69,53,45,33,5,61,49,41,17,65,1,57,69,53,45,33,61,5,17,5,49,41,65,57,69,45,33,61,30,10,50,46,42,34,66,58,70,62,50,42,10,66,58,70,46,34,62,30,10,50,42,66,58,70,46,34,62,10,30,50,42,66,58,70,46,34,62,30,10,50,46,42,34,62,58,66,70,30,10,50,42,66,58,34,70,46,62,10,30,50,42,66,58,70,46,34,62,10,30,50,42,66,58,70,46,34,62,50,42,10,66,58,70,46,34,62,30,50,46,42,34,10,66,62,58,70,30,50,42,10,66,58,70,46,34,62,30,50,42,10,66,58,70,46,34,62,30,10,30,50,42,66,58,70,46,34,62,30,10,50,46,42,34,66,58,70,62,50,46,42,34,10,66,58,70,62,30,50,42,10,66,58,70,46,34,62,30,10,50,42,66,58,70,46,34,62,15,23,51,47,43,35,63,59,67,71,23,15,51,43,67,59,35,71,47,63,15,23,51,43,67,59,71,47,35,63,15,23,51,43,67,59,71,47,35,63,51,43,67,59,23,71,47,35,15,63,15,51,43,67,59,71,47,35,63,15,51,43,67,59,71,47,35,63,51,43,67,59,23,71,47,35,15,63,15,23,51,47,43,35,67,59,71,63,23,15,51,43,67,59,71,47,35,63,51,43,67,59,23,71,47,35,15,63,15,51,47,43,35,67,59,71,63,51,47,43,35,67,59,23,71,63,15,51,43,67,59,23,71,47,35,15,63,51,43,67,59,23,71,47,35,15,63,51,47,43,35,15,67,63,59,23,71,15,51,43,67,59,71,47,35,63,52,40,36,44,48,52,44,40,28,68,60,36,72,48,64,52,44,28,68,60,72,48,36,64,40,52,44,28,68,60,72,48,40,36,64,52,44,28,68,60,72,48,40,36,64,52,44,28,68,60,72,48,36,64,40,72,52,68,44,64,28,40,48,60,36,52,44,28,68,60,72,48,36,64,40,52,48,44,40,36,28,68,60,72,64,52,44,28,68,60,72,48,40,36,64,52,44,28,68,60,72,48,40,36,64,52,48,44,40,36,28,68,60,72,64,52,44,28,68,60,72,48,40,36,64,52,44,28,68,60,72,48,40,36,64,52,44,28,68,60,72,48,36,64,40];
    M = sparse(ix,jx,C(kx),63,84);

    [L,~,P] = lu(M(:,1:32));
    P = P';
    M = [P*L P(:,33:end)]\M(:,33:end);
    M = full(M(33:end,:));

    [L,U,P] = lu(M(:,1:19));
    P = P';
    M = [P*L P(:,20:end)]\M(:,20:end);
    M1 = M(1:19,:);
    M2 = M(20:end,:);

    [Q,R,P] = qr(M2(:,1:end-5));
    A = U\[M1(:,1:end-5)*P M1(:,end-4:end)];
    B = R(:,1:12)\[R(:,13:end) Q'*M2(:,end-4:end)];
    M = [-A(:,end-20:end)+A(:,1:end-21)*B; -B];

    P1 = [34:52 (1:28)*P 29:33];
    P2 = [34,14,35,19,36,37,20,38,39,32,21,22,40,41,30,24,25,42,43,44,45,46,33,47,48,49,50,51,28,27,52,26,31];
    T = getT(M,P1(1:end-21),P1(end-20:end),P2);

    [V,~] = eig(T);
    S([2,4],:) = V([18,20],:)./repmat(V(21,:),2,1);
    S([1,3],:) = repmat(V(21,:),2,1)./V([17,19],:);

    I = ~isnan(S(1,:)) & ~isinf(S(1,:));
    %I = I & ~imag(S(1,:)); % uncomment this line for real roots only
    S = S(:,I);

end