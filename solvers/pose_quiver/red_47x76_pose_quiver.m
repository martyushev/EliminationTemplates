% Input: coefficient matrix C of size 4x18
% Output: solution matrix S of size 4x29

function S = red_47x76_pose_quiver(C)

    M = sparse([1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,9,9,9,9,9,9,9,9,9,9,10,10,10,10,10,10,10,10,10,10,11,11,11,11,11,11,11,11,11,11,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,13,13,13,14,14,14,14,14,14,14,14,14,14,15,15,15,15,15,15,15,15,15,15,16,16,16,16,16,16,16,16,16,16,17,17,17,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,25,25,25,25,25,25,25,25,25,25,26,26,26,26,26,26,26,26,26,26,27,27,27,27,27,27,27,27,27,27,28,28,28,28,28,28,28,28,28,28,29,29,29,29,29,29,29,29,29,29,30,30,30,30,30,30,30,30,30,30,31,31,31,31,31,31,31,31,31,31,32,32,32,32,32,32,32,32,32,32,33,33,33,33,33,33,33,33,33,33,34,34,34,34,34,34,34,34,34,34,35,35,35,35,35,35,35,35,35,35,36,36,36,36,36,36,36,36,36,36,37,37,37,37,37,37,37,37,37,37,38,38,38,38,38,38,38,38,38,38,39,39,39,39,39,39,39,39,39,39,40,40,40,40,40,40,40,40,40,40,41,41,41,41,41,41,41,41,41,41,42,42,42,42,42,42,42,42,42,42,43,43,43,43,43,43,43,43,43,43,44,44,44,44,44,44,44,44,44,44,45,45,45,45,45,45,45,45,45,45,46,46,46,46,46,46,46,46,46,46,47,47,47,47,47,47,47,47,47,47],[12,15,27,33,35,37,38,42,43,56,71,73,10,18,26,30,34,36,41,42,50,54,64,76,7,12,15,18,25,28,32,37,38,39,59,68,5,10,13,16,17,24,30,36,37,50,57,75,4,9,12,29,30,31,34,35,46,49,54,74,3,7,8,12,13,14,18,22,23,32,33,63,2,4,7,9,10,11,15,30,31,44,50,60,1,2,3,4,5,6,10,11,12,17,21,52,18,27,37,42,44,46,59,67,69,73,13,18,21,22,25,37,44,59,62,66,12,15,35,37,38,42,47,56,61,73,10,30,34,36,41,46,50,54,59,64,32,38,56,59,60,68,70,73,74,76,7,12,15,18,32,37,38,45,53,59,5,10,16,17,22,30,36,44,50,57,4,9,29,30,31,34,38,42,49,54,14,22,32,38,52,59,60,63,67,75,11,31,49,50,51,54,55,60,72,73,3,7,12,13,14,18,22,32,40,48,2,4,9,10,11,30,31,32,37,50,6,11,17,19,31,50,51,52,58,59,1,2,4,5,6,10,11,14,17,18,18,25,37,42,44,46,59,69,70,73,13,18,21,22,23,37,44,59,66,67,12,15,35,37,38,42,45,56,65,73,10,30,34,36,41,44,50,54,64,73,32,38,56,59,60,67,71,73,74,76,7,12,15,18,32,37,38,40,59,61,5,10,16,17,21,30,36,50,57,59,4,9,29,30,31,34,37,49,54,56,14,22,32,38,52,59,60,62,68,75,11,31,49,50,51,54,55,59,72,74,3,7,12,13,14,18,20,22,32,53,2,4,9,10,11,18,30,31,38,50,6,11,17,19,22,31,50,51,58,60,1,2,4,5,6,10,11,13,17,32,18,26,37,42,44,46,59,69,73,76,13,18,21,22,24,37,44,59,66,75,12,15,35,37,38,42,46,56,73,74,27,33,39,43,45,47,61,65,70,71,7,12,15,18,32,37,38,44,59,60,4,9,29,30,31,34,41,49,54,55,25,28,33,39,40,45,53,61,67,68,3,7,12,13,14,18,21,22,32,52,2,4,9,10,11,30,31,36,50,51,8,20,23,28,33,40,48,53,62,63,1,2,4,5,6,10,11,16,17,19],C([49,65,5,17,69,45,41,61,53,57,1,33,49,17,5,65,69,45,61,53,41,57,33,1,49,65,69,45,5,17,41,61,57,53,33,1,49,65,17,45,41,5,69,61,53,57,33,1,49,65,17,69,45,41,61,53,5,57,33,1,49,65,17,69,45,41,61,33,5,57,53,1,49,65,17,69,45,41,53,61,57,5,33,1,49,65,17,69,45,41,61,57,53,33,5,1,50,30,66,70,46,62,42,10,34,58,50,66,46,42,30,70,62,58,10,34,50,66,70,46,42,62,30,58,10,34,50,66,70,46,62,30,42,58,10,34,50,66,70,46,42,10,30,62,58,34,50,66,70,46,42,62,58,30,10,34,50,66,46,42,10,70,62,30,58,34,50,66,70,46,42,62,10,30,58,34,50,46,66,70,42,62,58,10,30,34,50,66,70,46,42,62,58,10,34,30,50,66,70,46,42,62,34,58,30,10,50,66,70,46,42,62,58,10,30,34,50,66,46,42,70,62,58,10,34,30,50,66,70,46,42,62,58,10,34,30,51,15,67,71,47,63,43,35,23,59,51,67,47,43,15,71,63,59,35,23,51,67,71,47,43,63,15,59,23,35,51,67,71,47,63,15,43,59,35,23,51,67,71,47,43,15,23,63,59,35,51,67,71,47,43,63,59,15,35,23,51,67,47,43,15,71,63,59,35,23,51,67,71,47,43,63,15,59,35,23,51,47,67,71,43,63,59,15,23,35,51,67,71,47,43,63,59,15,35,23,51,67,71,47,43,63,15,35,59,23,51,67,71,47,43,15,63,59,23,35,51,67,47,43,15,71,63,59,35,23,51,67,71,47,43,63,59,15,35,23,52,40,68,72,48,64,44,36,60,28,52,68,48,44,40,72,64,60,36,28,52,68,72,48,44,64,40,60,36,28,40,52,68,72,48,64,44,60,36,28,52,68,72,48,44,64,60,40,36,28,52,68,72,48,44,64,40,60,36,28,40,52,68,72,48,64,44,60,36,28,52,68,72,48,44,64,40,36,60,28,52,68,72,48,44,64,60,40,36,28,52,48,40,68,72,64,44,60,36,28,52,68,72,48,44,64,60,40,36,28]),47,76);

    [L,~,P] = lu(M(:,1:27));
    P = P';
    M = [P*L P(:,28:end)]\M(:,28:end);
    M = M(end-19:end,:);

    T0 = zeros(29);
    T0([1,2,3,4,5,6,7,9,10,12,13,14,15,17,26,18,19,20,22,23],:) = -M(:,21:end);
    T0([37,69,161,398,517,199,259,347,754]) = 1;
    T1 = zeros(29);
    T1([1,2,3,4,5,6,7,9,10,12,13,14,15,17,26,18,19,20,22,23],[1,2,3,4,5,6,7,9,10,12,13,14,15,17,26,18,19,20,22,23]) = M(:,1:20);
    T1([211,301,451,601,691,721,781,811,841]) = 1;

    [V,~] = eig(T0,T1);
    S(4,:) = V(28,:)./V(29,:);
    S([1,2,3],:) = repmat(V(29,:),3,1)./V([25,26,27],:);

    I = ~any(isnan(S)) & ~any(isinf(S));
    %I = I & ~any(imag(S)); % uncomment this line for real roots only
    S = S(:,I);

end