% Input: coefficient matrix C of size 4x18
% Output: solution matrix S of size 4x30

function S = red_50x80_colpiv_pose_quiver(C)

    ix = [1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,9,9,9,9,9,9,9,9,9,9,9,9,10,10,10,10,10,10,10,10,10,10,10,10,11,11,11,11,11,11,11,11,11,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,13,13,13,14,14,14,14,14,14,14,14,14,14,15,15,15,15,15,15,15,15,15,15,16,16,16,16,16,16,16,16,16,16,17,17,17,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,25,25,25,25,25,25,25,25,25,25,26,26,26,26,26,26,26,26,26,26,27,27,27,27,27,27,27,27,27,27,28,28,28,28,28,28,28,28,28,28,29,29,29,29,29,29,29,29,29,29,30,30,30,30,30,30,30,30,30,30,31,31,31,31,31,31,31,31,31,31,32,32,32,32,32,32,32,32,32,32,33,33,33,33,33,33,33,33,33,33,34,34,34,34,34,34,34,34,34,35,35,35,35,35,35,35,35,35,35,36,36,36,36,36,36,36,36,36,36,37,37,37,37,37,37,37,37,37,37,38,38,38,38,38,38,38,38,38,38,39,39,39,39,39,39,39,39,39,39,40,40,40,40,40,40,40,40,40,40,41,41,41,41,41,41,41,41,41,41,42,42,42,42,42,42,42,42,42,42,43,43,43,43,43,43,43,43,43,43,44,44,44,44,44,44,44,44,44,44,45,45,45,45,45,45,45,45,45,45,46,46,46,46,46,46,46,46,46,46,47,47,47,47,47,47,47,47,47,47,48,48,48,48,48,48,48,48,48,48,49,49,49,49,49,49,49,49,49,49,50,50,50,50,50,50,50,50,50,50];
    jx = [7,9,13,16,27,29,32,39,43,47,62,67,8,10,14,17,28,29,33,39,44,63,66,79,13,16,27,30,37,39,40,42,48,55,70,74,14,17,28,31,38,39,41,42,49,71,73,80,15,18,19,23,29,32,33,39,50,56,58,72,2,9,11,16,20,30,32,34,40,45,65,69,3,10,12,17,21,31,33,36,41,46,69,77,4,18,22,23,25,32,34,35,40,53,61,73,5,19,23,24,26,33,35,36,41,54,60,74,29,32,33,35,39,40,41,42,64,68,75,78,1,6,27,28,37,38,42,63,70,7,9,13,16,27,29,32,39,51,64,8,10,14,17,28,29,33,39,46,72,13,16,27,30,37,39,40,42,65,72,14,17,28,31,38,39,41,42,52,75,15,18,19,23,29,32,33,39,54,66,9,11,16,20,30,32,34,40,55,66,10,12,17,21,31,33,36,41,74,79,18,22,23,25,32,34,35,40,57,68,19,23,24,26,33,35,36,41,58,69,29,32,33,35,39,40,41,42,67,73,1,6,27,28,37,38,42,62,71,7,9,13,16,27,29,32,39,45,72,8,10,14,17,28,29,33,39,52,64,14,17,28,31,38,39,41,42,72,77,13,16,27,30,37,39,40,42,51,75,15,18,19,23,29,32,33,39,53,67,9,11,16,20,30,32,34,40,47,73,10,12,17,21,31,33,36,41,67,80,18,22,23,25,32,34,35,40,56,69,19,23,24,26,33,35,36,41,57,78,46,52,59,67,74,76,77,78,79,80,29,32,33,35,39,40,41,42,66,74,1,6,27,28,30,31,37,38,42,7,9,11,13,16,27,29,32,33,39,8,10,12,14,17,28,29,32,33,39,15,18,19,22,23,24,29,32,33,39,43,45,47,48,51,62,64,66,67,72,44,46,49,52,63,64,66,67,72,79,48,51,55,62,65,70,72,73,74,75,49,52,63,71,72,73,74,75,77,80,50,53,54,56,57,58,64,66,67,72,2,45,47,51,55,65,66,68,69,73,13,16,20,27,30,37,39,40,41,42,14,17,21,28,31,38,39,40,41,42,64,66,67,68,69,72,73,74,75,78,3,46,52,67,69,74,77,78,79,80,4,53,56,57,60,61,66,68,69,73,5,54,57,58,60,61,67,69,74,78,29,32,33,34,35,36,39,40,41,42];
    kx = [49,45,65,61,69,41,33,57,17,5,53,1,49,41,65,57,69,45,33,61,17,53,5,1,49,45,65,61,69,41,33,57,17,5,53,1,49,41,65,57,69,45,33,61,17,53,5,1,49,45,41,33,65,61,57,69,17,5,1,53,5,49,45,65,61,69,41,33,57,17,53,1,1,49,41,65,57,69,45,33,61,17,5,53,5,49,45,41,33,65,61,57,69,17,1,53,1,49,45,41,33,65,61,57,69,17,5,53,49,45,41,33,65,61,57,69,17,5,53,1,50,66,46,42,62,58,34,10,30,50,46,66,62,70,42,34,58,30,10,50,42,66,58,70,46,34,62,10,30,50,46,66,62,70,42,34,58,30,10,50,42,66,58,70,46,34,62,10,30,50,46,42,34,66,62,58,70,10,30,50,46,66,62,70,42,34,58,30,10,50,42,66,58,70,46,34,62,30,10,50,46,42,34,66,62,58,70,10,30,50,46,42,34,66,62,58,70,10,30,50,46,42,34,66,62,58,70,10,30,51,67,47,43,63,59,35,15,23,51,47,67,63,71,43,35,59,15,23,51,43,67,59,71,47,35,63,23,15,51,43,67,59,71,47,35,63,15,23,51,47,67,63,71,43,35,59,15,23,51,47,43,35,67,63,59,71,15,23,51,47,67,63,71,43,35,59,15,23,51,43,67,59,71,47,35,63,15,23,51,47,43,35,67,63,59,71,15,23,51,47,43,35,67,63,59,71,15,23,51,67,15,47,63,23,71,35,43,59,51,47,43,35,67,63,59,71,15,23,52,68,48,44,40,28,64,60,36,52,48,40,68,64,72,44,36,28,60,52,44,28,68,60,72,48,40,36,64,52,48,44,40,36,28,68,64,60,72,52,48,40,68,64,72,44,36,28,60,52,44,68,60,72,48,40,36,64,28,52,48,40,68,64,72,44,36,28,60,52,44,68,72,48,40,36,64,60,28,52,48,44,40,36,28,68,64,60,72,40,52,48,68,64,72,44,36,28,60,52,48,40,68,64,72,44,36,28,60,52,44,28,68,60,72,48,40,36,64,52,48,44,40,36,68,64,60,72,28,28,52,68,48,40,64,72,36,44,60,40,52,48,44,36,28,68,64,60,72,28,52,48,44,40,36,68,64,72,60,52,48,44,40,36,28,68,64,60,72];
    M = sparse(ix,jx,C(kx),50,80);

    [L,~,P] = lu(M(:,1:6));
    P = P';
    M = [P*L P(:,7:end)]\M(:,7:end);
    M = full(M(7:end,:));

    [L,U,P] = lu(M(:,1:36));
    P = P';
    M = [P*L P(:,37:end)]\M(:,37:end);
    M1 = M(1:36,:);
    M2 = M(37:end,:);

    [Q,R,P] = qr(M2(:,1:end-5));
    A = U\[M1(:,1:end-5)*P M1(:,end-4:end)];
    B = R(:,1:8)\[R(:,9:end) Q'*M2(:,end-4:end)];
    M = [-A(:,end-29:end)+A(:,1:end-30)*B; -B];

    P1 = [39:74 (1:33)*P 34:38];
    P2 = [39,40,41,42,43,45,46,47,48,49,50,51,52,54,55,56,25,57,58,59,60,61,62,64,65,66,67,69,70,71,72,73,74,38,63,68,44,53];
    T = getT(M,P1(1:end-30),P1(end-29:end),P2);

    [V,~] = eig(T);
    S([1,3,4],:) = V([26,28,29],:)./repmat(V(30,:),3,1);
    S(2,:) = V(30,:)./V(27,:);

    I = ~isnan(S(1,:)) & ~isinf(S(1,:));
    %I = I & ~imag(S(1,:)); % uncomment this line for real roots only
    S = S(:,I);

end