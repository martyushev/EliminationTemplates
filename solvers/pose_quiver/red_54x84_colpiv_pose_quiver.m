% Input: coefficient matrix C of size 4x18
% Output: solution matrix S of size 4x30

function S = red_54x84_colpiv_pose_quiver(C)

    ix = [1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,9,9,9,9,9,9,9,9,9,9,9,9,10,10,10,10,10,10,10,10,10,10,10,10,11,11,11,11,11,11,11,11,11,11,11,11,12,12,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,13,13,13,14,14,14,14,14,14,14,14,14,14,15,15,15,15,15,15,15,15,15,15,16,16,16,16,16,16,16,16,16,16,17,17,17,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,25,25,25,25,25,25,25,25,25,25,26,26,26,26,26,26,26,26,26,26,27,27,27,27,27,27,27,27,27,27,28,28,28,28,28,28,28,28,28,28,29,29,29,29,29,29,29,29,29,29,30,30,30,30,30,30,30,30,30,30,31,31,31,31,31,31,31,31,31,31,32,32,32,32,32,32,32,32,32,32,33,33,33,33,33,33,33,33,33,33,34,34,34,34,34,34,34,34,34,34,35,35,35,35,35,35,35,35,35,35,36,36,36,36,36,36,36,36,36,36,37,37,37,37,37,37,37,37,37,37,38,38,38,38,38,38,38,38,38,38,39,39,39,39,39,39,39,39,39,39,40,40,40,40,40,40,40,40,40,40,41,41,41,41,41,41,41,41,41,41,42,42,42,42,42,42,42,42,42,42,43,43,43,43,43,43,43,43,43,43,44,44,44,44,44,44,44,44,44,44,45,45,45,45,45,45,45,45,45,45,46,46,46,46,46,46,46,46,46,46,47,47,47,47,47,47,47,47,47,47,48,48,48,48,48,48,48,48,48,48,49,49,49,49,49,49,49,49,49,49,50,50,50,50,50,50,50,50,50,50,51,51,51,51,51,51,51,51,51,51,52,52,52,52,52,52,52,52,52,52,53,53,53,53,53,53,53,53,53,53,54,54,54,54,54,54,54,54,54,54];
    jx = [1,3,6,21,22,24,27,48,52,54,57,61,2,4,7,23,24,25,29,49,54,55,58,63,45,47,50,54,57,58,59,60,61,63,66,70,18,20,24,26,27,29,32,56,61,63,66,70,5,7,10,27,28,30,33,57,62,64,67,71,6,8,11,29,30,31,35,58,64,65,68,73,52,55,59,64,67,68,69,70,71,73,76,80,22,25,30,32,33,35,38,66,71,73,76,80,9,11,13,33,34,36,39,67,72,74,77,81,10,12,14,35,36,37,40,68,74,75,78,82,62,65,69,74,77,78,79,80,81,82,83,84,28,31,36,38,39,40,41,76,81,82,83,84,2,16,18,19,21,42,45,46,48,51,3,17,19,20,23,43,46,47,49,53,6,19,22,24,27,45,52,54,57,61,7,20,24,25,29,46,54,55,58,63,48,53,54,57,58,59,61,63,66,70,23,24,27,29,32,51,61,63,66,70,10,24,28,30,33,52,62,64,67,71,11,25,30,31,35,54,64,65,68,73,57,63,64,67,68,69,71,73,76,80,29,30,33,35,38,61,71,73,76,80,13,30,34,36,39,62,72,74,77,81,14,31,36,37,40,64,74,75,78,82,67,73,74,77,78,79,81,82,83,84,35,36,39,40,41,71,81,82,83,84,2,15,18,19,21,43,45,46,48,51,3,16,19,20,23,44,46,47,49,53,6,18,22,24,27,46,52,54,57,61,7,19,24,25,29,47,54,55,58,63,49,51,54,57,58,59,61,63,66,70,21,24,27,29,32,53,61,63,66,70,10,22,28,30,33,54,62,64,67,71,11,24,30,31,35,55,64,65,68,73,58,61,64,67,68,69,71,73,76,80,27,30,33,35,38,63,71,73,76,80,13,28,34,36,39,64,72,74,77,81,14,30,36,37,40,65,74,75,78,82,68,71,74,77,78,79,81,82,83,84,33,36,39,40,41,73,81,82,83,84,1,2,3,18,19,21,45,46,48,51,2,3,4,19,20,23,46,47,49,53,45,46,47,48,49,50,51,53,56,60,18,19,20,21,23,26,51,53,56,60,5,6,7,22,24,27,52,54,57,61,6,7,8,24,25,29,54,55,58,63,52,54,55,57,58,59,61,63,66,70,22,24,25,27,29,32,61,63,66,70,9,10,11,28,30,33,62,64,67,71,10,11,12,30,31,35,64,65,68,73,62,64,65,67,68,69,71,73,76,80,28,30,31,33,35,38,71,73,76,80,72,74,75,77,78,79,81,82,83,84,34,36,37,39,40,41,81,82,83,84];
    kx = [1,5,33,53,57,61,69,17,41,45,49,65,1,5,33,53,57,61,69,17,41,45,49,65,1,5,17,33,41,45,49,53,57,61,65,69,1,5,33,53,57,61,69,17,41,45,49,65,1,5,33,53,57,61,69,17,41,45,49,65,1,5,33,53,57,61,69,17,41,45,49,65,1,5,17,33,41,45,49,53,57,61,65,69,1,5,33,53,57,61,69,17,41,45,49,65,1,5,33,53,57,61,69,17,41,45,49,65,1,5,33,53,57,61,69,17,41,45,49,65,1,5,17,33,41,45,49,53,57,61,65,69,1,5,33,53,57,61,69,17,41,45,49,65,34,30,58,62,70,10,42,46,50,66,34,30,58,62,70,10,42,46,50,66,34,30,58,62,70,10,42,46,50,66,34,30,58,62,70,10,42,46,50,66,10,30,34,42,46,50,58,62,66,70,30,34,58,62,70,10,42,46,50,66,34,30,58,62,70,10,42,46,50,66,34,30,58,62,70,10,42,46,50,66,10,30,34,42,46,50,58,62,66,70,30,34,58,62,70,10,42,46,50,66,34,30,58,62,70,10,42,46,50,66,34,30,58,62,70,10,42,46,50,66,10,30,34,42,46,50,58,62,66,70,30,34,58,62,70,10,42,46,50,66,35,23,59,63,71,15,43,47,51,67,35,23,59,63,71,15,43,47,51,67,35,23,59,63,71,15,43,47,51,67,35,23,59,63,71,15,43,47,51,67,15,23,35,43,47,51,59,63,67,71,23,35,59,63,71,15,43,47,51,67,35,23,59,63,71,15,43,47,51,67,35,23,59,63,71,15,43,47,51,67,15,23,35,43,47,51,59,63,67,71,23,35,59,63,71,15,43,47,51,67,35,23,59,63,71,15,43,47,51,67,35,23,59,63,71,15,43,47,51,67,15,23,35,43,47,51,59,63,67,71,23,35,59,63,71,15,43,47,51,67,28,36,40,60,64,72,44,48,52,68,28,36,40,60,64,72,44,48,52,68,28,36,40,44,48,52,60,64,68,72,28,36,40,60,64,72,44,48,52,68,28,36,40,60,64,72,44,48,52,68,28,36,40,60,64,72,44,48,52,68,28,36,40,44,48,52,60,64,68,72,28,36,40,60,64,72,44,48,52,68,28,36,40,60,64,72,44,48,52,68,28,36,40,60,64,72,44,48,52,68,28,36,40,44,48,52,60,64,68,72,28,36,40,60,64,72,44,48,52,68,28,36,40,44,48,52,60,64,68,72,28,36,40,60,64,72,44,48,52,68];
    M = sparse(ix,jx,C(kx),54,84);

    [L,~,P] = lu(M(:,1:14));
    P = P';
    M = [P*L P(:,15:end)]\M(:,15:end);
    M = full(M(15:end,:));

    [L,U,P] = lu(M(:,1:27));
    P = P';
    M = [P*L P(:,28:end)]\M(:,28:end);
    M1 = M(1:27,:);
    M2 = M(28:end,:);

    [Q,R,P] = qr(M2(:,1:end-5));
    A = U\[M1(:,1:end-5)*P M1(:,end-4:end)];
    B = R(:,1:13)\[R(:,14:end) Q'*M2(:,end-4:end)];
    M = [-A(:,end-29:end)+A(:,1:end-30)*B; -B];

    P1 = [44:70 (1:38)*P 39:43];
    P2 = [44,45,46,47,48,49,10,12,15,50,51,52,53,54,19,20,22,25,55,56,57,58,59,60,29,30,32,35,61,62,63,64,65,66,39,40,41,42,67,68,69,43,70];
    T = getT(M,P1(1:end-30),P1(end-29:end),P2);

    [V,~] = eig(T);
    S = V(26:29,:)./repmat(V(30,:),4,1);

    I = ~isnan(S(1,:)) & ~isinf(S(1,:));
    %I = I & ~imag(S(1,:)); % uncomment this line for real roots only
    S = S(:,I);

end