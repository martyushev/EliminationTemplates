% Input: coefficient matrix C of size 4x27

% Monomial vector: [y*z*x^2*w, y^2*z*w*x, x*w*z^3, y*w*z^3, x^2*w*y, y*x^3, w*x*y^2, y^3*x, x*z^2*w, z^2*x^2, z^2*y*w, z^2*y*x, z^2*y^2, z^4, z*x*w, z*x^2, z*y*w, y^2*z, z^3, x*w, x^2, y*w, y*x, y^2, z^2, z, 1]

function [w, x, y, z] = std_p6pf_refract_colpiv(C)

    M = zeros(126,162);

    M([1, 506, 1389, 2524, 4163, 4292, 4668, 4923, 6181, 6436, 9209, 9714, 11353]) = C(1);
    M([127, 632, 764, 1515, 2650, 4289, 4920, 5175, 6433, 6688, 9335, 9966, 11605]) = C(5);
    M([253, 884, 1767, 2902, 4415, 4544, 5424, 5679, 7063, 9461, 10468, 10722, 12739]) = C(9);
    M([379, 1010, 1142, 1893, 2025, 3028, 4541, 5676, 9587, 10465, 10594, 10974, 12991]) = C(13);
    M([505, 1388, 2523, 3406, 4667, 4922, 6180, 6435, 7693, 7948, 9713, 11352, 13369]) = C(17);
    M([4159, 4664, 4793, 5048, 6177, 6306, 6561, 7690, 7819, 8074, 9839, 11478, 13495]) = C(21);
    M([631, 1514, 2649, 3532, 4919, 5174, 6432, 6687, 7945, 8200, 9965, 11604, 13621]) = C(25);
    M([757, 1646, 2781, 5168, 5297, 6681, 6810, 8194, 8323, 8452, 10343, 11982, 13999]) = C(29);
    M([883, 1766, 2901, 3658, 5423, 5678, 7062, 10467, 10721, 12103, 12232, 12738, 14629]) = C(33);
    M([4411, 5420, 5549, 5804, 7059, 7188, 7317, 8575, 10847, 12100, 12358, 12864, 14755]) = C(37);
    M([1009, 1892, 2024, 3027, 3784, 5675, 10464, 10593, 10973, 12229, 12484, 12990, 14881]) = C(41);
    M([4537, 5672, 5801, 5930, 7314, 7443, 10461, 11099, 12226, 12355, 12610, 13116, 17023]) = C(45);
    M([1135, 2018, 2150, 3159, 5927, 7440, 10587, 12478, 12607, 15887, 16138, 16266, 17149]) = C(49);
    M([1261, 2270, 2402, 3285, 6053, 7566, 11217, 13234, 16013, 16387, 16516, 16644, 17527]) = C(53);
    M([1765, 2900, 3657, 3910, 7061, 8701, 10466, 12102, 12231, 12737, 14122, 14628, 15385]) = C(57);
    M([5419, 7058, 7187, 7316, 8574, 8698, 8827, 12099, 12357, 12863, 14248, 14754, 15511]) = C(61);
    M([1891, 3026, 3783, 4036, 10463, 10592, 12228, 12483, 12989, 14119, 14374, 14880, 15637]) = C(65);
    M([2017, 3158, 7439, 10586, 12477, 12606, 14368, 14497, 16137, 16265, 16894, 17148, 18157]) = C(69);
    M([2269, 3284, 7565, 11216, 13233, 14998, 16386, 16515, 16643, 17269, 17398, 17526, 18661]) = C(73);
    M([2899, 3656, 3909, 8700, 8953, 12101, 12230, 14121, 14627, 15130, 15384, 18787]) = C(77);
    M([7057, 8573, 8697, 8826, 8950, 9079, 12098, 12356, 14247, 14753, 15256, 15510, 15763]) = C(81);
    M([3025, 3782, 4035, 12227, 12482, 14118, 14373, 14879, 15127, 15636, 17650, 18913]) = C(85);
    M([10459, 12224, 12353, 12608, 14115, 14244, 14499, 15124, 15253, 17021, 17776, 18030, 19039]) = C(89);
    M([10585, 12476, 12605, 14367, 14496, 16136, 16893, 17147, 17644, 17773, 17902, 18156, 19165]) = C(93);
    M([13231, 14996, 17267, 17396, 18273, 18402, 18531, 18659, 19282, 19411, 19540, 19668, 20173]) = C(101);
    M([14995, 18272, 18401, 18530, 19281, 19410, 19539, 19667, 19786, 19915, 20044, 20172, 20299]) = C(105);
    M([45, 298, 547, 906, 1430, 1789, 2549, 2934, 3691, 3925, 4206, 4334, 4459, 4583, 4704, 4965, 5444, 5697, 6215, 6447, 6970, 7076, 8710, 9226, 9356, 9483, 9717, 9993, 10480, 10744, 11363, 11623, 12131, 12260, 12756, 14130, 14633, 15386]) = C(58);
    M([675, 1054, 1555, 1914, 2063, 2690, 3049, 3557, 3816, 4069, 4962, 5216, 5719, 6468, 6729, 7979, 8211, 9982, 10238, 10484, 10611, 10995, 11380, 11607, 11883, 12242, 12496, 13012, 13631, 13891, 14147, 14402, 14898, 15136, 15641, 17658, 18914]) = C(86);
    M([4329, 4582, 4957, 5088, 5342, 5694, 5845, 5969, 6470, 6594, 6855, 7334, 7461, 7967, 8105, 8337, 10108, 10364, 10483, 11121, 11506, 11733, 12009, 12258, 12368, 12622, 13138, 13757, 14017, 14149, 14273, 14528, 15139, 15262, 17040, 17784, 18035, 19040]) = C(90);
    M([1306, 2292, 2441, 3303, 4581, 5713, 5844, 5972, 6097, 7350, 7485, 7586, 10502, 11116, 11239, 12251, 12389, 12621, 12892, 13119, 13266, 15031, 15908, 16035, 16293, 16400, 16528, 16666, 17033, 17167, 17297, 17426, 17544, 18289, 18412, 18540, 18665, 19670]) = C(98);
    M([2314, 3323, 5715, 7356, 7484, 7609, 10501, 11238, 12266, 12390, 12651, 13132, 13255, 14141, 14279, 14511, 14782, 15030, 16286, 16406, 16533, 16665, 17025, 17175, 17282, 17410, 17548, 18041, 18175, 18307, 18431, 18560, 18678, 19297, 19420, 19548, 19673, 20174]) = C(102);
    M([10503, 11260, 12265, 12396, 12650, 13254, 14156, 14280, 14541, 15019, 15149, 15287, 15538, 16429, 16553, 17038, 17168, 17288, 17415, 17547, 17787, 18033, 18183, 18306, 18416, 18544, 18682, 19049, 19183, 19315, 19439, 19568, 19686, 19801, 19924, 20052, 20177, 20300]) = C(106);
    M([208, 461, 710, 843, 1070, 1218, 1593, 1953, 2081, 2713, 3097, 3854, 4089, 4369, 4622, 4993, 5254, 5734, 6504, 6737, 9275, 9390, 9646, 10007, 10282, 10516, 10644, 11033, 11653, 11913, 12294, 12549, 13046, 14166, 14420, 14923, 15676]) = C(67);
    M([586, 965, 1466, 1826, 2601, 2961, 3469, 3727, 3980, 4747, 5001, 5504, 5754, 6253, 6514, 7007, 7120, 7764, 7997, 8766, 9000, 9768, 10523, 10780, 11393, 11668, 12154, 12282, 12797, 13417, 13677, 14187, 14684, 15176, 15427, 18826]) = C(79);
    M([4366, 4619, 4994, 5125, 5379, 5732, 5882, 6006, 6507, 6631, 6892, 7372, 7499, 8005, 8142, 8375, 9905, 10146, 10521, 11158, 11771, 12046, 12295, 12406, 12660, 13175, 13795, 14055, 14186, 14310, 14565, 15177, 15300, 17078, 17822, 18073, 19078]) = C(91);
    M([1343, 2330, 2478, 3341, 4618, 5750, 5881, 6009, 6134, 7387, 7522, 7624, 10539, 10913, 11154, 11277, 12289, 12426, 12659, 13157, 13303, 15068, 16072, 16330, 16438, 16566, 16703, 17071, 17205, 17334, 17463, 17582, 18327, 18450, 18578, 18703, 19708]) = C(99);
    M([2351, 3360, 5752, 7393, 7521, 7646, 10538, 11276, 12303, 12427, 12688, 12929, 13170, 13293, 14179, 14316, 14549, 15067, 16444, 16571, 16702, 17063, 17212, 17320, 17448, 17585, 18079, 18213, 18344, 18468, 18597, 18716, 19335, 19458, 19586, 19711, 20212]) = C(103);
    M([10540, 11297, 12302, 12433, 12687, 13292, 14193, 14317, 14578, 14819, 15057, 15187, 15324, 16466, 16590, 17076, 17326, 17453, 17584, 17825, 18071, 18220, 18343, 18454, 18582, 18719, 19087, 19221, 19352, 19476, 19605, 19724, 19839, 19962, 20090, 20215, 20338]) = C(107);
    M([4278, 4531, 4780, 4911, 5165, 5518, 5668, 5918, 6293, 6417, 6678, 7157, 7284, 7411, 7792, 7928, 8160, 8663, 8808, 8932, 9040, 9163, 9806, 9933, 10946, 11449, 11556, 12209, 12445, 12963, 13454, 13581, 13842, 14353, 14849, 15339, 15590, 15839]) = C(84);
    M([4404, 4657, 5032, 5163, 5417, 5770, 5920, 6044, 6545, 6669, 6930, 7410, 7537, 8044, 8180, 8412, 10058, 10185, 10559, 11198, 11701, 11808, 12335, 12443, 12697, 13215, 13706, 13833, 14094, 14226, 14350, 14605, 15214, 15337, 17117, 17859, 18110, 19115]) = C(92);
    M([876, 1255, 1763, 2116, 2264, 2898, 3253, 5284, 5415, 6046, 6797, 6921, 7536, 8296, 8432, 8538, 10310, 10437, 10685, 11953, 12060, 12587, 12695, 13958, 14085, 14478, 14602, 15986, 16225, 16365, 16866, 16999, 17243, 17734, 17857, 17985, 18236, 19241]) = C(96);
    M([1381, 2368, 2516, 3379, 4656, 5788, 5919, 6047, 6172, 7425, 7560, 7662, 10577, 11066, 11193, 11315, 12328, 12464, 12696, 13087, 13194, 13343, 14966, 15108, 16112, 16475, 16603, 16743, 17109, 17244, 17374, 17503, 17621, 18364, 18487, 18615, 18740, 19745]) = C(100);
    M([2389, 3398, 5790, 7431, 7559, 7684, 10576, 11314, 12341, 12465, 12726, 13082, 13209, 13331, 14218, 14354, 14586, 14977, 15107, 15722, 16482, 16609, 16742, 17100, 17357, 17485, 17625, 18117, 18252, 18384, 18508, 18637, 18755, 19372, 19495, 19623, 19748, 20249]) = C(104);
    M([10578, 11335, 12340, 12471, 12725, 13330, 14231, 14355, 14616, 14972, 15095, 15226, 15362, 15733, 16504, 16628, 17115, 17364, 17491, 17624, 17862, 18108, 18383, 18491, 18619, 18759, 18998, 19125, 19260, 19392, 19516, 19645, 19763, 19876, 19999, 20127, 20252, 20375]) = C(108);

    [L,~,Pi] = lu(M(:,1:33));
    Pi = Pi';
    M = [Pi*L Pi(:,34:end)]\M(:,34:end);
    M = M(34:end,:);

    [L,UR,Pi] = lu(M(:,1:40));
    Pi = Pi';
    M = [Pi*L Pi(:,41:end)]\M(:,41:end);
    MP = M(1:40,:);
    NP = M(41:end,:);

    [Q,U,Pi] = qr(NP(:,1:end-5));
    A = UR\[MP(:,1:end-5)*Pi MP(:,end-4:end)];
    B = U(:,1:53)\[U(:,54:end) Q'*NP(:,end-4:end)];
    M = [-A(:,end-35:end)+A(:,1:end-36)*B; -B];

    xP = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 41, 42, 11, 12, 13, 14, 43, 17, 18, 19, 20, 21, 22, 23, 45, 46, 47, 48, 24, 25, 51, 26, 53, 29, 30, 31, 32, 33, 34, 58, 59, 60, 61, 64, 36, 65, 69, 74, 75, 37, 38, 80, 40, 15, 16, 50, 27, 54, 56, 28, 35, 63, 66, 68, 70, 72, 98, 76, 77, 79, 81, 83, 84, 85, 103, 105, 39, 88, 89, 109, 90, 91, 111, 114, 117, 93, 119, 122, 126];
    R = 1:40;
    P = 41:129;
    P1 = [P(1:end-5)*Pi P(end-4:end)];
    RP = [R P1(1:end-36)];
    B = P1(end-35:end);
    A = getA(M,RP,B,B-40,xP);

    [V,~] = eig(A);
    sol = V([32, 33, 34, 35],:)./(ones(4,1)*V(36,:));

    if(find(isnan( sol(:) )) > 0)
        w = zeros(1,0);
        x = zeros(1,0);
        y = zeros(1,0);
        z = zeros(1,0);
    else
        %I = find(not(imag( sol(1,:) )));
        w = sol(1,:);
        x = sol(2,:);
        y = sol(3,:);
        z = sol(4,:);
    end

end