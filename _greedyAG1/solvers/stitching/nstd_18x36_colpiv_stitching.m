% Input: coefficient matrix C of size 2x16

function [x,y] = nstd_18x36_colpiv_stitching(C)

    i_dx = [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18];
    j_dx = [2,3,4,5,7,8,9,10,11,12,13,14,15,16,17,19,7,8,9,10,11,12,13,14,15,16,17,18,19,20,22,25,8,9,11,12,13,14,15,17,18,19,20,21,22,23,26,29,3,4,5,6,10,12,14,16,17,19,20,22,23,25,26,29,9,11,13,14,15,17,18,20,21,22,23,24,26,27,30,32,10,12,14,16,17,19,20,22,23,25,26,27,29,30,32,34,11,13,15,17,18,20,21,23,24,26,27,28,30,31,33,35,12,14,17,19,20,22,23,26,27,29,30,31,32,33,35,36,1,4,5,6,16,19,22,25,26,29,30,32,33,34,35,36,2,3,4,5,7,8,9,10,11,12,13,14,15,16,17,19,7,8,9,10,11,12,13,14,15,16,17,18,19,20,22,25,8,9,11,12,13,14,15,17,18,19,20,21,22,23,26,29,3,4,5,6,10,12,14,16,17,19,20,22,23,25,26,29,9,11,13,14,15,17,18,20,21,22,23,24,26,27,30,32,10,12,14,16,17,19,20,22,23,25,26,27,29,30,32,34,11,13,15,17,18,20,21,23,24,26,27,28,30,31,33,35,12,14,17,19,20,22,23,26,27,29,30,31,32,33,35,36,1,4,5,6,16,19,22,25,26,29,30,32,33,34,35,36];
    C_dx = [1,7,19,31,3,5,9,11,13,15,17,21,23,25,27,29,1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31,1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31,1,7,19,31,3,5,9,11,13,15,17,21,23,25,27,29,1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31,1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31,1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31,1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31,31,1,7,19,3,5,9,11,13,15,17,21,23,25,27,29,2,8,20,32,4,6,10,12,14,16,18,22,24,26,28,30,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30,32,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30,32,2,8,20,32,4,6,10,12,14,16,18,22,24,26,28,30,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30,32,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30,32,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30,32,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30,32,32,2,8,20,4,6,10,12,14,16,18,22,24,26,28,30];
    M = sparse(i_dx,j_dx,C(C_dx),18,36);

    [L,~,Pi] = lu(M(:,1:1));
    Pi = Pi';
    M = [Pi*L Pi(:,2:end)]\M(:,2:end);
    M = full(M(2:end,:));

    [L,UR,Pi] = lu(M(:,1:5));
    Pi = Pi';
    M = [Pi*L Pi(:,6:end)]\M(:,6:end);
    MP = M(1:5,:);
    NP = M(6:end,:);

    [Q,U,Pi] = qr(NP(:,1:end-3));
    A = UR\[MP(:,1:end-3)*Pi MP(:,end-2:end)];
    B = U(:,1:12)\[U(:,13:end) Q'*NP(:,end-2:end)];
    M = [-A(:,end-17:end)+A(:,1:end-18)*B; -B];

    xP = [31,1,2,32,3,4,5,6,7,33,8,9,10,11,12,13,14,15,34,16,17,18,19,20,21,23,24,35,26,28];
    P1 = [(1:27)*Pi 28:30];
    T = getT(M,[31:35 P1(1:end-18)],P1(end-17:end),xP);

    [V,D] = eig(T);
    sol = [V(17,:)./V(18,:); diag(D).'];

    I = find(not(isnan(sol(1,:))) & not(isinf(sol(1,:))));
    %I = I(not(imag(sol(1,:)))); % uncomment this line for real roots only
    y = sol(1,I);
    x = sol(2,I);

end