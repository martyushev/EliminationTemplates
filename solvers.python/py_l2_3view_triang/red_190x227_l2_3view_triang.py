import numpy as np
from scipy.sparse import csr_matrix
from scipy.linalg import lu, solve, eig

# Input: coefficient matrix C of size 8x25
# Output: solution matrix S of size 8x37

def red_190x227_l2_3view_triang(C):
    M = csr_matrix((C.flat[[10,16,24,11,22,16,24,10,11,22,10,11,16,24,22,10,11,16,22,24,16,24,10,11,22,10,11,16,22,24,10,11,16,24,22,10,11,16,22,24,10,11,16,22,24,10,16,24,11,22,16,24,10,11,22,10,11,16,24,22,10,11,16,24,22,10,11,16,24,22,10,11,16,22,24,10,11,16,22,24,10,11,16,24,22,10,11,16,24,22,10,11,16,24,22,10,16,24,11,22,10,11,16,24,22,10,16,24,11,22,10,11,16,24,22,16,24,10,11,22,10,11,16,24,22,16,24,10,11,22,35,42,49,36,47,42,49,35,36,47,35,36,42,49,47,35,36,42,47,49,42,49,35,36,47,35,36,47,49,42,35,36,42,49,47,35,36,42,47,49,35,36,42,47,49,35,42,49,36,47,42,49,35,36,47,35,36,42,49,47,35,36,42,49,47,35,36,42,49,47,35,36,42,47,49,35,36,42,47,49,35,36,42,49,47,35,36,42,49,47,35,36,42,49,47,35,42,49,36,47,35,36,42,49,47,35,42,49,36,47,35,36,42,49,47,42,49,35,36,47,35,36,42,49,47,42,49,35,36,47,58,64,68,72,73,74,58,64,65,68,72,73,74,58,64,65,68,73,74,59,72,64,65,73,68,74,58,59,72,58,59,68,72,73,74,58,64,68,73,74,72,58,59,73,68,74,72,58,64,65,68,73,74,58,59,64,68,72,73,74,65,58,59,68,72,73,74,64,65,64,65,68,73,74,58,59,72,58,59,64,65,68,73,74,72,58,59,64,65,68,73,74,72,58,59,64,65,68,73,74,72,64,65,68,73,74,58,59,72,58,59,64,65,68,73,74,72,64,65,68,73,74,58,59,72,58,59,64,65,68,72,73,74,68,64,65,73,74,58,59,72,64,65,68,73,74,58,59,72,83,94,97,98,99,83,89,90,94,98,99,84,97,89,90,98,94,99,83,84,97,83,84,94,97,98,99,83,84,98,94,99,97,83,89,90,98,94,99,83,84,89,94,97,98,99,90,83,84,94,97,98,99,89,90,89,90,94,98,99,83,84,97,83,84,89,90,94,98,99,97,83,84,89,90,94,98,99,97,83,84,89,90,94,98,99,97,89,90,98,94,99,83,84,97,83,84,89,90,94,98,99,97,89,90,94,98,99,83,84,97,83,84,89,90,94,97,98,99,94,89,90,98,99,83,84,97,89,90,94,98,99,83,84,97,112,113,120,123,124,112,113,120,123,124,112,113,120,123,124,112,113,120,123,124,112,113,120,123,124,112,113,120,123,124,112,113,120,123,124,112,113,120,123,124,112,113,120,123,124,112,113,120,123,124,112,113,120,123,124,112,113,120,123,124,112,113,120,123,124,112,113,120,123,124,112,113,120,123,124,112,113,120,123,124,112,113,120,123,124,112,113,120,123,124,112,120,113,123,124,120,112,113,123,124,112,113,120,123,124,112,113,120,123,124,112,113,120,123,124,112,113,120,123,124,112,113,120,123,124,112,113,120,123,124,112,113,120,123,124,112,113,120,123,124,112,113,120,123,124,112,113,120,123,124,112,113,120,123,124,137,138,146,148,149,137,138,146,148,149,137,138,146,148,149,137,138,146,148,149,137,138,146,148,149,137,138,146,148,149,137,138,146,148,149,137,138,148,149,146,137,138,148,146,149,137,138,146,148,149,137,138,146,148,149,137,138,146,148,149,137,138,146,148,149,137,138,146,148,149,137,138,146,148,149,137,138,146,148,149,137,138,146,148,149,137,138,146,148,149,137,138,146,148,149,137,146,138,148,149,146,137,138,148,149,137,138,146,148,149,137,138,146,148,149,137,138,146,148,149,137,138,146,148,149,137,138,148,146,149,137,138,148,146,149,137,138,146,148,149,137,138,146,148,149,137,138,146,148,149,137,138,146,148,149,137,138,146,148,149,150,152,168,169,166,167,174,150,151,152,153,166,167,168,169,174,150,166,167,168,152,153,169,174,150,151,152,153,166,167,168,169,174,150,152,153,166,167,168,169,174,150,152,166,167,174,150,151,152,153,166,167,168,169,174,150,151,152,153,166,167,168,169,174,150,151,152,153,166,167,168,169,174,150,151,152,153,168,169,166,167,174,150,151,152,153,168,169,166,167,174,150,151,152,166,167,168,169,153,174,150,152,168,151,153,166,167,169,174,150,151,152,153,166,167,168,169,174,150,151,152,153,166,167,168,169,174,150,151,152,153,166,167,168,169,174,150,151,152,153,168,169,166,167,174,150,151,152,153,166,167,168,169,174,179,193,194,180,181,182,195,196,199,179,193,194,195,196,199,179,180,181,182,193,195,194,196,199,179,180,182,193,195,194,196,199,179,180,193,195,181,182,194,196,199,179,180,181,182,193,194,195,196,199,179,180,181,182,193,194,195,196,199,179,180,181,182,193,194,195,196,199,179,180,181,182,193,194,195,196,199,179,193,194,195,196,199,179,180,181,182,193,194,195,196,199,179,193,194,180,181,182,195,196,199,179,180,181,182,193,195,194,196,199,179,180,181,182,193,195,194,196,199,179,180,181,193,194,195,182,196,199,179,180,193,195,181,182,194,196,199,179,180,181,182,193,194,195,196,199,179,180,181,182,193,194,195,196,199,179,180,181,182,193,194,195,196,199]],([0,0,0,0,0,1,1,1,1,1,2,2,2,2,2,3,3,3,3,3,4,4,4,4,4,5,5,5,5,5,6,6,6,6,6,7,7,7,7,7,8,8,8,8,8,9,9,9,9,9,10,10,10,10,10,11,11,11,11,11,12,12,12,12,12,13,13,13,13,13,14,14,14,14,14,15,15,15,15,15,16,16,16,16,16,17,17,17,17,17,18,18,18,18,18,19,19,19,19,19,20,20,20,20,20,21,21,21,21,21,22,22,22,22,22,23,23,23,23,23,24,24,24,24,24,25,25,25,25,25,26,26,26,26,26,27,27,27,27,27,28,28,28,28,28,29,29,29,29,29,30,30,30,30,30,31,31,31,31,31,32,32,32,32,32,33,33,33,33,33,34,34,34,34,34,35,35,35,35,35,36,36,36,36,36,37,37,37,37,37,38,38,38,38,38,39,39,39,39,39,40,40,40,40,40,41,41,41,41,41,42,42,42,42,42,43,43,43,43,43,44,44,44,44,44,45,45,45,45,45,46,46,46,46,46,47,47,47,47,47,48,48,48,48,48,49,49,49,49,49,50,50,50,50,50,51,51,51,51,51,52,52,52,52,52,52,53,53,53,53,53,53,53,54,54,54,54,54,54,54,54,55,55,55,55,55,55,55,55,56,56,56,56,56,56,57,57,57,57,57,57,58,58,58,58,58,58,59,59,59,59,59,59,60,60,60,60,60,60,60,60,61,61,61,61,61,61,61,61,62,62,62,62,62,62,62,62,63,63,63,63,63,63,63,63,64,64,64,64,64,64,64,64,65,65,65,65,65,65,65,65,66,66,66,66,66,66,66,66,67,67,67,67,67,67,67,67,68,68,68,68,68,68,68,68,69,69,69,69,69,69,69,69,70,70,70,70,70,70,70,70,71,71,71,71,71,71,71,71,72,72,72,72,72,73,73,73,73,73,73,73,73,74,74,74,74,74,74,74,74,75,75,75,75,75,75,76,76,76,76,76,76,77,77,77,77,77,77,78,78,78,78,78,78,78,78,79,79,79,79,79,79,79,79,80,80,80,80,80,80,80,80,81,81,81,81,81,81,81,81,82,82,82,82,82,82,82,82,83,83,83,83,83,83,83,83,84,84,84,84,84,84,84,84,85,85,85,85,85,85,85,85,86,86,86,86,86,86,86,86,87,87,87,87,87,87,87,87,88,88,88,88,88,88,88,88,89,89,89,89,89,89,89,89,90,90,90,90,90,91,91,91,91,91,92,92,92,92,92,93,93,93,93,93,94,94,94,94,94,95,95,95,95,95,96,96,96,96,96,97,97,97,97,97,98,98,98,98,98,99,99,99,99,99,100,100,100,100,100,101,101,101,101,101,102,102,102,102,102,103,103,103,103,103,104,104,104,104,104,105,105,105,105,105,106,106,106,106,106,107,107,107,107,107,108,108,108,108,108,109,109,109,109,109,110,110,110,110,110,111,111,111,111,111,112,112,112,112,112,113,113,113,113,113,114,114,114,114,114,115,115,115,115,115,116,116,116,116,116,117,117,117,117,117,118,118,118,118,118,119,119,119,119,119,120,120,120,120,120,121,121,121,121,121,122,122,122,122,122,123,123,123,123,123,124,124,124,124,124,125,125,125,125,125,126,126,126,126,126,127,127,127,127,127,128,128,128,128,128,129,129,129,129,129,130,130,130,130,130,131,131,131,131,131,132,132,132,132,132,133,133,133,133,133,134,134,134,134,134,135,135,135,135,135,136,136,136,136,136,137,137,137,137,137,138,138,138,138,138,139,139,139,139,139,140,140,140,140,140,141,141,141,141,141,142,142,142,142,142,143,143,143,143,143,144,144,144,144,144,145,145,145,145,145,146,146,146,146,146,147,147,147,147,147,148,148,148,148,148,149,149,149,149,149,150,150,150,150,150,151,151,151,151,151,152,152,152,152,152,153,153,153,153,153,153,153,154,154,154,154,154,154,154,154,154,155,155,155,155,155,155,155,155,156,156,156,156,156,156,156,156,156,157,157,157,157,157,157,157,157,158,158,158,158,158,159,159,159,159,159,159,159,159,159,160,160,160,160,160,160,160,160,160,161,161,161,161,161,161,161,161,161,162,162,162,162,162,162,162,162,162,163,163,163,163,163,163,163,163,163,164,164,164,164,164,164,164,164,164,165,165,165,165,165,165,165,165,165,166,166,166,166,166,166,166,166,166,167,167,167,167,167,167,167,167,167,168,168,168,168,168,168,168,168,168,169,169,169,169,169,169,169,169,169,170,170,170,170,170,170,170,170,170,171,171,171,171,171,171,171,171,171,172,172,172,172,172,172,173,173,173,173,173,173,173,173,173,174,174,174,174,174,174,174,174,175,175,175,175,175,175,175,175,175,176,176,176,176,176,176,176,176,176,177,177,177,177,177,177,177,177,177,178,178,178,178,178,178,178,178,178,179,179,179,179,179,179,179,179,179,180,180,180,180,180,180,181,181,181,181,181,181,181,181,181,182,182,182,182,182,182,182,182,182,183,183,183,183,183,183,183,183,183,184,184,184,184,184,184,184,184,184,185,185,185,185,185,185,185,185,185,186,186,186,186,186,186,186,186,186,187,187,187,187,187,187,187,187,187,188,188,188,188,188,188,188,188,188,189,189,189,189,189,189,189,189,189],[2,70,165,190,201,73,166,191,192,202,8,9,77,167,203,11,13,83,110,145,157,169,195,196,205,13,14,85,111,146,14,15,86,170,206,20,21,90,115,150,22,23,94,116,151,25,96,173,197,209,99,174,197,198,210,28,29,101,175,211,30,31,103,176,212,53,56,119,178,214,54,57,120,138,152,57,58,123,139,153,59,60,127,179,215,61,62,132,180,216,75,76,163,181,217,109,142,183,205,219,110,111,143,184,220,111,168,185,206,221,114,115,147,186,222,171,187,209,210,223,138,139,177,188,225,182,189,220,221,226,2,71,165,190,201,74,166,191,192,202,8,9,78,167,203,11,13,84,110,145,158,169,195,196,205,13,14,111,146,159,14,15,160,170,206,20,21,91,115,150,22,23,95,116,151,25,97,173,197,209,100,174,197,198,210,28,29,102,175,211,30,31,104,176,212,52,55,119,177,213,54,57,121,138,152,57,58,124,139,153,59,60,128,179,215,61,62,133,180,216,75,76,164,181,217,108,142,182,204,218,110,111,144,184,220,111,169,185,206,221,114,115,148,186,222,172,187,209,210,223,138,139,178,188,225,183,189,220,221,226,0,7,65,75,79,140,10,44,48,84,109,121,144,12,45,49,85,123,168,193,204,46,50,124,159,169,193,194,205,18,19,92,115,130,150,24,51,98,134,173,209,26,27,135,161,174,210,32,59,61,110,138,220,52,53,72,122,138,140,152,155,55,56,125,139,141,153,154,156,81,82,140,167,181,199,200,217,105,106,127,132,143,177,182,218,106,107,128,133,144,178,183,219,108,109,129,134,145,152,184,220,130,135,146,153,185,204,205,221,112,113,131,136,149,179,186,222,136,137,173,180,187,207,208,223,117,118,215,216,220,224,225,226,152,165,166,181,188,213,214,225,179,180,184,188,189,218,219,226,1,69,76,80,141,12,45,49,86,123,168,193,204,46,50,124,160,169,193,194,205,18,19,93,115,130,150,26,27,135,162,174,210,33,60,62,139,206,221,52,53,72,125,138,140,152,155,55,56,126,139,141,153,154,156,81,82,141,167,181,199,200,217,105,106,127,132,168,177,182,218,106,107,128,133,169,178,183,219,108,109,129,134,146,152,184,220,130,135,153,170,185,204,205,221,112,113,131,136,150,179,186,222,136,137,174,180,187,207,208,223,117,118,215,216,221,224,225,226,153,165,166,181,188,213,214,225,179,180,185,188,189,218,219,226,3,5,70,77,163,4,6,71,78,164,8,9,201,203,217,34,37,88,121,144,35,38,89,122,145,36,39,90,123,168,37,40,91,124,169,38,41,92,125,146,41,42,93,126,170,43,45,94,127,147,44,46,95,128,148,47,49,101,132,171,48,50,102,133,172,59,60,116,215,222,61,62,211,216,223,63,66,127,163,177,64,67,128,164,178,68,69,130,141,153,72,131,154,165,179,136,155,156,166,180,75,76,215,217,225,79,80,165,167,181,120,123,147,177,182,121,124,148,178,183,122,125,149,152,184,125,126,150,153,185,129,130,151,179,186,134,135,175,180,187,138,139,222,225,226,140,141,179,181,188,152,153,186,188,189,3,5,73,77,163,4,6,74,78,164,8,9,202,203,217,34,37,97,121,144,35,38,98,122,145,36,39,99,123,168,37,40,100,124,169,38,41,125,146,161,41,42,126,162,170,43,45,101,127,147,44,46,102,128,148,47,49,103,132,171,48,50,104,133,172,59,60,211,215,222,61,62,212,216,223,63,66,132,163,177,64,67,133,164,178,65,68,134,140,152,68,69,135,141,153,72,136,154,165,179,137,155,156,166,180,75,76,216,217,225,79,80,166,167,181,120,123,171,177,182,121,124,172,178,183,122,125,152,173,184,125,126,153,174,185,129,130,175,179,186,134,135,176,180,187,138,139,223,225,226,140,141,180,181,188,152,153,187,188,189,0,1,75,76,199,200,217,3,4,5,6,77,78,79,80,167,10,106,107,109,193,194,205,219,16,17,18,19,112,113,114,115,222,24,26,27,207,208,209,210,223,32,33,117,118,224,36,37,39,40,123,124,125,126,153,43,44,45,46,127,128,129,130,179,47,48,49,50,132,133,134,135,180,52,53,55,56,138,139,213,214,225,63,64,66,67,140,141,163,164,181,83,84,85,143,144,145,146,159,184,85,86,146,159,160,168,169,170,185,87,88,90,91,147,148,149,150,186,96,97,99,100,171,172,173,174,187,108,109,204,205,218,219,220,221,226,120,121,123,124,152,153,177,178,188,143,144,168,169,182,183,184,185,189,2,75,76,190,191,192,201,202,217,7,79,80,81,82,167,16,18,24,26,108,112,204,207,218,17,19,27,109,113,205,208,219,20,21,111,115,197,198,206,210,221,22,23,28,29,114,115,116,211,222,28,29,30,31,209,210,211,212,223,43,45,47,49,120,123,127,132,177,44,46,48,50,121,124,128,133,178,51,134,135,136,137,180,59,60,61,62,138,139,215,216,225,72,140,141,154,155,156,165,166,181,87,90,96,99,143,147,168,171,182,88,91,97,100,144,148,169,172,183,89,92,98,145,146,149,161,173,184,92,93,146,150,161,162,170,174,185,114,115,209,210,220,221,222,223,226,129,130,134,135,152,153,179,180,188,149,150,173,174,184,185,186,187,189])),shape=(190,227))
    M = M.toarray()

    P,L,_ = lu(M[:,:154])
    M = solve(np.concatenate((P@L,P[:,154:]),axis=1),M[:,154:])
    M = M[-36:,:]

    T0 = np.zeros((37,37))
    T0[[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,35,36],:] = -M[:,36:]
    T0.flat[[1294]] = 1
    T1 = np.zeros((37,37))
    T1[np.ix_([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,35,36],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,35,36])] = M[:,:36]
    T1.flat[[1292]] = 1

    _,V = eig(T0,T1)
    S = V[28:36,:]/np.tile(V[36,:],(8,1))
    S = S[:,np.all(np.isfinite(S),axis=0)]

    return S