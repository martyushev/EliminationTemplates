import numpy as np

def coefs_rdist9p(data):
    p1 = data[0].T.flat
    p2 = data[1].T.flat

    C = np.zeros((9,16))
    C.flat[[15,31,47,63,79,95,111,127,143]] = 1
    C.flat[5] = p1[0]
    C.flat[7] = p1[1]
    C.flat[21] = p1[2]
    C.flat[23] = p1[3]
    C.flat[37] = p1[4]
    C.flat[39] = p1[5]
    C.flat[53] = p1[6]
    C.flat[55] = p1[7]
    C.flat[69] = p1[8]
    C.flat[71] = p1[9]
    C.flat[85] = p1[10]
    C.flat[87] = p1[11]
    C.flat[101] = p1[12]
    C.flat[103] = p1[13]
    C.flat[117] = p1[14]
    C.flat[119] = p1[15]
    C.flat[133] = p1[16]
    C.flat[135] = p1[17]
    C.flat[11] = p2[0]
    C.flat[12] = p2[1]
    C.flat[27] = p2[2]
    C.flat[28] = p2[3]
    C.flat[43] = p2[4]
    C.flat[44] = p2[5]
    C.flat[59] = p2[6]
    C.flat[60] = p2[7]
    C.flat[75] = p2[8]
    C.flat[76] = p2[9]
    C.flat[91] = p2[10]
    C.flat[92] = p2[11]
    C.flat[107] = p2[12]
    C.flat[108] = p2[13]
    C.flat[123] = p2[14]
    C.flat[124] = p2[15]
    C.flat[139] = p2[16]
    C.flat[140] = p2[17]
    C.flat[0] = p2[0]*p1[0]
    C.flat[2] = p2[0]*p1[1]
    C.flat[1] = p2[1]*p1[0]
    C.flat[3] = p2[1]*p1[1]
    C.flat[16] = p2[2]*p1[2]
    C.flat[18] = p2[2]*p1[3]
    C.flat[17] = p2[3]*p1[2]
    C.flat[19] = p2[3]*p1[3]
    C.flat[32] = p2[4]*p1[4]
    C.flat[34] = p2[4]*p1[5]
    C.flat[33] = p2[5]*p1[4]
    C.flat[35] = p2[5]*p1[5]
    C.flat[48] = p2[6]*p1[6]
    C.flat[50] = p2[6]*p1[7]
    C.flat[49] = p2[7]*p1[6]
    C.flat[51] = p2[7]*p1[7]
    C.flat[64] = p2[8]*p1[8]
    C.flat[66] = p2[8]*p1[9]
    C.flat[65] = p2[9]*p1[8]
    C.flat[67] = p2[9]*p1[9]
    C.flat[80] = p2[10]*p1[10]
    C.flat[82] = p2[10]*p1[11]
    C.flat[81] = p2[11]*p1[10]
    C.flat[83] = p2[11]*p1[11]
    C.flat[96] = p2[12]*p1[12]
    C.flat[98] = p2[12]*p1[13]
    C.flat[97] = p2[13]*p1[12]
    C.flat[99] = p2[13]*p1[13]
    C.flat[112] = p2[14]*p1[14]
    C.flat[114] = p2[14]*p1[15]
    C.flat[113] = p2[15]*p1[14]
    C.flat[115] = p2[15]*p1[15]
    C.flat[128] = p2[16]*p1[16]
    C.flat[130] = p2[16]*p1[17]
    C.flat[129] = p2[17]*p1[16]
    C.flat[131] = p2[17]*p1[17]
    C.flat[13] = p1[0]**2+p1[1]**2
    C.flat[29] = p1[2]**2+p1[3]**2
    C.flat[45] = p1[4]**2+p1[5]**2
    C.flat[61] = p1[6]**2+p1[7]**2
    C.flat[77] = p1[8]**2+p1[9]**2
    C.flat[93] = p1[10]**2+p1[11]**2
    C.flat[109] = p1[12]**2+p1[13]**2
    C.flat[125] = p1[14]**2+p1[15]**2
    C.flat[141] = p1[16]**2+p1[17]**2
    C.flat[14] = p2[0]**2+p2[1]**2
    C.flat[30] = p2[2]**2+p2[3]**2
    C.flat[46] = p2[4]**2+p2[5]**2
    C.flat[62] = p2[6]**2+p2[7]**2
    C.flat[78] = p2[8]**2+p2[9]**2
    C.flat[94] = p2[10]**2+p2[11]**2
    C.flat[110] = p2[12]**2+p2[13]**2
    C.flat[126] = p2[14]**2+p2[15]**2
    C.flat[142] = p2[16]**2+p2[17]**2
    C.flat[8] = p1[0]**2*p2[0]+p1[1]**2*p2[0]
    C.flat[9] = p1[0]**2*p2[1]+p1[1]**2*p2[1]
    C.flat[4] = p1[0]*p2[0]**2+p1[0]*p2[1]**2
    C.flat[6] = p1[1]*p2[0]**2+p1[1]*p2[1]**2
    C.flat[24] = p1[2]**2*p2[2]+p1[3]**2*p2[2]
    C.flat[25] = p1[2]**2*p2[3]+p1[3]**2*p2[3]
    C.flat[20] = p1[2]*p2[2]**2+p1[2]*p2[3]**2
    C.flat[22] = p1[3]*p2[2]**2+p1[3]*p2[3]**2
    C.flat[40] = p1[4]**2*p2[4]+p1[5]**2*p2[4]
    C.flat[41] = p1[4]**2*p2[5]+p1[5]**2*p2[5]
    C.flat[36] = p1[4]*p2[4]**2+p1[4]*p2[5]**2
    C.flat[38] = p1[5]*p2[4]**2+p1[5]*p2[5]**2
    C.flat[56] = p1[6]**2*p2[6]+p1[7]**2*p2[6]
    C.flat[57] = p1[6]**2*p2[7]+p1[7]**2*p2[7]
    C.flat[52] = p1[6]*p2[6]**2+p1[6]*p2[7]**2
    C.flat[54] = p1[7]*p2[6]**2+p1[7]*p2[7]**2
    C.flat[72] = p1[8]**2*p2[8]+p1[9]**2*p2[8]
    C.flat[73] = p1[8]**2*p2[9]+p1[9]**2*p2[9]
    C.flat[68] = p1[8]*p2[8]**2+p1[8]*p2[9]**2
    C.flat[70] = p1[9]*p2[8]**2+p1[9]*p2[9]**2
    C.flat[88] = p1[10]**2*p2[10]+p1[11]**2*p2[10]
    C.flat[89] = p1[10]**2*p2[11]+p1[11]**2*p2[11]
    C.flat[84] = p1[10]*p2[10]**2+p1[10]*p2[11]**2
    C.flat[86] = p1[11]*p2[10]**2+p1[11]*p2[11]**2
    C.flat[104] = p1[12]**2*p2[12]+p1[13]**2*p2[12]
    C.flat[105] = p1[12]**2*p2[13]+p1[13]**2*p2[13]
    C.flat[100] = p1[12]*p2[12]**2+p1[12]*p2[13]**2
    C.flat[102] = p1[13]*p2[12]**2+p1[13]*p2[13]**2
    C.flat[120] = p1[14]**2*p2[14]+p1[15]**2*p2[14]
    C.flat[121] = p1[14]**2*p2[15]+p1[15]**2*p2[15]
    C.flat[116] = p1[14]*p2[14]**2+p1[14]*p2[15]**2
    C.flat[118] = p1[15]*p2[14]**2+p1[15]*p2[15]**2
    C.flat[136] = p1[16]**2*p2[16]+p1[17]**2*p2[16]
    C.flat[137] = p1[16]**2*p2[17]+p1[17]**2*p2[17]
    C.flat[132] = p1[16]*p2[16]**2+p1[16]*p2[17]**2
    C.flat[134] = p1[17]*p2[16]**2+p1[17]*p2[17]**2
    C.flat[10] = p1[0]**2*p2[0]**2+p1[0]**2*p2[1]**2+p1[1]**2*p2[0]**2+p1[1]**2*p2[1]**2
    C.flat[26] = p1[2]**2*p2[2]**2+p1[2]**2*p2[3]**2+p1[3]**2*p2[2]**2+p1[3]**2*p2[3]**2
    C.flat[42] = p1[4]**2*p2[4]**2+p1[4]**2*p2[5]**2+p1[5]**2*p2[4]**2+p1[5]**2*p2[5]**2
    C.flat[58] = p1[6]**2*p2[6]**2+p1[6]**2*p2[7]**2+p1[7]**2*p2[6]**2+p1[7]**2*p2[7]**2
    C.flat[74] = p1[8]**2*p2[8]**2+p1[8]**2*p2[9]**2+p1[9]**2*p2[8]**2+p1[9]**2*p2[9]**2
    C.flat[90] = p1[10]**2*p2[10]**2+p1[10]**2*p2[11]**2+p1[11]**2*p2[10]**2+p1[11]**2*p2[11]**2
    C.flat[106] = p1[12]**2*p2[12]**2+p1[12]**2*p2[13]**2+p1[13]**2*p2[12]**2+p1[13]**2*p2[13]**2
    C.flat[122] = p1[14]**2*p2[14]**2+p1[14]**2*p2[15]**2+p1[15]**2*p2[14]**2+p1[15]**2*p2[15]**2
    C.flat[138] = p1[16]**2*p2[16]**2+p1[16]**2*p2[17]**2+p1[17]**2*p2[16]**2+p1[17]**2*p2[17]**2

    A = (np.linalg.solve(C[:,:9],C[:,9:])).flat

    C = np.zeros((4,52))
    C.flat[148] = 1
    C.flat[45] = A[28]
    C.flat[48] = A[30]
    C.flat[49] = A[31]
    C.flat[50] = A[32]
    C.flat[51] = A[34]
    C.flat[97] = A[42]
    C.flat[100] = A[44]
    C.flat[101] = A[45]
    C.flat[102] = A[46]
    C.flat[103] = A[48]
    C.flat[149] = A[56]
    C.flat[147] = A[57]
    C.flat[152] = A[58]
    C.flat[153] = A[59]
    C.flat[154] = A[60]
    C.flat[151] = A[61]
    C.flat[155] = A[62]
    C.flat[31] = -A[35]
    C.flat[28] = -A[36]
    C.flat[38] = -A[37]
    C.flat[40] = -A[38]
    C.flat[37] = -A[40]
    C.flat[83] = -A[49]
    C.flat[80] = -A[50]
    C.flat[90] = -A[51]
    C.flat[92] = -A[52]
    C.flat[89] = -A[54]
    C.flat[43] = -A[39]+A[29]
    C.flat[47] = -A[41]+A[33]
    C.flat[95] = -A[53]+A[43]
    C.flat[99] = -A[55]+A[47]
    C.flat[161] = -A[0]*A[49]+A[14]*A[35]
    C.flat[170] = A[1]*A[22]-A[8]*A[15]
    C.flat[157] = -A[1]*A[50]+A[15]*A[36]
    C.flat[183] = -A[3]*A[52]+A[17]*A[38]
    C.flat[202] = A[4]*A[25]-A[11]*A[18]
    C.flat[193] = A[5]*A[26]-A[12]*A[19]
    C.flat[178] = -A[5]*A[54]+A[19]*A[40]
    C.flat[207] = A[6]*A[27]-A[13]*A[20]
    C.flat[160] = A[7]*A[49]-A[21]*A[35]
    C.flat[156] = A[8]*A[50]-A[22]*A[36]
    C.flat[177] = A[9]*A[51]-A[23]*A[37]
    C.flat[191] = A[11]*A[53]-A[25]*A[39]
    C.flat[175] = A[12]*A[54]-A[26]*A[40]
    C.flat[159] = -A[0]*A[50]-A[1]*A[49]+A[14]*A[36]+A[15]*A[35]
    C.flat[169] = -A[0]*A[52]-A[3]*A[49]+A[14]*A[38]+A[17]*A[35]
    C.flat[190] = A[1]*A[25]+A[4]*A[22]-A[8]*A[18]-A[11]*A[15]
    C.flat[184] = A[1]*A[26]+A[5]*A[22]-A[8]*A[19]-A[12]*A[15]
    C.flat[164] = -A[1]*A[54]-A[5]*A[50]+A[15]*A[40]+A[19]*A[36]
    C.flat[181] = -A[3]*A[54]-A[5]*A[52]+A[17]*A[40]+A[19]*A[38]
    C.flat[206] = A[4]*A[27]+A[6]*A[25]-A[11]*A[20]-A[13]*A[18]
    C.flat[203] = A[5]*A[27]+A[6]*A[26]-A[12]*A[20]-A[13]*A[19]
    C.flat[158] = A[7]*A[50]+A[8]*A[49]-A[21]*A[36]-A[22]*A[35]
    C.flat[166] = A[7]*A[51]+A[9]*A[49]-A[21]*A[37]-A[23]*A[35]
    C.flat[173] = A[7]*A[53]+A[11]*A[49]-A[21]*A[39]-A[25]*A[35]
    C.flat[163] = A[8]*A[51]+A[9]*A[50]-A[22]*A[37]-A[23]*A[36]
    C.flat[171] = A[8]*A[53]+A[11]*A[50]-A[22]*A[39]-A[25]*A[36]
    C.flat[162] = A[8]*A[54]+A[12]*A[50]-A[22]*A[40]-A[26]*A[36]
    C.flat[186] = A[9]*A[53]+A[11]*A[51]-A[23]*A[39]-A[25]*A[37]
    C.flat[176] = A[9]*A[54]+A[12]*A[51]-A[23]*A[40]-A[26]*A[37]
    C.flat[192] = A[0]*A[25]+A[4]*A[21]-A[4]*A[53]-A[7]*A[18]-A[11]*A[14]+A[18]*A[39]
    C.flat[174] = A[0]*A[21]-A[0]*A[53]-A[4]*A[49]-A[7]*A[14]+A[14]*A[39]+A[18]*A[35]
    C.flat[182] = -A[2]*A[52]-A[3]*A[51]+A[10]*A[52]+A[16]*A[38]+A[17]*A[37]-A[24]*A[38]
    C.flat[204] = A[2]*A[27]+A[6]*A[23]-A[9]*A[20]-A[13]*A[16]+A[13]*A[55]-A[27]*A[41]
    C.flat[180] = -A[2]*A[51]+A[9]*A[52]+A[10]*A[51]+A[16]*A[37]-A[23]*A[38]-A[24]*A[37]
    C.flat[195] = A[2]*A[23]-A[9]*A[16]+A[9]*A[55]+A[13]*A[51]-A[23]*A[41]-A[27]*A[37]
    C.flat[205] = A[3]*A[27]+A[6]*A[24]-A[6]*A[55]-A[10]*A[20]-A[13]*A[17]+A[20]*A[41]
    C.flat[198] = A[3]*A[24]-A[3]*A[55]-A[6]*A[52]-A[10]*A[17]+A[17]*A[41]+A[20]*A[38]
    C.flat[172] = A[0]*A[22]+A[1]*A[21]-A[1]*A[53]-A[4]*A[50]-A[7]*A[15]-A[8]*A[14]+A[15]*A[39]+A[18]*A[36]
    C.flat[168] = -A[0]*A[51]-A[2]*A[49]+A[7]*A[52]+A[10]*A[49]+A[14]*A[37]+A[16]*A[35]-A[21]*A[38]-A[24]*A[35]
    C.flat[200] = A[2]*A[25]+A[4]*A[23]-A[9]*A[18]-A[11]*A[16]+A[11]*A[55]+A[13]*A[53]-A[25]*A[41]-A[27]*A[39]
    C.flat[194] = A[2]*A[26]+A[5]*A[23]-A[9]*A[19]-A[12]*A[16]+A[12]*A[55]+A[13]*A[54]-A[26]*A[41]-A[27]*A[40]
    C.flat[179] = -A[2]*A[54]-A[5]*A[51]+A[10]*A[54]+A[12]*A[52]+A[16]*A[40]+A[19]*A[37]-A[24]*A[40]-A[26]*A[38]
    C.flat[196] = A[3]*A[26]+A[5]*A[24]-A[5]*A[55]-A[6]*A[54]-A[10]*A[19]-A[12]*A[17]+A[19]*A[41]+A[20]*A[40]
    C.flat[167] = -A[0]*A[54]-A[1]*A[52]-A[3]*A[50]-A[5]*A[49]+A[14]*A[40]+A[15]*A[38]+A[17]*A[36]+A[19]*A[35]
    C.flat[199] = A[1]*A[27]+A[4]*A[26]+A[5]*A[25]+A[6]*A[22]-A[8]*A[20]-A[11]*A[19]-A[12]*A[18]-A[13]*A[15]
    C.flat[197] = A[2]*A[24]-A[2]*A[55]+A[3]*A[23]-A[6]*A[51]-A[9]*A[17]-A[10]*A[16]+A[10]*A[55]+A[13]*A[52]+A[16]*A[41]+A[20]*A[37]-A[24]*A[41]-A[27]*A[38]
    C.flat[201] = A[0]*A[27]+A[3]*A[25]+A[4]*A[24]-A[4]*A[55]+A[6]*A[21]-A[6]*A[53]-A[7]*A[20]-A[10]*A[18]-A[11]*A[17]-A[13]*A[14]+A[18]*A[41]+A[20]*A[39]
    C.flat[189] = A[0]*A[24]-A[0]*A[55]+A[3]*A[21]-A[3]*A[53]-A[4]*A[52]-A[6]*A[49]-A[7]*A[17]-A[10]*A[14]+A[14]*A[41]+A[17]*A[39]+A[18]*A[38]+A[20]*A[35]
    C.flat[165] = -A[1]*A[51]-A[2]*A[50]+A[7]*A[54]+A[8]*A[52]+A[10]*A[50]+A[12]*A[49]+A[15]*A[37]+A[16]*A[36]-A[21]*A[40]-A[22]*A[38]-A[24]*A[36]-A[26]*A[35]
    C.flat[185] = A[1]*A[23]+A[2]*A[22]-A[8]*A[16]+A[8]*A[55]-A[9]*A[15]+A[11]*A[54]+A[12]*A[53]+A[13]*A[50]-A[22]*A[41]-A[25]*A[40]-A[26]*A[39]-A[27]*A[36]
    C.flat[188] = A[0]*A[23]+A[2]*A[21]-A[2]*A[53]-A[4]*A[51]-A[7]*A[16]+A[7]*A[55]-A[9]*A[14]+A[10]*A[53]+A[11]*A[52]+A[13]*A[49]+A[16]*A[39]+A[18]*A[37]-A[21]*A[41]-A[24]*A[39]-A[25]*A[38]-A[27]*A[35]
    C.flat[187] = A[0]*A[26]+A[1]*A[24]-A[1]*A[55]+A[3]*A[22]-A[4]*A[54]+A[5]*A[21]-A[5]*A[53]-A[6]*A[50]-A[7]*A[19]-A[8]*A[17]-A[10]*A[15]-A[12]*A[14]+A[15]*A[41]+A[18]*A[40]+A[19]*A[39]+A[20]*A[36]

    C = C/np.sqrt(np.sum(C*np.conj(C),axis=1,keepdims=True))

    def U(w,x,y,z):
        return np.array([x*z**2*w**2,y*z**2*w**2,x*z**2*y*w,z**2*y**2*w,x*z**2*y**2,z**2*y**3,x*z*w**2,z*w*x**2,y*z*w**2,y*z*w*x,z*y*x**2,w*z*y**2,z*y**2*x,z*y**3,z**2*w**2,x*z**2*w,z**2*y*w,x*z**2*y,z**2*y**2,x*w**2,x**2*w,x**3,y*w**2,y*w*x,y*x**2,w*y**2,x*y**2,y**3,z*w**2,z*w*x,z*x**2,w*z*y,z*y*x,z*y**2,z**2*w,x*z**2,z**2*y,w**2,w*x,x**2,w*y,x*y,y**2,z*w,z*x,z*y,z**2,w,x,y,z,1])

    return C,U