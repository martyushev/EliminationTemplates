import numpy as np

def coefs_hyb51f(data):
    qs = data[0].T.flat
    ps = data[1].T.flat
    tg = data[2].T.flat

    C = np.zeros((5,39))
    C.flat[33] = -2*ps[0]*qs[1]
    C.flat[32] = 2*ps[1]*qs[1]
    C.flat[72] = -2*ps[2]*qs[3]
    C.flat[71] = 2*ps[3]*qs[3]
    C.flat[111] = -2*ps[4]*qs[5]
    C.flat[110] = 2*ps[5]*qs[5]
    C.flat[150] = -2*ps[6]*qs[7]
    C.flat[149] = 2*ps[7]*qs[7]
    C.flat[189] = -2*ps[8]*qs[9]
    C.flat[188] = 2*ps[9]*qs[9]
    C.flat[[23,24]] = -2*qs[1]
    C.flat[38] = -qs[1]
    C.flat[[62,63]] = -2*qs[3]
    C.flat[77] = -qs[3]
    C.flat[[101,102]] = -2*qs[5]
    C.flat[116] = -qs[5]
    C.flat[[140,141]] = -2*qs[7]
    C.flat[155] = -qs[7]
    C.flat[[179,180]] = -2*qs[9]
    C.flat[194] = -qs[9]
    C.flat[25] = -2+2*qs[0]
    C.flat[64] = -2+2*qs[2]
    C.flat[103] = -2+2*qs[4]
    C.flat[142] = -2+2*qs[6]
    C.flat[181] = -2+2*qs[8]
    C.flat[22] = 2-2*qs[0]
    C.flat[61] = 2-2*qs[2]
    C.flat[100] = 2-2*qs[4]
    C.flat[139] = 2-2*qs[6]
    C.flat[178] = 2-2*qs[8]
    C.flat[[28,31]] = -ps[0]*tg[1]+ps[1]*tg[0]
    C.flat[[0,1,2,3]] = ps[0]*tg[1]-ps[1]*tg[0]
    C.flat[[67,70]] = -ps[2]*tg[4]+ps[3]*tg[3]
    C.flat[[39,40,41,42]] = ps[2]*tg[4]-ps[3]*tg[3]
    C.flat[[106,109]] = -ps[4]*tg[7]+ps[5]*tg[6]
    C.flat[[78,79,80,81]] = ps[4]*tg[7]-ps[5]*tg[6]
    C.flat[[117,118,119,120]] = ps[6]*tg[10]-ps[7]*tg[9]
    C.flat[[145,148]] = ps[7]*tg[9]-ps[6]*tg[10]
    C.flat[[184,187]] = -ps[8]*tg[13]+ps[9]*tg[12]
    C.flat[[156,157,158,159]] = ps[8]*tg[13]-ps[9]*tg[12]
    C.flat[[27,29]] = 2*ps[0]*tg[1]*qs[0]-2*ps[1]*tg[0]*qs[0]
    C.flat[26] = -2*ps[0]*tg[1]*qs[1]+2*ps[1]*tg[0]*qs[1]
    C.flat[30] = 2*ps[0]*tg[1]*qs[1]-2*ps[1]*tg[0]*qs[1]
    C.flat[[66,68]] = 2*ps[2]*tg[4]*qs[2]-2*ps[3]*tg[3]*qs[2]
    C.flat[65] = -2*ps[2]*tg[4]*qs[3]+2*ps[3]*tg[3]*qs[3]
    C.flat[69] = 2*ps[2]*tg[4]*qs[3]-2*ps[3]*tg[3]*qs[3]
    C.flat[[105,107]] = 2*ps[4]*tg[7]*qs[4]-2*ps[5]*tg[6]*qs[4]
    C.flat[104] = -2*ps[4]*tg[7]*qs[5]+2*ps[5]*tg[6]*qs[5]
    C.flat[108] = 2*ps[4]*tg[7]*qs[5]-2*ps[5]*tg[6]*qs[5]
    C.flat[[144,146]] = 2*ps[6]*tg[10]*qs[6]-2*ps[7]*tg[9]*qs[6]
    C.flat[143] = -2*ps[6]*tg[10]*qs[7]+2*ps[7]*tg[9]*qs[7]
    C.flat[147] = 2*ps[6]*tg[10]*qs[7]-2*ps[7]*tg[9]*qs[7]
    C.flat[[183,185]] = 2*ps[8]*tg[13]*qs[8]-2*ps[9]*tg[12]*qs[8]
    C.flat[182] = -2*ps[8]*tg[13]*qs[9]+2*ps[9]*tg[12]*qs[9]
    C.flat[186] = 2*ps[8]*tg[13]*qs[9]-2*ps[9]*tg[12]*qs[9]
    C.flat[[13,18]] = 2*tg[0]-2*ps[0]*tg[2]
    C.flat[[14,19]] = 2*tg[1]-2*ps[1]*tg[2]
    C.flat[[52,57]] = 2*tg[3]-2*ps[2]*tg[5]
    C.flat[[53,58]] = 2*tg[4]-2*ps[3]*tg[5]
    C.flat[[91,96]] = 2*tg[6]-2*ps[4]*tg[8]
    C.flat[[92,97]] = 2*tg[7]-2*ps[5]*tg[8]
    C.flat[[130,135]] = 2*tg[9]-2*ps[6]*tg[11]
    C.flat[[131,136]] = 2*tg[10]-2*ps[7]*tg[11]
    C.flat[[169,174]] = 2*tg[12]-2*ps[8]*tg[14]
    C.flat[[170,175]] = 2*tg[13]-2*ps[9]*tg[14]
    C.flat[9] = -ps[0]-ps[1]*qs[1]+ps[0]*qs[0]
    C.flat[35] = ps[0]-ps[0]*qs[0]-ps[1]*qs[1]
    C.flat[7] = ps[0]+ps[1]*qs[1]-ps[0]*qs[0]
    C.flat[5] = 2*ps[0]-2*ps[0]*qs[0]+2*ps[1]*qs[1]
    C.flat[4] = -ps[1]+ps[1]*qs[0]+ps[0]*qs[1]
    C.flat[34] = ps[1]+ps[0]*qs[1]-ps[1]*qs[0]
    C.flat[6] = ps[1]-ps[1]*qs[0]-ps[0]*qs[1]
    C.flat[8] = 2*ps[1]-2*ps[0]*qs[1]-2*ps[1]*qs[0]
    C.flat[48] = -ps[2]+ps[2]*qs[2]-ps[3]*qs[3]
    C.flat[74] = ps[2]-ps[2]*qs[2]-ps[3]*qs[3]
    C.flat[46] = ps[2]-ps[2]*qs[2]+ps[3]*qs[3]
    C.flat[44] = 2*ps[2]-2*ps[2]*qs[2]+2*ps[3]*qs[3]
    C.flat[43] = -ps[3]+ps[3]*qs[2]+ps[2]*qs[3]
    C.flat[45] = ps[3]-ps[2]*qs[3]-ps[3]*qs[2]
    C.flat[73] = ps[3]+ps[2]*qs[3]-ps[3]*qs[2]
    C.flat[47] = 2*ps[3]-2*ps[2]*qs[3]-2*ps[3]*qs[2]
    C.flat[87] = -ps[4]+ps[4]*qs[4]-ps[5]*qs[5]
    C.flat[113] = ps[4]-ps[4]*qs[4]-ps[5]*qs[5]
    C.flat[85] = ps[4]-ps[4]*qs[4]+ps[5]*qs[5]
    C.flat[83] = 2*ps[4]-2*ps[4]*qs[4]+2*ps[5]*qs[5]
    C.flat[82] = -ps[5]+ps[4]*qs[5]+ps[5]*qs[4]
    C.flat[84] = ps[5]-ps[4]*qs[5]-ps[5]*qs[4]
    C.flat[112] = ps[5]+ps[4]*qs[5]-ps[5]*qs[4]
    C.flat[86] = 2*ps[5]-2*ps[4]*qs[5]-2*ps[5]*qs[4]
    C.flat[126] = -ps[6]+ps[6]*qs[6]-ps[7]*qs[7]
    C.flat[124] = ps[6]-ps[6]*qs[6]+ps[7]*qs[7]
    C.flat[152] = ps[6]-ps[7]*qs[7]-ps[6]*qs[6]
    C.flat[122] = 2*ps[6]-2*ps[6]*qs[6]+2*ps[7]*qs[7]
    C.flat[121] = -ps[7]+ps[6]*qs[7]+ps[7]*qs[6]
    C.flat[123] = ps[7]-ps[6]*qs[7]-ps[7]*qs[6]
    C.flat[151] = ps[7]-ps[7]*qs[6]+ps[6]*qs[7]
    C.flat[125] = 2*ps[7]-2*ps[6]*qs[7]-2*ps[7]*qs[6]
    C.flat[165] = -ps[8]-ps[9]*qs[9]+ps[8]*qs[8]
    C.flat[191] = ps[8]-ps[8]*qs[8]-ps[9]*qs[9]
    C.flat[163] = ps[8]-ps[8]*qs[8]+ps[9]*qs[9]
    C.flat[161] = 2*ps[8]-2*ps[8]*qs[8]+2*ps[9]*qs[9]
    C.flat[160] = -ps[9]+ps[9]*qs[8]+ps[8]*qs[9]
    C.flat[190] = ps[9]+ps[8]*qs[9]-ps[9]*qs[8]
    C.flat[162] = ps[9]-ps[9]*qs[8]-ps[8]*qs[9]
    C.flat[164] = 2*ps[9]-2*ps[8]*qs[9]-2*ps[9]*qs[8]
    C.flat[193] = qs[8]*tg[12]+tg[13]*qs[9]-ps[8]*tg[14]*qs[8]-ps[9]*tg[14]*qs[9]
    C.flat[16] = -2*tg[0]*qs[1]-2*tg[1]*qs[0]+2*ps[0]*tg[2]*qs[1]+2*ps[1]*tg[2]*qs[0]
    C.flat[36] = -tg[0]*qs[1]+tg[1]*qs[0]+ps[0]*tg[2]*qs[1]-ps[1]*tg[2]*qs[0]
    C.flat[10] = tg[0]*qs[1]+tg[1]*qs[0]-ps[1]*tg[2]*qs[0]-ps[0]*tg[2]*qs[1]
    C.flat[12] = -tg[1]*qs[0]-tg[0]*qs[1]+ps[1]*tg[2]*qs[0]+ps[0]*tg[2]*qs[1]
    C.flat[17] = -tg[1]*qs[1]+tg[0]*qs[0]+ps[1]*tg[2]*qs[1]-ps[0]*tg[2]*qs[0]
    C.flat[15] = tg[1]*qs[1]-tg[0]*qs[0]-ps[1]*tg[2]*qs[1]+ps[0]*tg[2]*qs[0]
    C.flat[37] = tg[1]*qs[1]+tg[0]*qs[0]-ps[0]*tg[2]*qs[0]-ps[1]*tg[2]*qs[1]
    C.flat[11] = 2*tg[1]*qs[1]-2*tg[0]*qs[0]+2*ps[0]*tg[2]*qs[0]-2*ps[1]*tg[2]*qs[1]
    C.flat[55] = -2*tg[3]*qs[3]-2*tg[4]*qs[2]+2*ps[2]*tg[5]*qs[3]+2*ps[3]*tg[5]*qs[2]
    C.flat[51] = -tg[3]*qs[3]-tg[4]*qs[2]+ps[3]*tg[5]*qs[2]+ps[2]*tg[5]*qs[3]
    C.flat[75] = -tg[3]*qs[3]+tg[4]*qs[2]+ps[2]*tg[5]*qs[3]-ps[3]*tg[5]*qs[2]
    C.flat[49] = tg[3]*qs[3]+tg[4]*qs[2]-ps[3]*tg[5]*qs[2]-ps[2]*tg[5]*qs[3]
    C.flat[56] = -tg[4]*qs[3]+qs[2]*tg[3]-ps[2]*tg[5]*qs[2]+ps[3]*tg[5]*qs[3]
    C.flat[54] = tg[4]*qs[3]-qs[2]*tg[3]+ps[2]*tg[5]*qs[2]-ps[3]*tg[5]*qs[3]
    C.flat[76] = tg[4]*qs[3]+qs[2]*tg[3]-ps[2]*tg[5]*qs[2]-ps[3]*tg[5]*qs[3]
    C.flat[50] = 2*tg[4]*qs[3]-2*qs[2]*tg[3]+2*ps[2]*tg[5]*qs[2]-2*ps[3]*tg[5]*qs[3]
    C.flat[94] = -2*tg[6]*qs[5]-2*tg[7]*qs[4]+2*ps[4]*tg[8]*qs[5]+2*ps[5]*tg[8]*qs[4]
    C.flat[90] = -tg[6]*qs[5]-tg[7]*qs[4]+ps[4]*tg[8]*qs[5]+ps[5]*tg[8]*qs[4]
    C.flat[114] = -tg[6]*qs[5]+tg[7]*qs[4]+ps[4]*tg[8]*qs[5]-ps[5]*tg[8]*qs[4]
    C.flat[88] = tg[6]*qs[5]+tg[7]*qs[4]-ps[4]*tg[8]*qs[5]-ps[5]*tg[8]*qs[4]
    C.flat[95] = -tg[7]*qs[5]+qs[4]*tg[6]-ps[4]*tg[8]*qs[4]+ps[5]*tg[8]*qs[5]
    C.flat[93] = tg[7]*qs[5]-qs[4]*tg[6]+ps[4]*tg[8]*qs[4]-ps[5]*tg[8]*qs[5]
    C.flat[115] = tg[7]*qs[5]+qs[4]*tg[6]-ps[4]*tg[8]*qs[4]-ps[5]*tg[8]*qs[5]
    C.flat[89] = 2*tg[7]*qs[5]-2*qs[4]*tg[6]+2*ps[4]*tg[8]*qs[4]-2*ps[5]*tg[8]*qs[5]
    C.flat[133] = -2*tg[9]*qs[7]-2*tg[10]*qs[6]+2*ps[6]*tg[11]*qs[7]+2*ps[7]*tg[11]*qs[6]
    C.flat[129] = -tg[9]*qs[7]-tg[10]*qs[6]+ps[6]*tg[11]*qs[7]+ps[7]*tg[11]*qs[6]
    C.flat[153] = -tg[9]*qs[7]+tg[10]*qs[6]-ps[7]*tg[11]*qs[6]+ps[6]*tg[11]*qs[7]
    C.flat[127] = tg[9]*qs[7]+tg[10]*qs[6]-ps[6]*tg[11]*qs[7]-ps[7]*tg[11]*qs[6]
    C.flat[134] = -tg[10]*qs[7]+qs[6]*tg[9]-ps[6]*tg[11]*qs[6]+ps[7]*tg[11]*qs[7]
    C.flat[132] = tg[10]*qs[7]-qs[6]*tg[9]+ps[6]*tg[11]*qs[6]-ps[7]*tg[11]*qs[7]
    C.flat[154] = tg[10]*qs[7]+qs[6]*tg[9]-ps[6]*tg[11]*qs[6]-ps[7]*tg[11]*qs[7]
    C.flat[128] = 2*tg[10]*qs[7]-2*qs[6]*tg[9]+2*ps[6]*tg[11]*qs[6]-2*ps[7]*tg[11]*qs[7]
    C.flat[172] = -2*tg[12]*qs[9]-2*tg[13]*qs[8]+2*ps[8]*tg[14]*qs[9]+2*ps[9]*tg[14]*qs[8]
    C.flat[168] = -tg[13]*qs[8]-tg[12]*qs[9]+ps[9]*tg[14]*qs[8]+ps[8]*tg[14]*qs[9]
    C.flat[192] = tg[13]*qs[8]-tg[12]*qs[9]+ps[8]*tg[14]*qs[9]-ps[9]*tg[14]*qs[8]
    C.flat[166] = tg[13]*qs[8]+tg[12]*qs[9]-ps[9]*tg[14]*qs[8]-ps[8]*tg[14]*qs[9]
    C.flat[173] = -tg[13]*qs[9]+qs[8]*tg[12]-ps[8]*tg[14]*qs[8]+ps[9]*tg[14]*qs[9]
    C.flat[171] = tg[13]*qs[9]-qs[8]*tg[12]+ps[8]*tg[14]*qs[8]-ps[9]*tg[14]*qs[9]
    C.flat[167] = 2*tg[13]*qs[9]-2*qs[8]*tg[12]+2*ps[8]*tg[14]*qs[8]-2*ps[9]*tg[14]*qs[9]
    C.flat[[20,21]] = qs[1]
    C.flat[[59,60]] = qs[3]
    C.flat[[98,99]] = qs[5]
    C.flat[[137,138]] = qs[7]
    C.flat[[176,177]] = qs[9]

    C = C/np.sqrt(np.sum(C*np.conj(C),axis=1,keepdims=True))

    def U(a1,a2,a3,a4,a5):
        return np.array([a1**2*a3**2,a2**2*a3**2,a1**2*a4**2,a2**2*a4**2,a1**2*a3*a5,a1*a2*a3*a5,a2**2*a3*a5,a1**2*a4*a5,a1*a2*a4*a5,a2**2*a4*a5,a1**2*a3,a1*a2*a3,a2**2*a3,a1*a3**2,a2*a3**2,a1**2*a4,a1*a2*a4,a2**2*a4,a1*a4**2,a2*a4**2,a1**2*a5,a2**2*a5,a1*a5*a3,a5*a2*a3,a1*a4*a5,a2*a4*a5,a1*a3,a2*a3,a3**2,a1*a4,a2*a4,a4**2,a1*a5,a2*a5,a3*a5,a4*a5,a3,a4,a5])

    return C,U