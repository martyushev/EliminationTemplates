% Input: coefficient matrix C of size 2x16
% Output: solution matrix S of size 2x20

function S = red_14x34_colpiv_stitching(C)

    ix = [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14];
    jx = [7,9,11,12,13,15,16,18,19,21,22,23,26,27,33,34,8,10,12,14,15,17,18,21,22,25,26,27,30,32,33,34,9,11,13,15,16,18,19,20,22,23,24,26,27,28,31,33,10,12,15,17,18,21,22,24,26,27,28,29,31,32,33,34,2,3,4,6,11,13,16,18,19,20,22,23,24,27,28,33,3,4,5,6,12,15,18,21,22,24,26,27,28,31,33,34,1,4,5,6,14,17,21,25,26,28,29,30,31,32,33,34,7,9,11,12,13,15,16,18,19,21,22,23,26,27,33,34,8,10,12,14,15,17,18,21,22,25,26,27,30,32,33,34,9,11,13,15,16,18,19,20,22,23,24,26,27,28,31,33,10,12,15,17,18,21,22,24,26,27,28,29,31,32,33,34,2,3,4,6,11,13,16,18,19,20,22,23,24,27,28,33,3,4,5,6,12,15,18,21,22,24,26,27,28,31,33,34,1,4,5,6,14,17,21,25,26,28,29,30,31,32,33,34];
    kx = [1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31,1,3,5,7,9,11,13,15,17,19,21,23,31,25,27,29,1,3,5,7,9,11,13,23,15,17,27,19,21,29,31,25,1,3,5,7,9,11,13,23,15,17,27,31,29,19,21,25,23,27,29,31,1,3,5,7,9,17,11,13,21,15,25,19,23,27,31,29,1,3,5,7,9,17,11,13,21,25,15,19,31,23,29,27,1,3,5,7,9,17,25,19,21,11,13,15,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30,32,2,4,6,8,10,12,14,16,18,20,22,24,32,26,28,30,2,4,6,8,10,12,14,24,16,18,28,20,22,30,32,26,2,4,6,8,10,12,14,24,16,18,28,32,30,20,22,26,24,28,30,32,2,4,6,8,10,18,12,14,22,16,26,20,24,28,32,30,2,4,6,8,10,18,12,14,22,26,16,20,32,24,30,28,2,4,6,8,10,18,26,20,22,12,14,16];
    M = sparse(ix,jx,C(kx),14,34);

    [L,~,P] = lu(M(:,1:1));
    P = P';
    M = [P*L P(:,2:end)]\M(:,2:end);
    M = full(M(2:end,:));

    [L,U,P] = lu(M(:,1:5));
    P = P';
    M = [P*L P(:,6:end)]\M(:,6:end);
    M1 = M(1:5,:);
    M2 = M(6:end,:);

    [Q,R,P] = qr(M2(:,1:end-3));
    A = U\[M1(:,1:end-3)*P M1(:,end-2:end)];
    B = R(:,1:8)\[R(:,9:end) Q'*M2(:,end-2:end)];
    M = [-A(:,end-19:end)+A(:,1:end-20)*B; -B];

    P1 = [29:33 (1:25)*P 26:28];
    P2 = [3,4,5,6,7,9,10,11,12,13,15,16,17,29,20,21,14,30,26,27,18,31,32,23,33,28,22,25];
    T = getT(M,P1(1:end-20),P1(end-19:end),P2);

    [V,~] = eig(T);
    S = V(18:19,:)./repmat(V(20,:),2,1);

    I = ~isnan(S(1,:)) & ~isinf(S(1,:));
    %I = I & ~imag(S(1,:)); % uncomment this line for real roots only
    S = S(:,I);

end