% Input: coefficient matrix C of size 4x25
% Output: solution matrix S of size 2x14

function S = red_12x26_colpiv_pose_35pt(C)

    ix = [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12];
    jx = [1,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,1,2,3,5,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,3,4,5,6,7,8,9,10,13,14,15,16,18,19,20,22,23,25,1,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,1,2,3,5,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,3,4,5,6,7,8,9,10,13,14,15,16,18,19,20,22,23,25,1,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,1,2,3,5,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,3,4,5,6,7,8,9,10,13,14,15,16,18,19,20,22,23,25,1,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,1,2,3,5,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,3,4,5,6,7,8,9,10,13,14,15,16,18,19,20,22,23,25];
    kx = [1,5,37,57,73,85,93,97,17,21,25,29,33,41,45,49,53,61,65,69,77,81,89,17,1,21,25,41,45,49,53,57,61,65,69,73,77,81,85,89,93,97,17,1,21,57,73,85,93,97,41,45,49,53,61,65,69,77,81,89,2,6,38,58,74,86,94,98,18,22,26,30,34,42,46,50,54,62,66,70,78,82,90,18,2,22,26,42,46,50,54,58,62,66,70,74,78,82,86,90,94,98,18,2,22,58,74,86,94,98,42,46,50,54,62,66,70,78,82,90,3,7,39,59,75,87,95,99,19,23,27,31,35,43,47,51,55,63,67,71,79,83,91,19,3,23,27,43,47,51,55,59,63,67,71,75,79,83,87,91,95,99,19,3,23,59,75,87,95,99,43,47,51,55,63,67,71,79,83,91,4,8,40,60,76,88,96,100,20,24,28,32,36,44,48,52,56,64,68,72,80,84,92,20,4,24,28,44,48,52,56,60,64,68,72,76,80,84,88,92,96,100,20,4,24,60,76,88,96,100,44,48,52,56,64,68,72,80,84,92];
    M = sparse(ix,jx,C(kx),12,26);

    [L,~,P] = lu(M(:,1:6));
    P = P';
    M = [P*L P(:,7:end)]\M(:,7:end);
    M = full(M(7:end,:));

    [L,U,P] = lu(M(:,1:5));
    P = P';
    M = [P*L P(:,6:end)]\M(:,6:end);
    M1 = M(1:5,:);
    M2 = M(6:end,:);

    [Q,R,P] = qr(M2(:,1:end-3));
    A = U\[M1(:,1:end-3)*P M1(:,end-2:end)];
    B = R(:,1:1)\[R(:,2:end) Q'*M2(:,end-2:end)];
    M = [-A(:,end-13:end)+A(:,1:end-14)*B; -B];

    P1 = [16:20 (1:12)*P 13:15];
    P2 = [6,7,8,9,16,10,11,12,17,13,14,18,15,19,20];
    T = getT(M,P1(1:end-14),P1(end-13:end),P2);

    [V,~] = eig(T);
    S = V(12:13,:)./repmat(V(14,:),2,1);

    I = ~isnan(S(1,:)) & ~isinf(S(1,:));
    %I = I & ~imag(S(1,:)); % uncomment this line for real roots only
    S = S(:,I);

end