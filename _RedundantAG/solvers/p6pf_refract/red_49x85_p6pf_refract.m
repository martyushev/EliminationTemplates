% Input: coefficient matrix C of size 4x27
% Output: solution matrix S of size 4x36

function S = red_49x85_p6pf_refract(C)

    ix = [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,5,5,5,5,5,5,6,6,6,6,6,6,7,7,7,7,7,7,8,8,8,8,8,8,9,9,9,9,9,9,10,10,10,10,10,10,11,11,11,11,11,11,12,12,12,12,12,12,13,13,13,13,13,13,14,14,14,14,14,14,15,15,15,15,15,15,16,16,16,16,16,16,17,17,17,17,17,17,18,18,18,18,18,18,19,19,19,19,19,19,20,20,20,20,20,20,21,21,21,21,21,21,22,22,22,22,22,22,23,23,23,23,23,23,24,24,24,24,24,24,25,25,25,25,25,25,26,26,26,26,26,26,27,27,27,27,27,27,28,28,28,28,28,28,29,29,29,29,29,29,30,30,30,30,30,30,31,31,31,31,31,31,32,32,32,32,32,32,33,33,33,33,33,33,34,34,34,34,34,34,35,35,35,35,35,35,36,36,36,36,36,36,37,37,37,37,37,37,38,38,38,38,38,38,39,39,39,39,39,39,40,40,40,40,40,40,41,41,41,41,41,41,42,42,42,42,42,42,43,43,43,43,43,43,44,44,44,44,44,44,45,45,45,45,45,45,46,46,46,46,46,46,47,47,47,47,47,47,48,48,48,48,48,48,49,49,49,49,49,49];
    jx = [7,10,13,14,19,20,22,23,25,27,28,32,38,39,41,42,43,44,45,47,66,72,74,81,83,85,8,9,11,14,15,17,20,21,23,24,26,28,29,31,32,33,34,35,40,44,48,67,70,75,79,82,11,12,16,18,23,24,25,26,30,34,35,40,41,44,45,46,49,67,68,69,71,73,76,80,82,83,11,23,36,66,67,82,6,13,14,20,28,32,7,23,39,40,44,82,8,16,24,30,34,40,17,26,31,35,41,67,22,23,27,38,74,84,9,23,24,70,75,77,11,25,26,71,76,78,19,74,81,82,84,85,20,30,75,77,79,82,23,31,76,78,80,83,43,44,47,72,84,85,28,34,44,48,77,79,35,45,49,78,80,82,7,11,23,37,67,82,13,23,40,44,66,82,14,16,24,30,34,67,17,26,31,35,40,68,10,19,23,27,74,84,11,20,24,70,75,77,12,23,26,71,76,78,22,72,74,82,84,85,23,28,30,75,77,79,25,31,76,78,80,82,42,44,47,81,84,85,32,34,48,77,79,82,35,44,49,78,80,83,1,50,51,52,55,58,2,53,54,55,58,61,3,56,57,58,61,64,4,59,60,61,64,65,5,38,62,63,64,65,6,7,19,38,66,72,8,11,23,67,68,82,14,23,40,41,44,82,15,16,17,24,30,34,16,17,18,26,31,35,20,23,25,27,74,84,21,24,26,70,75,77,24,26,69,71,76,78,28,74,82,83,84,85,29,30,31,75,77,79,30,31,73,76,78,80,32,44,45,47,84,85,33,34,35,48,77,79,34,35,46,49,78,80];
    kx = [1,13,17,21,33,37,41,45,49,53,61,81,9,25,29,77,85,89,93,105,5,57,73,65,69,101,1,9,13,17,21,29,33,37,41,45,49,57,61,69,77,81,89,93,25,85,105,5,53,73,101,65,9,13,21,29,33,37,41,45,61,81,89,17,25,77,85,93,105,1,5,49,53,69,73,101,57,65,98,102,58,86,90,106,58,86,90,98,102,106,58,98,86,90,106,102,58,90,98,102,106,86,90,98,102,106,86,58,86,90,98,58,102,106,58,86,90,98,102,106,58,86,90,98,102,106,58,98,86,90,102,106,58,90,98,102,106,86,58,90,98,102,106,86,86,90,106,58,98,102,58,90,86,106,98,102,90,86,106,98,102,58,79,99,103,67,91,107,79,99,91,107,67,103,79,91,99,103,107,67,91,99,103,107,79,67,67,79,91,99,103,107,67,79,91,99,103,107,67,79,91,99,103,107,67,79,99,91,103,107,67,79,91,99,103,107,67,91,99,103,107,79,79,91,107,67,99,103,79,91,107,99,103,67,91,79,107,99,103,67,84,92,96,100,104,108,84,92,96,100,104,108,84,92,96,100,104,108,84,92,96,100,104,108,84,108,92,96,100,104,84,92,104,100,96,108,84,100,104,92,96,108,84,100,92,96,108,104,84,92,96,100,104,108,84,92,96,100,104,108,84,92,96,100,104,108,84,92,96,100,104,108,84,92,96,100,104,108,84,100,92,96,104,108,84,92,96,100,104,108,84,92,96,100,104,108,84,92,96,108,100,104,84,92,96,108,100,104,84,92,96,108,100,104];
    M = sparse(ix,jx,C(kx),49,85);

    [L,~,P] = lu(M(:,1:35));
    P = P';
    M = [P*L P(:,36:end)]\M(:,36:end);
    M = M(end-13:end,:);

    T = zeros(36);
    T([13,14,16,17,18,19,23,32,33,34,24,36,30,31],:) = -M(:,1:14)\M(:,15:end);
    T([109,146,183,220,257,294,331,368,405,442,479,516,555,848,921,958,1249,998,1035,1072,1109,1295]) = 1;

    [V,~] = eig(T);
    S = V(32:35,:)./repmat(V(36,:),4,1);

    I = ~isnan(S(1,:)) & ~isinf(S(1,:));
    %I = I & ~imag(S(1,:)); % uncomment this line for real roots only
    S = S(:,I);
    
    y = sqrt(S(3,:));
    wx = S([1,2],:)./y;
    z = S(4,:);
    S = [wx -wx; y -y; z z];

end