% Input: coefficient matrix C of size 3x39
% Output: solution matrix S of size 3x19

function S = red_21x40_colpiv_8ptF_radial(C)

    ix = [1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,9,9,9,9,9,9,9,9,9,9,10,10,10,10,10,10,10,10,10,10,11,11,11,11,11,11,11,11,11,11,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,13,13,13,14,14,14,14,14,14,14,14,14,14,15,15,15,15,15,15,15,15,15,15,16,16,16,16,16,16,16,16,16,16,17,17,17,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21];
    jx = [1,2,5,11,12,13,21,22,23,31,5,6,8,22,24,25,31,32,35,38,12,14,15,22,24,25,31,32,35,38,2,3,6,13,15,16,23,25,26,32,3,4,7,16,19,20,26,29,30,34,6,7,9,25,28,29,32,34,36,37,14,17,18,24,27,28,33,37,38,40,24,27,28,33,35,36,37,38,39,40,15,18,19,25,28,29,32,34,36,37,8,9,10,33,35,36,37,38,39,40,1,2,5,11,12,13,21,22,23,31,5,6,8,22,24,25,31,32,35,38,12,14,15,22,24,25,31,32,35,38,2,3,6,13,15,16,23,25,26,32,3,4,7,16,19,20,26,29,30,34,6,7,9,25,28,29,32,34,36,37,14,17,18,24,27,28,33,37,38,40,24,27,28,33,35,36,37,38,39,40,15,18,19,25,28,29,32,34,36,37,8,9,10,33,35,36,37,38,39,40,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40];
    kx = [109,106,115,82,85,79,100,103,97,112,109,106,115,82,85,79,100,97,112,103,82,85,79,100,103,97,109,106,115,112,109,106,115,82,85,79,100,103,97,112,109,106,115,82,85,79,100,103,97,112,109,106,115,82,85,79,100,97,112,103,82,85,79,100,103,97,112,106,109,115,82,85,79,103,109,106,97,100,115,112,82,85,79,100,103,97,109,106,115,112,109,106,115,85,100,97,79,82,112,103,110,107,116,83,86,80,101,104,98,113,110,107,116,83,86,80,101,98,113,104,83,86,80,101,104,98,110,107,116,113,110,107,116,83,86,80,101,104,98,113,110,107,116,83,86,80,101,104,98,113,110,107,116,83,86,80,101,98,113,104,83,86,80,101,104,98,113,107,110,116,83,86,80,104,110,107,98,101,116,113,83,86,80,101,104,98,110,107,116,113,110,107,116,86,101,98,80,83,113,104,69,66,63,60,96,93,90,111,108,117,12,21,9,27,18,6,24,15,3,39,48,36,54,45,33,57,51,42,30,78,75,87,72,102,99,81,84,114,105];
    M = sparse(ix,jx,C(kx),21,40);

    M = full(M);

    [L,U,P] = lu(M(:,1:10));
    P = P';
    M = [P*L P(:,11:end)]\M(:,11:end);
    M1 = M(1:10,:);
    M2 = M(11:end,:);

    [Q,R,P] = qr(M2(:,1:end-4));
    A = U\[M1(:,1:end-4)*P M1(:,end-3:end)];
    B = R(:,1:11)\[R(:,12:end) Q'*M2(:,end-3:end)];
    M = [-A(:,end-18:end)+A(:,1:end-19)*B; -B];

    P1 = [31:40 (1:26)*P 27:30];
    P2 = [11,12,13,14,15,16,17,18,19,20,31,21,32,28,22,33,23,27,24,34,35,36,30,37,38,39,26,25,40,29];
    T = getT(M,P1(1:end-19),P1(end-18:end),P2);

    [V,~] = eig(T);
    S([1,2],:) = V([16,17],:)./repmat(V(19,:),2,1);
    S(3,:) = V(19,:)./V(18,:);

    I = ~isnan(S(1,:)) & ~isinf(S(1,:));
    %I = I & ~imag(S(1,:)); % uncomment this line for real roots only
    S = S(:,I);

end