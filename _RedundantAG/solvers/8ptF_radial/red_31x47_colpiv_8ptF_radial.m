% Input: coefficient matrix C of size 3x39
% Output: solution matrix S of size 3x16

function S = red_31x47_colpiv_8ptF_radial(C)

    ix = [1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,9,9,9,9,9,9,9,9,9,9,10,10,10,10,10,10,10,10,10,10,11,11,11,11,11,11,11,11,11,11,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,13,13,13,14,14,14,14,14,14,14,14,14,15,15,15,15,15,15,15,15,15,15,16,16,16,16,16,16,16,16,16,16,17,17,17,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,25,25,25,25,25,25,25,25,25,25,26,26,26,26,26,26,26,26,26,26,27,27,27,27,27,27,27,27,27,27,28,28,28,28,28,28,28,28,28,28,29,29,29,29,29,29,29,29,29,30,30,30,30,30,30,30,30,30,30,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31];
    jx = [2,3,14,18,19,22,28,29,32,38,12,13,14,19,20,23,29,30,33,39,6,7,12,20,21,24,30,31,34,40,2,11,13,32,33,35,38,39,41,44,6,13,33,34,36,39,40,42,45,8,9,16,18,19,22,28,29,32,38,15,16,17,19,20,23,29,30,33,39,5,10,17,20,21,24,30,31,34,40,22,23,25,32,33,35,38,39,41,44,23,24,26,33,34,36,39,40,42,45,35,36,37,41,42,43,44,45,46,47,1,8,15,22,23,25,38,39,41,44,4,5,15,23,24,26,39,40,42,45,1,4,25,26,27,44,45,46,47,25,26,27,41,42,43,44,45,46,47,2,3,14,18,19,22,28,29,32,38,12,13,14,19,20,23,29,30,33,39,6,7,12,20,21,24,30,31,34,40,2,11,13,32,33,35,38,39,41,44,6,13,33,34,36,39,40,42,45,8,9,16,18,19,22,28,29,32,38,15,16,17,19,20,23,29,30,33,39,5,10,17,20,21,24,30,31,34,40,23,24,26,33,34,36,39,40,42,45,22,23,25,32,33,35,38,39,41,44,35,36,37,41,42,43,44,45,46,47,1,8,15,22,23,25,38,39,41,44,4,5,15,23,24,26,39,40,42,45,1,4,25,26,27,44,45,46,47,25,26,27,41,42,43,44,45,46,47,2,3,6,7,11,12,13,14,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47];
    kx = [85,79,82,106,109,115,97,100,103,112,82,85,79,106,109,115,97,100,103,112,85,82,79,106,109,115,97,100,103,112,79,85,82,97,100,103,106,109,112,115,82,79,97,100,103,106,109,112,115,115,106,109,97,100,112,79,82,85,103,115,106,109,97,100,112,79,82,85,103,115,109,106,97,100,112,79,82,85,103,106,109,115,79,82,85,97,100,103,112,106,109,115,79,82,85,97,100,103,112,79,82,85,97,100,103,106,109,112,115,115,106,109,97,100,112,79,82,85,103,115,109,106,97,100,112,79,82,85,103,106,109,97,100,112,79,82,85,103,106,109,115,79,82,85,97,100,103,112,86,80,83,107,110,116,98,101,104,113,83,86,80,107,110,116,98,101,104,113,86,83,80,107,110,116,98,101,104,113,80,86,83,98,101,104,107,110,113,116,83,80,98,101,104,107,110,113,116,116,107,110,98,101,113,80,83,86,104,116,107,110,98,101,113,80,83,86,104,116,110,107,98,101,113,80,83,86,104,107,110,116,80,83,86,98,101,104,113,107,110,116,80,83,86,98,101,104,113,80,83,86,98,101,104,107,110,113,116,116,107,110,98,101,113,80,83,86,104,116,110,107,98,101,113,80,83,86,104,107,110,98,101,113,80,83,86,104,107,110,116,80,83,86,98,101,104,113,15,3,21,12,24,9,18,6,60,63,66,69,90,93,96,108,111,117,30,33,36,39,42,45,48,51,54,57,72,75,78,81,84,87,99,102,105,114];
    M = sparse(ix,jx,C(kx),31,47);

    [L,~,P] = lu(M(:,1:17));
    P = P';
    M = [P*L P(:,18:end)]\M(:,18:end);
    M = full(M(18:end,:));

    [L,U,P] = lu(M(:,1:10));
    P = P';
    M = [P*L P(:,11:end)]\M(:,11:end);
    M1 = M(1:10,:);
    M2 = M(11:end,:);

    [Q,R,P] = qr(M2(:,1:end-4));
    A = U\[M1(:,1:end-4)*P M1(:,end-3:end)];
    B = R(:,1:4)\[R(:,5:end) Q'*M2(:,end-3:end)];
    M = [-A(:,end-15:end)+A(:,1:end-16)*B; -B];

    P1 = [21:30 (1:16)*P 17:20];
    P2 = [21,22,23,24,11,12,13,14,15,16,25,26,27,17,18,19,28,29,20,30];
    T = getT(M,P1(1:end-16),P1(end-15:end),P2);

    [V,~] = eig(T);
    S = V(13:15,:)./repmat(V(16,:),3,1);

    I = ~isnan(S(1,:)) & ~isinf(S(1,:));
    %I = I & ~imag(S(1,:)); % uncomment this line for real roots only
    S = S(:,I);

end