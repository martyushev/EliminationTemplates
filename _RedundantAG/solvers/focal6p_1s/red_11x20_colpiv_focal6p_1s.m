% Input: coefficient matrix C of size 10x20
% Output: solution matrix S of size 3x9

function S = red_11x20_colpiv_focal6p_1s(C)

    ix = [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,10,10,10,10,10,10,10,10,10,10,11,11,11,11,11,11,11,11,11,11];
    jx = [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,1,2,3,4,5,6,7,10,11,12,13,14,15,16,17,18,19,20,2,3,4,5,6,7,9,10,11,12,13,14,15,16,17,18,19,20,2,3,4,5,6,7,8,12,13,14,15,16,17,18,19,20,2,5,7,8,13,15,16,18,19,20,1,3,4,6,9,10,11,12,14,17];
    kx = [31,101,81,131,151,161,181,191,1,11,21,41,51,61,71,91,111,121,141,171,32,102,82,132,152,162,182,192,2,12,22,42,52,62,72,92,112,122,142,172,33,103,83,133,153,163,183,193,3,13,23,43,53,63,73,93,113,123,143,173,34,104,84,134,154,164,184,194,4,14,24,44,54,64,74,94,114,124,144,174,35,105,85,135,155,165,185,195,5,15,25,45,55,65,75,95,115,125,145,175,36,106,86,136,156,166,186,196,6,16,26,46,56,66,76,96,116,126,146,176,37,107,87,137,157,167,187,17,27,47,57,67,77,97,117,127,147,177,108,88,138,158,168,188,8,18,28,48,58,68,78,98,118,128,148,178,109,89,139,159,169,189,199,49,59,69,79,99,119,129,149,179,110,160,190,200,60,80,100,130,150,180,110,160,190,200,60,80,100,130,150,180];
    M = sparse(ix,jx,C(kx),11,20);

    [L,~,P] = lu(M(:,1:2));
    P = P';
    M = [P*L P(:,3:end)]\M(:,3:end);
    M = full(M(3:end,:));

    [L,U,P] = lu(M(:,1:6));
    P = P';
    M = [P*L P(:,7:end)]\M(:,7:end);
    M1 = M(1:6,:);
    M2 = M(7:end,:);

    [Q,R,P] = qr(M2(:,1:end-4));
    A = U\[M1(:,1:end-4)*P M1(:,end-3:end)];
    B = R(:,1:3)\[R(:,4:end) Q'*M2(:,end-3:end)];
    M = [-A(:,end-8:end)+A(:,1:end-9)*B; -B];

    P1 = [13:18 (1:8)*P 9:12];
    P2 = [4,6,13,9,10,14,11,15,16,12,17,18];
    T = getT(M,P1(1:end-9),P1(end-8:end),P2);

    [V,~] = eig(T);
    S = V(6:8,:)./repmat(V(9,:),3,1);

    I = ~isnan(S(1,:)) & ~isinf(S(1,:));
    %I = I & ~imag(S(1,:)); % uncomment this line for real roots only
    S = S(:,I);

end