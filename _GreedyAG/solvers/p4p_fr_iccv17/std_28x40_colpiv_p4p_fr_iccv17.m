% Input: coefficient matrix C of size 9x40

function [w,x,y,z] = std_28x40_colpiv_p4p_fr_iccv17(C)

    i_dx = [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,9,9,9,9,9,9,9,9,9,9,10,10,10,10,10,10,10,10,10,10,11,11,11,11,11,11,11,11,11,11,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,13,13,13,14,14,14,14,14,14,14,14,14,14,15,15,15,15,15,15,15,15,15,15,16,16,16,16,16,16,16,16,16,16,17,17,17,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28];
    j_dx = [9,10,11,12,13,14,15,16,17,18,19,20,21,22,24,27,28,30,33,37,1,2,3,5,6,7,10,11,13,16,17,19,22,23,25,29,30,31,34,38,2,3,4,6,7,8,12,13,14,18,19,20,24,25,26,32,33,34,35,39,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,9,10,11,12,13,14,15,16,17,18,19,20,21,22,24,27,28,30,33,37,1,2,3,5,6,7,10,11,13,16,17,19,22,23,25,29,30,31,34,38,2,3,4,6,7,8,12,13,14,18,19,20,24,25,26,32,33,34,35,39,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,9,10,11,12,13,14,21,22,24,27,1,2,3,10,11,13,22,23,25,29,2,3,4,12,13,14,24,25,26,32,21,22,23,24,25,26,27,29,32,36,15,16,17,18,19,20,28,30,33,37,5,6,7,16,17,19,30,31,34,38,6,7,8,18,19,20,33,34,35,39,28,30,31,33,34,35,37,38,39,40,9,10,11,12,13,14,21,22,24,27,1,2,3,10,11,13,22,23,25,29,2,3,4,12,13,14,24,25,26,32,21,22,23,24,25,26,27,29,32,36,15,16,17,18,19,20,28,30,33,37,5,6,7,16,17,19,30,31,34,38,6,7,8,18,19,20,33,34,35,39,28,30,31,33,34,35,37,38,39,40,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40];
    C_dx = [91,109,127,154,172,199,244,262,271,289,298,307,235,253,280,316,325,334,343,352,127,172,199,271,298,307,91,109,154,244,262,289,235,253,280,316,325,334,343,352,127,172,199,271,298,307,91,109,154,244,262,289,235,253,280,316,325,334,343,352,91,109,127,154,172,199,235,244,253,262,271,280,289,298,307,316,325,334,343,352,92,110,128,155,173,200,245,263,272,290,299,308,236,254,281,317,326,335,344,353,128,173,200,272,299,308,92,110,155,245,263,290,236,254,281,317,326,335,344,353,128,173,200,272,299,308,92,110,155,245,263,290,236,254,281,317,326,335,344,353,92,110,128,155,173,200,236,245,254,263,272,281,290,299,308,317,326,335,344,353,246,264,273,291,300,309,327,336,345,354,273,300,309,246,264,291,327,336,345,354,273,300,309,246,264,291,327,336,345,354,246,264,273,291,300,309,327,336,345,354,246,264,273,291,300,309,327,336,345,354,273,300,309,246,264,291,327,336,345,354,273,300,309,246,264,291,327,336,345,354,246,264,273,291,300,309,327,336,345,354,247,265,274,292,301,310,328,337,346,355,274,301,310,247,265,292,328,337,346,355,274,301,310,247,265,292,328,337,346,355,247,265,274,292,301,310,328,337,346,355,247,265,274,292,301,310,328,337,346,355,274,301,310,247,265,292,328,337,346,355,274,301,310,247,265,292,328,337,346,355,247,265,274,292,301,310,328,337,346,355,32,59,77,86,149,194,221,230,5,14,23,41,50,68,104,122,140,167,185,212,95,113,131,158,176,203,239,248,257,266,275,284,293,302,311,320,329,338,347,356,33,60,78,87,150,195,222,231,6,15,24,42,51,69,105,123,141,168,186,213,96,114,132,159,177,204,240,249,258,267,276,285,294,303,312,321,330,339,348,357,34,61,79,88,151,196,223,232,7,16,25,43,52,70,106,124,142,169,187,214,97,115,133,160,178,205,241,250,259,268,277,286,295,304,313,322,331,340,349,358,35,62,80,89,152,197,224,233,8,17,26,44,53,71,107,125,143,170,188,215,98,116,134,161,179,206,242,251,260,269,278,287,296,305,314,323,332,341,350,359];
    M = sparse(i_dx,j_dx,C(C_dx),28,40);

    [L,~,Pi] = lu(M(:,1:8));
    Pi = Pi';
    M = [Pi*L Pi(:,9:end)]\M(:,9:end);
    M = full(M(9:end,:));

    [L,UR,Pi] = lu(M(:,1:12));
    Pi = Pi';
    M = [Pi*L Pi(:,13:end)]\M(:,13:end);
    MP = M(1:12,:);
    NP = M(13:end,:);

    [Q,U,Pi] = qr(NP(:,1:end-5));
    A = UR\[MP(:,1:end-5)*Pi MP(:,end-4:end)];
    B = U(:,1:8)\[U(:,9:end) Q'*NP(:,end-4:end)];
    M = [-A(:,end-11:end)+A(:,1:end-12)*B; -B];

    xP = [21,22,23,24,25,26,1,27,2,28,29,4,30,31,32,7,8,10,13,17];
    P1 = [(1:15)*Pi 16:20];
    T = getT(M,[21:32 P1(1:end-12)],P1(end-11:end),xP);

    [V,D] = eig(T);
    sol = [V([8,10,11],:)./repmat(V(12,:),3,1); diag(D).'];

    I = find(not(isnan(sol(1,:))) & not(isinf(sol(1,:))));
    %I = I(not(imag(sol(1,:)))); % uncomment this line for real roots only
    w = sol(1,I);
    y = sol(2,I);
    z = sol(3,I);
    x = sol(4,I);

end