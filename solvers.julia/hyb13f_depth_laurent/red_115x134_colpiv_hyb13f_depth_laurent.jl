# Input: coefficient matrix C of size 20x99
# Output: solution matrix S of size 6x19

function red_115x134_colpiv_hyb13f_depth_laurent(C::Array{Float64})

    M = sparse([1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,9,9,9,9,9,9,9,9,9,10,10,10,10,10,10,10,10,10,11,11,11,11,11,11,11,11,11,11,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,13,14,14,14,14,14,14,14,14,14,15,15,15,15,15,15,15,15,16,16,16,16,16,16,16,16,16,16,16,17,17,17,17,17,17,17,17,17,17,17,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,25,25,25,25,25,25,25,25,25,25,26,26,26,26,26,26,26,27,27,27,27,27,27,27,27,27,27,28,28,28,28,28,28,28,28,28,28,29,29,29,29,29,29,29,29,29,29,30,30,30,30,30,30,30,30,30,30,31,31,31,31,31,31,31,31,31,32,32,32,32,32,32,32,32,32,33,33,33,33,33,33,33,33,33,34,34,34,34,34,34,34,34,34,34,35,35,35,35,35,35,35,35,35,35,36,36,36,36,36,36,36,36,37,37,37,37,37,37,37,37,37,37,38,38,38,38,38,38,38,38,39,39,39,39,39,39,39,39,39,39,40,40,40,40,40,40,40,40,40,40,41,41,41,41,41,41,41,42,42,42,42,42,42,42,42,42,43,43,43,43,43,43,43,43,43,43,44,44,44,44,44,44,44,44,44,44,45,45,45,45,45,45,45,46,46,46,46,46,46,46,46,46,47,47,47,47,47,47,47,47,47,47,48,48,48,48,48,48,48,48,48,48,49,49,49,49,49,49,49,49,50,50,50,50,50,50,50,50,50,51,51,51,51,51,51,51,51,51,51,52,52,52,52,52,52,52,53,53,53,53,53,53,53,53,53,54,54,54,54,54,54,54,54,54,55,55,55,55,55,55,56,56,56,56,56,56,56,56,56,57,57,57,57,57,57,57,57,57,58,58,58,58,58,58,58,58,59,59,59,59,59,59,59,59,59,60,60,60,60,60,60,60,60,60,61,61,61,61,61,61,61,61,61,61,62,62,62,62,62,62,62,62,62,62,63,63,63,63,63,63,63,63,63,63,64,64,64,64,64,64,64,64,65,65,65,65,65,65,65,65,65,65,66,66,66,66,66,66,66,66,66,66,67,67,67,67,67,67,67,67,68,68,68,68,68,68,68,68,68,69,69,69,69,69,69,69,69,69,69,70,70,70,70,70,70,70,70,71,71,71,71,71,71,71,71,71,72,72,72,72,72,72,72,72,72,73,73,73,73,73,73,73,73,73,74,74,74,74,74,74,74,74,75,75,75,75,75,75,75,75,75,76,76,76,76,76,76,76,76,76,77,77,77,77,77,77,77,77,77,78,78,78,78,78,78,78,78,79,79,79,79,79,79,79,79,79,80,80,80,80,80,80,80,80,81,81,81,81,81,81,81,81,81,82,82,82,82,82,82,82,82,82,83,83,83,83,83,83,83,83,83,84,84,84,84,84,84,84,84,84,85,85,85,85,85,85,85,85,85,86,86,86,86,86,86,86,86,87,87,87,87,87,87,87,87,87,88,88,88,88,88,88,88,88,88,89,89,89,89,89,90,90,90,90,90,90,90,91,91,91,91,91,91,91,91,92,92,92,92,92,92,92,92,92,93,93,93,93,93,93,93,93,93,94,94,94,94,94,94,94,94,94,95,95,95,95,95,95,95,95,96,96,96,96,96,96,96,96,97,97,97,97,97,97,97,97,98,98,98,98,98,98,98,99,99,99,99,99,99,99,100,100,100,100,100,100,100,101,101,101,101,101,101,101,102,102,102,102,102,103,103,103,103,103,103,104,104,104,104,104,104,105,105,105,105,105,105,105,106,106,106,106,106,106,107,107,107,107,107,107,108,108,108,108,109,109,109,109,109,109,110,110,110,110,110,110,110,111,111,111,111,111,111,111,112,112,112,112,112,112,112,113,113,113,113,113,113,113,114,114,114,114,114,115,115,115,115,115,115,115],[19,31,32,57,58,72,77,92,101,110,19,31,32,65,72,82,116,129,130,17,27,28,44,54,55,70,75,89,97,106,17,27,28,63,64,70,80,113,119,126,19,31,32,57,58,71,76,101,110,3,14,16,17,27,43,44,54,100,109,19,31,32,65,71,81,129,130,3,15,16,17,27,59,63,121,128,1,2,5,6,8,23,40,115,121,3,14,16,19,31,43,57,100,109,17,27,28,44,54,55,69,74,97,106,85,86,102,103,107,108,122,123,127,133,3,15,16,19,31,59,121,128,17,27,28,63,64,69,79,119,126,1,2,5,7,9,40,115,121,16,25,26,43,51,53,68,73,87,94,103,16,25,26,59,61,62,68,78,111,117,123,19,31,32,57,58,101,110,3,14,16,17,25,43,44,51,99,108,3,14,20,21,27,45,46,54,98,107,19,31,32,65,129,130,3,15,16,17,25,59,61,120,127,7,9,12,38,56,92,101,1,4,6,8,18,30,35,91,100,1,4,5,6,10,18,24,36,90,99,7,9,12,33,56,116,130,85,86,102,105,107,109,122,125,128,133,83,85,93,96,98,100,118,121,131,134,3,14,21,31,46,57,72,77,98,107,3,14,17,26,44,53,69,74,96,105,3,15,21,31,48,72,82,133,134,3,15,17,26,62,69,79,118,125,3,14,17,19,32,44,58,99,108,16,25,26,43,51,53,69,74,94,103,85,86,104,106,107,109,124,126,128,133,3,15,17,19,32,65,120,127,16,25,26,59,61,62,69,79,117,123,1,2,6,7,12,33,114,120,85,86,102,104,108,109,122,124,127,128,83,85,93,95,99,100,120,121,131,132,3,14,19,27,54,100,109,3,14,19,25,51,71,76,99,108,3,14,22,27,47,54,70,75,95,104,3,14,22,25,47,51,68,73,93,102,3,15,19,27,63,121,128,3,15,19,25,61,71,81,120,127,3,15,22,27,49,63,70,80,124,132,3,15,22,25,49,61,68,78,122,131,17,27,28,44,54,55,97,106,3,14,16,19,26,43,53,96,105,3,14,20,22,31,45,47,57,95,104,17,27,28,63,64,119,126,3,15,16,19,26,59,62,118,125,3,15,20,22,31,49,60,124,132,1,4,7,9,91,100,6,8,13,18,35,39,56,89,97,1,4,5,7,11,24,37,88,96,6,8,13,23,29,56,113,119,1,2,5,7,11,40,42,112,118,3,14,17,19,28,44,55,96,105,16,25,26,43,51,53,71,76,94,103,3,14,21,22,32,46,47,58,93,102,85,86,104,107,109,110,124,128,129,133,3,15,17,19,28,64,118,125,16,25,26,59,61,62,71,81,117,123,3,15,21,22,32,48,49,65,122,131,1,4,7,12,34,38,90,99,1,4,6,7,13,18,39,88,96,5,10,11,24,36,37,50,67,87,94,1,2,6,7,13,29,112,118,85,94,96,99,100,117,118,120,121,20,21,22,45,46,47,68,73,84,83,87,88,90,91,111,112,114,115,1,4,8,9,12,35,38,98,85,96,97,99,100,118,119,120,121,3,14,27,31,32,54,57,58,107,20,21,22,45,46,47,70,75,84,1,2,8,9,12,23,33,134,83,88,89,90,91,112,113,114,115,1,4,8,9,13,35,39,95,1,4,10,11,12,36,37,38,93,85,96,99,100,101,118,120,121,130,3,14,27,28,31,54,55,57,104,3,14,25,26,32,51,53,58,102,20,21,22,45,46,47,72,77,84,1,2,8,9,13,23,29,132,1,2,10,11,12,33,41,42,131,83,88,90,91,92,112,114,115,116,6,7,18,56,100,5,7,24,34,50,67,99,5,6,7,18,24,52,66,96,3,14,16,20,43,45,91,100,109,3,15,16,20,59,60,115,121,128,3,14,17,21,44,46,90,99,108,3,15,17,21,48,114,120,127,3,14,19,22,47,88,96,105,3,15,19,22,49,112,118,125,1,4,8,10,35,36,98,3,14,25,27,51,54,107,1,2,8,10,23,41,134,3,15,25,27,61,63,133,7,50,56,67,101,5,6,18,24,30,100,1,4,9,11,37,95,3,14,26,31,53,57,104,1,2,9,11,42,132,3,15,26,31,62,124,5,7,24,100,6,18,52,56,66,97,1,4,12,13,38,39,93,3,14,28,32,55,58,102,1,2,12,13,29,33,131,3,15,28,32,64,65,122,6,7,18,34,99,5,24,50,52,66,67,94],C[[1041,1021,981,1461,1421,961,1401,1281,1741,1921,1481,1461,1421,981,1401,961,1281,1921,1741,1042,1022,902,1482,1462,1342,882,1322,1262,1722,1902,1482,1462,1342,1022,902,1322,882,1262,1722,1902,1043,1023,983,1463,1423,1003,1443,1743,1923,983,1423,1003,1043,1023,1443,1483,1463,1743,1923,1483,1463,1423,983,1443,1003,1923,1743,1423,983,1443,1483,1463,1003,1023,1743,1923,1423,983,1443,1483,1463,1023,1003,1743,1923,904,1344,924,1044,1024,1364,1464,1724,1904,1044,1024,904,1484,1464,1344,924,1364,1724,1904,1724,1904,1344,1364,1464,1484,904,924,1044,1024,1344,904,1364,1484,1464,924,1724,1904,1484,1464,1344,1024,904,1364,924,1724,1904,1344,904,1364,1484,1464,924,1724,1904,1045,985,905,1485,1425,1345,865,1305,1245,1705,1885,1485,1425,1345,1045,985,905,1305,865,1245,1705,1885,1046,1026,986,1466,1426,1746,1926,1026,1466,1046,1066,986,1486,1506,1426,1746,1926,1046,1486,1026,986,1066,1466,1426,1506,1746,1926,1486,1466,1426,986,1926,1746,1466,1026,1486,1506,1426,1046,986,1746,1926,1046,1026,986,1426,1066,1746,1926,986,1426,1046,1026,1486,1066,1466,1746,1926,1026,1466,1046,1066,986,1506,1486,1426,1746,1926,1486,1466,1426,986,1506,1746,1926,1947,1967,1767,1807,1827,1867,1567,1607,1667,1627,1947,1967,1767,1807,1827,1867,1607,1667,1567,1627,1607,1807,1567,1667,1767,1867,1627,1827,1947,1967,1627,1827,1667,1567,1867,1767,1607,1807,1947,1967,1807,1607,1767,1867,1567,1827,1627,1967,1947,1827,1627,1867,1767,1567,1807,1607,1947,1967,908,1348,948,1048,988,1388,1428,1708,1888,1048,988,908,1488,1428,1348,948,1388,1708,1888,1708,1888,1348,1388,1428,1488,908,948,1048,988,1348,908,1388,1488,1428,988,1708,1888,1488,1428,1348,1048,988,908,1388,948,1708,1888,1348,908,1388,1488,1428,988,1708,1888,1949,1969,1769,1789,1849,1869,1569,1589,1649,1669,1949,1969,1769,1789,1849,1869,1649,1669,1569,1589,1569,1769,1649,1589,1789,1949,1969,1589,1789,1669,1569,1769,1649,1849,1949,1969,1649,1849,1569,1669,1769,1869,1589,1789,1949,1969,1669,1869,1589,1649,1789,1849,1569,1769,1949,1969,1769,1569,1849,1789,1589,1949,1969,1789,1589,1869,1769,1569,1849,1649,1949,1969,1849,1649,1769,1869,1569,1669,1789,1589,1969,1949,1869,1669,1789,1849,1589,1649,1769,1569,1969,1949,1050,1030,910,1490,1470,1350,1730,1910,1030,1470,1050,1110,910,1490,1350,1730,1910,1050,1490,1030,910,1110,1470,1350,1550,1730,1910,1490,1470,1350,1030,910,1730,1910,1470,1030,1490,1550,1350,1050,910,1730,1910,1490,1050,1470,1350,1550,910,1030,1910,1730,910,1350,1050,1030,1730,1910,1050,1030,910,1490,1470,1350,1110,1730,1910,1030,1470,1050,1110,910,1490,1350,1730,1910,1490,1470,1350,1030,910,1550,1730,1910,1470,1030,1490,1550,1350,1050,910,1730,1910,991,1431,1051,1091,911,1491,1351,1711,1891,1051,991,911,1491,1431,1351,1091,1531,1711,1891,1051,1491,991,911,1091,1431,1351,1531,1711,1891,1711,1891,1351,1431,1491,1531,911,1051,1091,991,1431,991,1491,1531,1351,911,1711,1891,1491,1431,1351,1051,991,911,1531,1091,1711,1891,1491,1051,1431,1351,1531,991,911,1091,1891,1711,911,1351,1051,991,1091,1431,1711,1891,991,1431,1051,1091,911,1491,1351,1711,1891,1051,991,911,1491,1431,1351,1091,1531,1711,1891,1431,991,1491,1531,1351,911,1711,1891,1692,752,772,812,832,432,452,492,512,512,492,452,832,812,772,432,752,1692,1692,752,772,812,832,432,452,492,512,453,773,473,513,493,793,813,1693,1693,773,793,813,833,453,473,493,513,453,773,473,513,493,793,833,813,1693,513,493,453,833,813,773,473,793,1693,773,453,793,833,813,473,493,1693,1693,773,793,813,833,453,473,493,513,494,814,514,534,454,834,774,1694,514,834,494,454,534,814,774,854,1694,1694,774,814,834,854,454,494,514,534,494,814,514,454,534,834,774,854,1694,514,834,494,454,534,814,774,854,1694,514,494,454,834,814,774,534,854,1694,814,494,834,854,774,514,454,1694,834,514,814,774,854,534,494,454,1694,1694,774,814,834,854,454,494,514,534,454,494,774,514,1694,454,514,774,534,494,814,1694,494,514,534,834,814,454,774,1694,355,675,375,335,695,655,595,1235,1675,675,355,695,655,375,335,595,1235,1675,356,676,396,316,716,636,576,1216,1656,676,356,716,636,316,576,1216,1656,357,677,417,297,617,557,1177,1617,677,357,737,617,297,557,1177,1617,78,218,98,58,238,198,1198,78,218,58,98,198,238,1198,218,78,238,198,98,58,1198,218,78,198,238,58,98,1198,78,58,98,198,1198,58,78,218,198,98,1198,79,219,139,19,159,1159,79,219,19,139,159,279,1159,219,79,279,159,19,1159,219,79,159,279,19,1159,19,79,159,1159,79,219,19,139,159,1159,80,220,120,40,260,180,1140,80,220,40,120,180,260,1140,220,80,260,180,40,120,1140,220,80,180,260,40,120,1140,40,80,180,120,1140,80,220,120,40,180,260,1140]],115,134)
    M = Matrix(M)

    L,_,p = lu(M[:,1:86])
    Id = Matrix{Float64}(I,115,115)
    M = [L Id[:,87:end]][invperm(p),:]\M[:,87:end]
    M = M[87:end,:]

    L,U,p = lu(M[:,1:24])
    Id = Matrix{Float64}(I,29,29)
    M = [L Id[:,25:end]][invperm(p),:]\M[:,25:end]
    M1 = M[1:24,:]
    M2 = M[25:end,:]

    Q,R,p = qr(M2[:,1:end-7],ColumnNorm())
    A = U\[M1[:,p] M1[:,end-6:end]]
    B = R[:,1:5]\[R[:,6:end] transpose(Q)*M2[:,end-6:end]]
    M = [-A[:,end-18:end]+A[:,1:end-19]*B; -B]

    P1 = Vector{Int}([25:48; p; 18:24])
    P2 = Vector{Int}([25,26,27,28,29,30,32,34,35,37,38,40,41,42,43,44,46,47,48,39,31,33,45,36])
    T = getT(M,P1[1:end-19],P1[end-18:end],P2)

    f,V = eigen(T)
    ind = sortperm(abs.(f),rev=true)
    f = f[ind]
    V = V[:,ind[1:15]] # remove last 4 smallest eigenvalues
    f = f[1:15]

    S = Matrix{ComplexF64}(undef,6,15)
    S[[2,3],:] = V[[16,17],:]./repeat(V[19:19,:],2)
    S[[1,4],:] = repeat(V[19:19,:],2)./V[[15,18],:]

    a14 = S[1,:]
    a24 = S[2,:]
    a34 = S[3,:]
    b1 = S[4,:]
    a4 = sqrt.(-(C[1140]./a34)./([a34 ones(15) 1.0./a34 a34.*f f f./a34]*C[[40,80,120,180,220,260]]))
    S = transpose([a14.*a4 a24.*a4 a34.*a4 a4 b1 1.0./f])
    S = S[:,vec(all(c -> !isinf(c) && !isnan(c), S; dims=1))]

    return S

end