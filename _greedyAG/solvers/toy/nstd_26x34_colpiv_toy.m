% Input: coefficient matrix C of size 3x10

function [x,y,z] = nstd_26x34_colpiv_toy(C)

    i_dx = [1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,6,6,6,6,7,7,7,7,8,8,8,8,9,9,9,9,10,10,10,10,11,11,11,12,12,12,13,13,13,14,14,14,15,15,15,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,22,22,22,23,23,23,24,24,24,25,25,25,26,26,26];
    j_dx = [7,10,16,20,13,16,22,26,19,22,28,31,8,11,17,21,10,12,18,23,14,17,23,27,16,18,24,29,20,23,29,32,22,24,30,33,26,29,33,34,3,13,25,1,8,20,2,10,22,4,14,26,5,16,28,6,20,31,7,9,12,21,13,15,18,27,19,21,24,32,25,27,30,34,3,14,31,1,9,27,2,11,29,4,15,32,5,17,33,6,21,34];
    C_dx = [13,19,25,28,13,19,25,28,13,19,25,28,13,19,25,28,13,19,25,28,13,19,25,28,13,19,25,28,13,19,25,28,13,19,25,28,13,19,25,28,11,17,29,11,17,29,11,17,29,11,17,29,11,17,29,11,17,29,11,17,23,29,11,17,23,29,11,17,23,29,11,17,23,29,3,6,30,3,6,30,3,6,30,3,6,30,3,6,30,3,6,30];
    M = sparse(i_dx,j_dx,C(C_dx),26,34);

    [L,~,Pi] = lu(M(:,1:6));
    Pi = Pi';
    M = [Pi*L Pi(:,7:end)]\M(:,7:end);
    M = full(M(7:end,:));

    [L,UR,Pi] = lu(M(:,1:6));
    Pi = Pi';
    M = [Pi*L Pi(:,7:end)]\M(:,7:end);
    MP = M(1:6,:);
    NP = M(7:end,:);

    [Q,U,Pi] = qr(NP(:,1:end-4));
    A = UR\[MP(:,1:end-4)*Pi MP(:,end-3:end)];
    B = U(:,1:14)\[U(:,15:end) Q'*NP(:,end-3:end)];
    M = [-A(:,end-7:end)+A(:,1:end-8)*B; -B];

    xP = [23,24,25,26,27,28,1,2,3,4,5,6,7,8,9,10,11,12,14,15,17,20];
    P1 = [(1:18)*Pi 19:22];
    T = getT(M,[23:28 P1(1:end-8)],P1(end-7:end),xP);

    [V,D] = eig(T);
    sol = [V([5,7],:)./repmat(V(8,:),2,1); diag(D).'];

    I = find(not(isnan(sol(1,:))) & not(isinf(sol(1,:))));
    %I = I(not(imag(sol(1,:)))); % uncomment this line for real roots only
    x = sol(1,I);
    z = sol(2,I);
    y = sol(3,I);

end