% Input: coefficient matrix C of size 5x35
% Output: solution matrix S of size 3x20

function S = nstd_16x36_colpiv_4pra(C)

    M = sparse([1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,6,6,6,6,7,7,7,7,8,8,8,8,9,9,9,9,10,10,10,10,11,11,11,11,12,12,12,12,13,13,13,13,14,14,14,14,15,15,15,15,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36],[1,23,27,41,2,24,28,42,5,25,29,43,11,32,36,48,1,3,8,17,6,26,30,44,12,33,37,49,8,27,31,45,14,34,38,50,17,41,45,53,2,4,9,18,5,7,10,19,11,13,16,20,9,21,28,46,15,35,39,51,18,42,46,54,10,22,29,47,16,36,40,52,19,43,47,55,20,48,52,56,1,2,3,5,6,8,11,12,14,17,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,41,42,43,44,45,48,49,50,53,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,24,26,28,30,33,35,37,39,42,44,46,49,51,54,5,6,7,8,9,10,14,15,16,19,21,22,25,26,27,28,29,30,31,34,35,36,37,38,39,40,43,44,45,46,47,50,51,52,55,11,12,13,14,15,16,17,18,19,20,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,1,2,3,5,6,8,11,12,14,17,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,41,42,43,44,45,48,49,50,53,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,24,26,28,30,33,35,37,39,42,44,46,49,51,54,5,6,7,8,9,10,14,15,16,19,21,22,25,26,27,28,29,30,31,34,35,36,37,38,39,40,43,44,45,46,47,50,51,52,55,11,12,13,14,15,16,17,18,19,20,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,1,2,3,5,6,8,11,12,14,17,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,41,42,43,44,45,48,49,50,53,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,24,26,28,30,33,35,37,39,42,44,46,49,51,54,5,6,7,8,9,10,14,15,16,19,21,22,25,26,27,28,29,30,31,34,35,36,37,38,39,40,43,44,45,46,47,50,51,52,55,11,12,13,14,15,16,17,18,19,20,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,1,2,3,5,6,8,11,12,14,17,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,41,42,43,44,45,48,49,50,53,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,24,26,28,30,33,35,37,39,42,44,46,49,51,54,5,6,7,8,9,10,14,15,16,19,21,22,25,26,27,28,29,30,31,34,35,36,37,38,39,40,43,44,45,46,47,50,51,52,55,11,12,13,14,15,16,17,18,19,20,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56],C([140,130,155,175,140,130,155,175,140,130,155,175,140,130,155,175,130,140,155,175,140,130,155,175,140,130,155,175,140,130,155,175,140,130,155,175,140,130,155,175,130,140,155,175,130,140,155,175,130,140,155,175,140,155,130,175,140,130,155,175,140,130,155,175,140,155,130,175,140,130,155,175,140,130,155,175,140,130,155,175,11,16,21,36,41,56,86,91,106,136,1,6,26,31,46,51,61,66,71,76,81,96,101,111,116,121,126,131,141,146,151,156,161,166,171,6,11,16,21,31,36,41,51,56,66,81,86,91,101,106,116,131,136,146,161,71,1,26,46,61,76,96,111,121,126,141,151,156,166,171,11,16,21,36,41,56,86,91,106,136,66,71,1,6,26,31,46,51,61,76,81,96,101,111,116,121,126,131,141,146,151,156,161,166,171,11,16,21,36,41,56,86,91,106,136,1,6,26,31,46,51,61,66,71,76,81,96,101,111,116,121,126,131,141,146,151,156,161,166,171,12,17,22,37,42,57,87,92,107,137,2,7,27,32,47,52,62,67,72,77,82,97,102,112,117,122,127,132,142,147,152,157,162,167,172,7,12,17,22,32,37,42,52,57,67,82,87,92,102,107,117,132,137,147,162,72,2,27,47,62,77,97,112,122,127,142,152,157,167,172,12,17,22,37,42,57,87,92,107,137,67,72,2,7,27,32,47,52,62,77,82,97,102,112,117,122,127,132,142,147,152,157,162,167,172,12,17,22,37,42,57,87,92,107,137,2,7,27,32,47,52,62,67,72,77,82,97,102,112,117,122,127,132,142,147,152,157,162,167,172,13,18,23,38,43,58,88,93,108,138,3,8,28,33,48,53,63,68,73,78,83,98,103,113,118,123,128,133,143,148,153,158,163,168,173,8,13,18,23,33,38,43,53,58,68,83,88,93,103,108,118,133,138,148,163,73,3,28,48,63,78,98,113,123,128,143,153,158,168,173,13,18,23,38,43,58,88,93,108,138,68,73,3,8,28,33,48,53,63,78,83,98,103,113,118,123,128,133,143,148,153,158,163,168,173,13,18,23,38,43,58,88,93,108,138,3,8,28,33,48,53,63,68,73,78,83,98,103,113,118,123,128,133,143,148,153,158,163,168,173,14,19,24,39,44,59,89,94,109,139,4,9,29,34,49,54,64,69,74,79,84,99,104,114,119,124,129,134,144,149,154,159,164,169,174,9,14,19,24,34,39,44,54,59,69,84,89,94,104,109,119,134,139,149,164,74,4,29,49,64,79,99,114,124,129,144,154,159,169,174,14,19,24,39,44,59,89,94,109,139,69,74,4,9,29,34,49,54,64,79,84,99,104,114,119,124,129,134,144,149,154,159,164,169,174,14,19,24,39,44,59,89,94,109,139,4,9,29,34,49,54,64,69,74,79,84,99,104,114,119,124,129,134,144,149,154,159,164,169,174]),36,56);

    M = M(21:end,21:end)-(M(21:end,1:20)/M(1:20,1:20))*M(1:20,21:end); % Schur complement reduction

    [L,~,Pi] = lu(M(:,1:2));
    Pi = Pi';
    M = [Pi*L Pi(:,3:end)]\M(:,3:end);
    M = full(M(3:end,:));

    [L,UR,Pi] = lu(M(:,1:9));
    Pi = Pi';
    M = [Pi*L Pi(:,10:end)]\M(:,10:end);
    MP = M(1:9,:);
    NP = M(10:end,:);

    [Q,U,Pi] = qr(NP(:,1:end-4));
    A = UR\[MP(:,1:end-4)*Pi MP(:,end-3:end)];
    B = U(:,1:5)\[U(:,6:end) Q'*NP(:,end-3:end)];
    M = [-A(:,end-19:end)+A(:,1:end-20)*B; -B];

    xP = [26,27,28,29,30,31,32,33,34,1,2,3,4,5,6,7,10,11,12,13,14,17,18,19,22];
    P1 = [(1:21)*Pi 22:25];
    T = getT(M,[26:34 P1(1:end-20)],P1(end-19:end),xP);

    [V,~] = eig(T);
    S = V(17:19,:)./repmat(V(20,:),3,1);

    I = ~isnan(S(1,:)) & ~isinf(S(1,:));
    %I = I & ~imag(S(1,:)); % uncomment this line for real roots only
    S = S(:,I);

end