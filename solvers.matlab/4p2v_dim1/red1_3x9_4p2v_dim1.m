% Input: cell array CC of 4 coefficient matrices of size 3x9
% Output: cell arrays TT0 and TT1, each containing 4 matrices of size 6x6

function [TT0,TT1] = red1_3x9_4p2v_dim1(CC)

    MM = cell([1,4]);
    MM{1} = sparse([1,1,1,1,1,1,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3],[4,5,6,7,8,9,4,5,6,7,8,9,1,2,3,4,5,6,7,8,9],CC{1}([1,4,7,13,16,22,2,5,8,14,17,23,12,21,27,3,6,9,15,18,24]),3,9);
    MM{2} = sparse([1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3],[1,2,3,4,5,7,8,9,1,2,3,4,5,7,8,9,1,2,3,4,5,6,7,8,9],CC{2}([10,19,25,1,4,13,16,22,11,20,26,2,5,14,17,23,12,21,27,3,6,9,15,18,24]),3,9);
    MM{3} = sparse([1,1,1,1,2,2,2,2,3,3,3,3,3],[1,2,4,7,1,2,4,7,1,2,4,5,7],CC{3}([10,19,1,13,11,20,2,14,12,21,3,6,15]),3,9);
    MM{4} = sparse([1,2,3,3],[1,1,1,4],CC{4}([10,11,12,3]),3,9);

    TT0 = mat2cell(repmat(zeros(6),1,4),6,repmat(6,1,4));
    TT1 = mat2cell(repmat(zeros(6),1,4),6,repmat(6,1,4));
    TT0{1}([20,27,35]) = 1;
    TT1{1}([8,15,29]) = 1;
    [L,~,P] = lu(MM{1}(:,1:0));
    P = P';
    P = [P*L P(:,1:end)];
    for i = 1:4
        M = P\MM{i}(:,1:end);
        M = M(end-2:end,:);
        TT0{i}([1,4,6],:) = -M(:,4:end);
        TT1{i}([1,4,6],[1,4,6]) = M(:,1:3);
    end

end